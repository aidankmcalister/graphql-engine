<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- | Arg and Env Parsing for initialisation of the engine along with</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- corresponding logging and other helper functionality.</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- This module is intended as the interface for options parsing and</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- its submodules should not need to be imported directly.</span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html"><span class="hs-identifier">Hasura.Server.Init</span></a></span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Option Fetching and Merging</span></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier">mkHGEOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier">mkServeOptions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier">processPostgresConnInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Metadata DB</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier">getDbId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier">getPgVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Re-exports</span></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html"><span class="hs-identifier">Hasura.Server.Init.Env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.html"><span class="hs-identifier">Hasura.Server.Init.Arg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Logging.html"><span class="hs-identifier">Hasura.Server.Init.Logging</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html"><span class="hs-identifier">Hasura.Server.Init.FeatureFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span class="hs-keyword">where</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.html/Data.HashSet.html"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashSet</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.html/Database.PG.Query.html"><span class="hs-identifier">Database.PG.Query</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Query</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Connection.html"><span class="hs-identifier">Hasura.Backends.Postgres.Connection</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Connection</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Error</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.ApolloFederation.html"><span class="hs-identifier">Hasura.GraphQL.ApolloFederation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.GraphQL.ApolloFederation.html#getApolloFederationStatus"><span class="hs-identifier">getApolloFederationStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html"><span class="hs-identifier">Hasura.GraphQL.Execute.Subscription.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Subscription.Options</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Logging</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Common</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Schema.Options.html"><span class="hs-identifier">Hasura.RQL.Types.Schema.Options</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Options</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Auth.html"><span class="hs-identifier">Hasura.Server.Auth</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Auth</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Cors.html"><span class="hs-identifier">Hasura.Server.Cors</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Cors</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.html"><span class="hs-identifier">Hasura.Server.Init.Arg</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html"><span class="hs-identifier">Hasura.Server.Init.Config</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html"><span class="hs-identifier">Hasura.Server.Init.Env</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.FeatureFlag.html"><span class="hs-identifier">Hasura.Server.Init.FeatureFlag</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Logging.html"><span class="hs-identifier">Hasura.Server.Init.Logging</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Server.Logging</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Types</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/websockets-0.13.0.0-2cd899d4b3466ebf052047c238a83c60318de1a150acea53b7173aee9736fdbb/share/doc/html/src/Network.WebSockets.html/Network.WebSockets.html"><span class="hs-identifier">Network.WebSockets</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WebSockets</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/refined-0.8.2-0dcf4cad4ded3c586f9b24c73216dddc25503a45bf2f48d52c9d10964a9a8deb/share/doc/html/src/Refined.html/Refined.html"><span class="hs-identifier">Refined</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/refined-0.8.2-0dcf4cad4ded3c586f9b24c73216dddc25503a45bf2f48d52c9d10964a9a8deb/share/doc/html/src/Refined.html/Refined.html#unrefine"><span class="hs-identifier">unrefine</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- TODO(SOLOMON): Where does this note belong?</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">{- Note [ReadOnly Mode]
~~~~~~~~~~~~~~~~~~~~~~~~~

This mode starts the server in a (database) read-only mode. That is, only
read-only queries are allowed on users' database sources, and write
queries throw a runtime error. The use-case is for failsafe operations.
Metadata APIs are also disabled.

Following is the precise behaviour -
  1. For any GraphQL API (relay/hasura; http/websocket) - disable execution of
  mutations
  2. Metadata API is disabled
  3. /v2/query API - insert, delete, update, run_sql are disabled
  4. /v1/query API - insert, delete, update, run_sql are disabled
  5. No source catalog migrations are run
  6. During build schema cache phase, building event triggers are disabled (as
  they create corresponding database triggers)
-}</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | Query the Metadata DB for the Metadata DB UUID.</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- TODO: Move into a dedicated Metadata module (ala Pro).</span><span>
</span><span id="line-78"></span><span class="annot"><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-type">getDbId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">Query.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">Error.QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-type">Types.MetadataDbId</span></a></span><span>
</span><span id="line-79"></span><span id="getDbId"><span class="annot"><span class="annottext">getDbId :: TxE QErr MetadataDbId
</span><a href="Hasura.Server.Init.html#getDbId"><span class="hs-identifier hs-var hs-var">getDbId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; MetadataDbId
</span><a href="Hasura.Server.Types.html#MetadataDbId"><span class="hs-identifier hs-var">Types.MetadataDbId</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="annottext">(Text -&gt; MetadataDbId)
-&gt; (SingleRow (Identity Text) -&gt; Text)
-&gt; SingleRow (Identity Text)
-&gt; MetadataDbId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Identity Text -&gt; Text
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><span class="annottext">(Identity Text -&gt; Text)
-&gt; (SingleRow (Identity Text) -&gt; Identity Text)
-&gt; SingleRow (Identity Text)
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SingleRow (Identity Text) -&gt; Identity Text
forall a. SingleRow a -&gt; a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Class.html/Database.PG.Query.Class.html#getRow"><span class="hs-identifier hs-var">Query.getRow</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="annottext">(SingleRow (Identity Text) -&gt; MetadataDbId)
-&gt; TxET QErr IO (SingleRow (Identity Text))
-&gt; TxE QErr MetadataDbId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(PGTxErr -&gt; QErr)
-&gt; Query -&gt; () -&gt; Bool -&gt; TxET QErr IO (SingleRow (Identity Text))
forall (m :: * -&gt; *) a r e.
(MonadIO m, FromRes a, ToPrepArgs r) =&gt;
(PGTxErr -&gt; e) -&gt; Query -&gt; r -&gt; Bool -&gt; TxET e m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html/Database.PG.Query.Transaction.html#withQE"><span class="hs-identifier hs-var">Query.withQE</span></a></span><span>
</span><span id="line-84"></span><span>      </span><span class="annot"><span class="annottext">PGTxErr -&gt; QErr
</span><a href="Hasura.Backends.Postgres.Execute.Types.html#defaultTxErrorHandler"><span class="hs-identifier hs-var">Connection.defaultTxErrorHandler</span></a></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="">[Query.sql|
    SELECT (hasura_uuid :: text) FROM hdb_catalog.hdb_version
  |]</span></span><span>
</span><span id="line-88"></span><span>      </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>      </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="annot"><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-type">getPgVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html/Database.PG.Query.Transaction.html#TxE"><span class="hs-identifier hs-type">Query.TxE</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">Error.QErr</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-type">Types.PGVersion</span></a></span><span>
</span><span id="line-92"></span><span id="getPgVersion"><span class="annot"><span class="annottext">getPgVersion :: TxE QErr PGVersion
</span><a href="Hasura.Server.Init.html#getPgVersion"><span class="hs-identifier hs-var hs-var">getPgVersion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; PGVersion
</span><a href="Hasura.Server.Types.html#PGVersion"><span class="hs-identifier hs-var">Types.PGVersion</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; PGVersion) -&gt; TxET QErr IO Int -&gt; TxE QErr PGVersion
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxET QErr IO Int
forall (m :: * -&gt; *) e. MonadIO m =&gt; TxET e m Int
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Transaction.html/Database.PG.Query.Transaction.html#serverVersion"><span class="hs-identifier hs-var">Query.serverVersion</span></a></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | Given the 'ServeOptionsRaw' parsed from the arg parser,</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- postprocess the db url and fetch env vars associated with the main</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- command parser, then process the subcommand raw values if</span><span>
</span><span id="line-99"></span><span class="hs-comment">-- necessary.</span><span>
</span><span id="line-100"></span><span id="local-6989586621687870547"><span class="annot"><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-type">mkHGEOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">Logging.EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870547"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptionsRaw"><span class="hs-identifier hs-type">HGEOptionsRaw</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870547"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-type">HGEOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870547"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-102"></span><span id="mkHGEOptions"><span class="annot"><span class="annottext">mkHGEOptions :: forall impl.
EnabledLogTypes impl =&gt;
HGEOptionsRaw (ServeOptionsRaw impl)
-&gt; WithEnv (HGEOptions (ServeOptions impl))
</span><a href="Hasura.Server.Init.html#mkHGEOptions"><span class="hs-identifier hs-var hs-var">mkHGEOptions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptionsRaw"><span class="hs-identifier hs-type">HGEOptionsRaw</span></a></span><span> </span><span id="local-6989586621687870818"><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresConnInfoRaw)
</span><a href="#local-6989586621687870818"><span class="hs-identifier hs-var">rawDbUrl</span></a></span></span><span> </span><span id="local-6989586621687870819"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621687870819"><span class="hs-identifier hs-var">rawMetadataDbUrl</span></a></span></span><span> </span><span id="local-6989586621687870820"><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="#local-6989586621687870820"><span class="hs-identifier hs-var">rawCmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621687870821"><span class="annot"><a href="#local-6989586621687870821"><span class="hs-identifier hs-var">dbUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresConnInfoRaw)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
</span><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-var">processPostgresConnInfo</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnInfo (Maybe PostgresConnInfoRaw)
</span><a href="#local-6989586621687870818"><span class="hs-identifier hs-var">rawDbUrl</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621687870822"><span class="annot"><a href="#local-6989586621687870822"><span class="hs-identifier hs-var">metadataDbUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-type">withOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870819"><span class="hs-identifier hs-type">rawMetadataDbUrl</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.html#metadataDbUrlOption"><span class="hs-identifier hs-type">metadataDbUrlOption</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621687870825"><span class="annot"><a href="#local-6989586621687870825"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687870820"><span class="hs-identifier hs-type">rawCmd</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HCServe"><span class="hs-identifier hs-type">HCServe</span></a></span><span> </span><span id="local-6989586621687870827"><span class="annot"><span class="annottext">ServeOptionsRaw impl
</span><a href="#local-6989586621687870827"><span class="hs-identifier hs-var">rso</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ServeOptions impl -&gt; HGECommand (ServeOptions impl)
forall a. a -&gt; HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCServe"><span class="hs-identifier hs-var">HCServe</span></a></span><span> </span><span class="annot"><span class="annottext">(ServeOptions impl -&gt; HGECommand (ServeOptions impl))
-&gt; WithEnvT Identity (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ServeOptionsRaw impl -&gt; WithEnvT Identity (ServeOptions impl)
forall impl.
EnabledLogTypes impl =&gt;
ServeOptionsRaw impl -&gt; WithEnv (ServeOptions impl)
</span><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-var">mkServeOptions</span></a></span><span> </span><span class="annot"><span class="annottext">ServeOptionsRaw impl
</span><a href="#local-6989586621687870827"><span class="hs-identifier hs-var">rso</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="Hasura.Server.Init.Config.html#HCExport"><span class="hs-identifier hs-var">HCExport</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCExport"><span class="hs-identifier hs-var">HCExport</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="Hasura.Server.Init.Config.html#HCClean"><span class="hs-identifier hs-var">HCClean</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCClean"><span class="hs-identifier hs-var">HCClean</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><span class="annottext">HGECommand (ServeOptionsRaw impl)
</span><a href="Hasura.Server.Init.Config.html#HCVersion"><span class="hs-identifier hs-var">HCVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
forall a. HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCVersion"><span class="hs-identifier hs-var">HCVersion</span></a></span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HCDowngrade"><span class="hs-identifier hs-type">HCDowngrade</span></a></span><span> </span><span id="local-6989586621687870832"><span class="annot"><span class="annottext">DowngradeOptions
</span><a href="#local-6989586621687870832"><span class="hs-identifier hs-var">tgt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HGECommand (ServeOptions impl)
-&gt; WithEnvT Identity (HGECommand (ServeOptions impl))
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DowngradeOptions -&gt; HGECommand (ServeOptions impl)
forall a. DowngradeOptions -&gt; HGECommand a
</span><a href="Hasura.Server.Init.Config.html#HCDowngrade"><span class="hs-identifier hs-var">HCDowngrade</span></a></span><span> </span><span class="annot"><span class="annottext">DowngradeOptions
</span><a href="#local-6989586621687870832"><span class="hs-identifier hs-var">tgt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#HGEOptions"><span class="hs-identifier hs-type">HGEOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870821"><span class="hs-identifier hs-type">dbUrl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870822"><span class="hs-identifier hs-type">metadataDbUrl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870825"><span class="hs-identifier hs-type">cmd</span></a></span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- | 'PostressConnInfo' is a a tuple of some @a@ with a 'Maybe Int'</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- representing the retries setting. This function thus takes a</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- retries setting and a 'PostgresConnInfoRaw' from the arg parser and</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- merges those results with the contents of their corresponding env</span><span>
</span><span id="line-117"></span><span class="hs-comment">-- vars.</span><span>
</span><span id="line-118"></span><span class="annot"><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-type">processPostgresConnInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfoRaw"><span class="hs-identifier hs-type">PostgresConnInfoRaw</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">Common.UrlConf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span id="processPostgresConnInfo"><span class="annot"><span class="annottext">processPostgresConnInfo :: PostgresConnInfo (Maybe PostgresConnInfoRaw)
-&gt; WithEnv (PostgresConnInfo (Maybe UrlConf))
</span><a href="Hasura.Server.Init.html#processPostgresConnInfo"><span class="hs-identifier hs-var hs-var">processPostgresConnInfo</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687870835"><span id="local-6989586621687870836"><span class="annot"><span class="annottext">Maybe Int
Maybe PostgresConnInfoRaw
_pciDatabaseConn :: Maybe PostgresConnInfoRaw
_pciRetries :: Maybe Int
_pciRetries :: forall a. PostgresConnInfo a -&gt; Maybe Int
_pciDatabaseConn :: forall a. PostgresConnInfo a -&gt; a
</span><a href="#local-6989586621687870835"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>  </span><span id="local-6989586621687870839"><span class="annot"><a href="#local-6989586621687870839"><span class="hs-identifier hs-var">withEnvRetries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Option () -&gt; WithEnvT Identity (Maybe Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621687870836"><span class="hs-identifier hs-var">_pciRetries</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.html#retriesNumOption"><span class="hs-identifier hs-var">retriesNumOption</span></a></span><span>
</span><span id="line-123"></span><span>  </span><span id="local-6989586621687870841"><span class="annot"><a href="#local-6989586621687870841"><span class="hs-identifier hs-var">databaseUrl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-type">rawConnInfoToUrlConf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870835"><span class="hs-identifier hs-type">_pciDatabaseConn</span></a></span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfo"><span class="hs-identifier hs-type">PostgresConnInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870841"><span class="hs-identifier hs-type">databaseUrl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870839"><span class="hs-identifier hs-type">withEnvRetries</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | A helper function for 'processPostgresConnInfo' which fetches</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- postgres connection info from the 'WithEnv' and merges it with the</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- arg parser result.</span><span>
</span><span id="line-129"></span><span class="annot"><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-type">rawConnInfoToUrlConf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PostgresConnInfoRaw"><span class="hs-identifier hs-type">PostgresConnInfoRaw</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#UrlConf"><span class="hs-identifier hs-type">Common.UrlConf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span id="rawConnInfoToUrlConf"><span class="annot"><span class="annottext">rawConnInfoToUrlConf :: Maybe PostgresConnInfoRaw -&gt; WithEnv (Maybe UrlConf)
</span><a href="Hasura.Server.Init.html#rawConnInfoToUrlConf"><span class="hs-identifier hs-var hs-var">rawConnInfoToUrlConf</span></a></span></span><span> </span><span id="local-6989586621687870843"><span class="annot"><span class="annottext">Maybe PostgresConnInfoRaw
</span><a href="#local-6989586621687870843"><span class="hs-identifier hs-var">maybeRawConnInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621687870844"><span class="annot"><a href="#local-6989586621687870844"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WithEnvT Identity [(String, String)]
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687870846"><span class="annot"><a href="#local-6989586621687870846"><span class="hs-identifier hs-var hs-var">databaseUrlEnvVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Option () -&gt; String
forall def. Option def -&gt; String
</span><a href="Hasura.Server.Init.Config.html#_envVar"><span class="hs-identifier hs-var">_envVar</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.html#databaseUrlOption"><span class="hs-identifier hs-var">databaseUrlOption</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span id="local-6989586621687870849"><span class="annot"><a href="#local-6989586621687870849"><span class="hs-identifier hs-var hs-var">hasDatabaseUrlEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, String) -&gt; Bool) -&gt; [(String, String)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621687870846"><span class="hs-identifier hs-var">databaseUrlEnvVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool)
-&gt; ((String, String) -&gt; String) -&gt; (String, String) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(String, String) -&gt; String
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621687870844"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687870843"><span class="hs-identifier hs-type">maybeRawConnInfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-comment">-- If no --database-url or connection options provided in CLI command</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">Maybe PostgresConnInfoRaw
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687870849"><span class="hs-identifier hs-var">hasDatabaseUrlEnv</span></a></span><span>
</span><span id="line-139"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- Consider env variable as is in order to store it as @`UrlConf`</span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-comment">-- in default source configuration in metadata</span><span>
</span><span id="line-141"></span><span>          </span><span class="annot"><span class="annottext">UrlConf -&gt; Maybe UrlConf
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UrlConf -&gt; Maybe UrlConf) -&gt; UrlConf -&gt; Maybe UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; UrlConf
</span><a href="Hasura.RQL.Types.Common.html#UrlFromEnv"><span class="hs-identifier hs-var">Common.UrlFromEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; UrlConf) -&gt; Text -&gt; UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621687870846"><span class="hs-identifier hs-var">databaseUrlEnvVar</span></a></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe UrlConf
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687870854"><span class="annot"><span class="annottext">PostgresConnInfoRaw
</span><a href="#local-6989586621687870854"><span class="hs-identifier hs-var">databaseConn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>      </span><span class="annot"><span class="annottext">UrlConf -&gt; Maybe UrlConf
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(UrlConf -&gt; Maybe UrlConf)
-&gt; (Template -&gt; UrlConf) -&gt; Template -&gt; Maybe UrlConf
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">InputWebhook -&gt; UrlConf
</span><a href="Hasura.RQL.Types.Common.html#UrlValue"><span class="hs-identifier hs-var">Common.UrlValue</span></a></span><span> </span><span class="annot"><span class="annottext">(InputWebhook -&gt; UrlConf)
-&gt; (Template -&gt; InputWebhook) -&gt; Template -&gt; UrlConf
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Template -&gt; InputWebhook
</span><a href="Hasura.RQL.Types.Common.html#InputWebhook"><span class="hs-identifier hs-var">Common.InputWebhook</span></a></span><span> </span><span class="annot"><span class="annottext">(Template -&gt; Maybe UrlConf) -&gt; Template -&gt; Maybe UrlConf
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PostgresConnInfoRaw
</span><a href="#local-6989586621687870854"><span class="hs-identifier hs-var">databaseConn</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-145"></span><span>        </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PGConnDatabaseUrl"><span class="hs-identifier hs-type">PGConnDatabaseUrl</span></a></span><span> </span><span id="local-6989586621687870858"><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621687870858"><span class="hs-identifier hs-var">urlTemplate</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Template
</span><a href="#local-6989586621687870858"><span class="hs-identifier hs-var">urlTemplate</span></a></span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><a href="Hasura.Server.Init.Config.html#PGConnDetails"><span class="hs-identifier hs-type">PGConnDetails</span></a></span><span> </span><span id="local-6989586621687870860"><span class="annot"><span class="annottext">PostgresConnDetailsRaw
</span><a href="#local-6989586621687870860"><span class="hs-identifier hs-var">connDetails</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PostgresConnDetailsRaw -&gt; Template
</span><a href="Hasura.Server.Init.Config.html#rawConnDetailsToUrl"><span class="hs-identifier hs-var">rawConnDetailsToUrl</span></a></span><span> </span><span class="annot"><span class="annottext">PostgresConnDetailsRaw
</span><a href="#local-6989586621687870860"><span class="hs-identifier hs-var">connDetails</span></a></span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | Merge the results of the serve subcommmand arg parser with</span><span>
</span><span id="line-151"></span><span class="hs-comment">-- corresponding values from the 'WithEnv' context.</span><span>
</span><span id="line-152"></span><span class="annot"><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-type">mkServeOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621687870564"><span class="annot"><a href="#local-6989586621687870564"><span class="hs-identifier hs-type">impl</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#EnabledLogTypes"><span class="hs-identifier hs-type">Logging.EnabledLogTypes</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870564"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870564"><span class="hs-identifier hs-type">impl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnv"><span class="hs-identifier hs-type">WithEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870564"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span id="mkServeOptions"><span class="annot"><span class="annottext">mkServeOptions :: forall impl.
EnabledLogTypes impl =&gt;
ServeOptionsRaw impl -&gt; WithEnv (ServeOptions impl)
</span><a href="Hasura.Server.Init.html#mkServeOptions"><span class="hs-identifier hs-var hs-var">mkServeOptions</span></a></span></span><span> </span><span id="local-6989586621687871097"><span class="annot"><span class="annottext">sor :: ServeOptionsRaw impl
</span><a href="#local-6989586621687871097"><span class="hs-identifier hs-var">sor</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687871098"><span id="local-6989586621687871099"><span id="local-6989586621687871100"><span id="local-6989586621687871101"><span id="local-6989586621687871102"><span id="local-6989586621687871103"><span id="local-6989586621687871104"><span id="local-6989586621687871105"><span id="local-6989586621687871106"><span id="local-6989586621687871107"><span id="local-6989586621687871108"><span id="local-6989586621687871109"><span id="local-6989586621687871110"><span id="local-6989586621687871111"><span id="local-6989586621687871112"><span id="local-6989586621687871113"><span id="local-6989586621687871114"><span id="local-6989586621687871115"><span id="local-6989586621687871116"><span id="local-6989586621687871117"><span id="local-6989586621687871118"><span id="local-6989586621687871119"><span id="local-6989586621687871120"><span id="local-6989586621687871121"><span id="local-6989586621687871122"><span id="local-6989586621687871123"><span id="local-6989586621687871124"><span id="local-6989586621687871125"><span id="local-6989586621687871126"><span id="local-6989586621687871127"><span id="local-6989586621687871128"><span id="local-6989586621687871129"><span id="local-6989586621687871130"><span id="local-6989586621687871131"><span id="local-6989586621687871132"><span id="local-6989586621687871133"><span id="local-6989586621687871134"><span id="local-6989586621687871135"><span id="local-6989586621687871136"><span id="local-6989586621687871137"><span id="local-6989586621687871138"><span id="local-6989586621687871139"><span id="local-6989586621687871140"><span id="local-6989586621687871141"><span id="local-6989586621687871142"><span id="local-6989586621687871143"><span id="local-6989586621687871144"><span id="local-6989586621687871145"><span id="local-6989586621687871146"><span id="local-6989586621687871147"><span id="local-6989586621687871148"><span id="local-6989586621687871149"><span id="local-6989586621687871150"><span id="local-6989586621687871151"><span class="annot"><span class="annottext">Maybe Int
Maybe Text
Maybe HostPreference
Maybe (HashSet ExperimentalFeature)
Maybe (HashSet (EngineLogType impl))
Maybe (HashSet API)
Maybe TxIsolation
Maybe (Refined NonNegative Int)
Maybe (Refined NonNegative Milliseconds)
Maybe (Refined NonNegative Seconds)
Maybe (Refined Positive Int)
Maybe RoleName
Maybe RefetchInterval
Maybe BatchSize
Maybe NamingCase
Maybe InferFunctionPermissions
Maybe RemoteNullForwardingPolicy
Maybe BackwardsCompatibleNullInNonNullableVariables
Maybe DangerouslyCollapseBooleans
Maybe ExtensionsSchema
Maybe CorsConfig
Maybe PersistedQueriesState
Maybe CloseWebsocketsOnMetadataChangeStatus
Maybe TriggersErrorLogLevelStatus
Maybe ApolloFederationStatus
Maybe TraceQueryStatus
Maybe LogLevel
Maybe JWTConfig
Maybe AdminSecretHash
Maybe MetadataDefaults
Maybe WSConnectionInitTimeout
Maybe KeepAliveDelay
Maybe OptionalInterval
Maybe Port
Maybe TelemetryStatus
Maybe AdminInternalErrorsStatus
CompressionOptions
RemoteSchemaPermissions
StringifyNumbers
MaintenanceMode ()
HttpLogQueryOnlyOnError
MetadataQueryLoggingMode
ConnParamsRaw
AuthHookRaw
WsReadCookieStatus
DevModeStatus
AllowListStatus
ConsoleStatus
rsoPort :: Maybe Port
rsoHost :: Maybe HostPreference
rsoConnParams :: ConnParamsRaw
rsoTxIso :: Maybe TxIsolation
rsoAdminSecret :: Maybe AdminSecretHash
rsoAuthHook :: AuthHookRaw
rsoJwtSecret :: Maybe JWTConfig
rsoUnAuthRole :: Maybe RoleName
rsoCorsConfig :: Maybe CorsConfig
rsoConsoleStatus :: ConsoleStatus
rsoConsoleAssetsDir :: Maybe Text
rsoConsoleSentryDsn :: Maybe Text
rsoEnableTelemetry :: Maybe TelemetryStatus
rsoWsReadCookie :: WsReadCookieStatus
rsoStringifyNum :: StringifyNumbers
rsoDangerousBooleanCollapse :: Maybe DangerouslyCollapseBooleans
rsoBackwardsCompatibleNullInNonNullableVariables :: Maybe BackwardsCompatibleNullInNonNullableVariables
rsoRemoteNullForwardingPolicy :: Maybe RemoteNullForwardingPolicy
rsoEnabledAPIs :: Maybe (HashSet API)
rsoMxRefetchInt :: Maybe RefetchInterval
rsoMxBatchSize :: Maybe BatchSize
rsoStreamingMxRefetchInt :: Maybe RefetchInterval
rsoStreamingMxBatchSize :: Maybe BatchSize
rsoEnableAllowList :: AllowListStatus
rsoEnabledLogTypes :: Maybe (HashSet (EngineLogType impl))
rsoLogLevel :: Maybe LogLevel
rsoDevMode :: DevModeStatus
rsoAdminInternalErrors :: Maybe AdminInternalErrorsStatus
rsoEventsHttpPoolSize :: Maybe (Refined Positive Int)
rsoEventsFetchInterval :: Maybe (Refined NonNegative Milliseconds)
rsoAsyncActionsFetchInterval :: Maybe OptionalInterval
rsoEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
rsoWebSocketCompression :: CompressionOptions
rsoWebSocketKeepAlive :: Maybe KeepAliveDelay
rsoInferFunctionPermissions :: Maybe InferFunctionPermissions
rsoEnableMaintenanceMode :: MaintenanceMode ()
rsoSchemaPollInterval :: Maybe OptionalInterval
rsoExperimentalFeatures :: Maybe (HashSet ExperimentalFeature)
rsoEventsFetchBatchSize :: Maybe (Refined NonNegative Int)
rsoGracefulShutdownTimeout :: Maybe (Refined NonNegative Seconds)
rsoWebSocketConnectionInitTimeout :: Maybe WSConnectionInitTimeout
rsoEnableMetadataQueryLoggingEnv :: MetadataQueryLoggingMode
rsoHttpLogQueryOnlyOnError :: HttpLogQueryOnlyOnError
rsoDefaultNamingConvention :: Maybe NamingCase
rsoExtensionsSchema :: Maybe ExtensionsSchema
rsoMetadataDefaults :: Maybe MetadataDefaults
rsoApolloFederationStatus :: Maybe ApolloFederationStatus
rsoCloseWebsocketsOnMetadataChangeStatus :: Maybe CloseWebsocketsOnMetadataChangeStatus
rsoMaxTotalHeaderLength :: Maybe Int
rsoTriggersErrorLogLevelStatus :: Maybe TriggersErrorLogLevelStatus
rsoAsyncActionsFetchBatchSize :: Maybe Int
rsoPersistedQueries :: Maybe PersistedQueriesState
rsoPersistedQueriesTtl :: Maybe Int
rsoTraceQueryStatus :: Maybe TraceQueryStatus
rsoTraceQueryStatus :: forall impl. ServeOptionsRaw impl -&gt; Maybe TraceQueryStatus
rsoPersistedQueriesTtl :: forall impl. ServeOptionsRaw impl -&gt; Maybe Int
rsoPersistedQueries :: forall impl. ServeOptionsRaw impl -&gt; Maybe PersistedQueriesState
rsoAsyncActionsFetchBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe Int
rsoTriggersErrorLogLevelStatus :: forall impl.
ServeOptionsRaw impl -&gt; Maybe TriggersErrorLogLevelStatus
rsoMaxTotalHeaderLength :: forall impl. ServeOptionsRaw impl -&gt; Maybe Int
rsoCloseWebsocketsOnMetadataChangeStatus :: forall impl.
ServeOptionsRaw impl -&gt; Maybe CloseWebsocketsOnMetadataChangeStatus
rsoApolloFederationStatus :: forall impl. ServeOptionsRaw impl -&gt; Maybe ApolloFederationStatus
rsoMetadataDefaults :: forall impl. ServeOptionsRaw impl -&gt; Maybe MetadataDefaults
rsoExtensionsSchema :: forall impl. ServeOptionsRaw impl -&gt; Maybe ExtensionsSchema
rsoDefaultNamingConvention :: forall impl. ServeOptionsRaw impl -&gt; Maybe NamingCase
rsoHttpLogQueryOnlyOnError :: forall impl. ServeOptionsRaw impl -&gt; HttpLogQueryOnlyOnError
rsoEnableMetadataQueryLoggingEnv :: forall impl. ServeOptionsRaw impl -&gt; MetadataQueryLoggingMode
rsoWebSocketConnectionInitTimeout :: forall impl. ServeOptionsRaw impl -&gt; Maybe WSConnectionInitTimeout
rsoGracefulShutdownTimeout :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Seconds)
rsoEventsFetchBatchSize :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Int)
rsoExperimentalFeatures :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (HashSet ExperimentalFeature)
rsoSchemaPollInterval :: forall impl. ServeOptionsRaw impl -&gt; Maybe OptionalInterval
rsoEnableMaintenanceMode :: forall impl. ServeOptionsRaw impl -&gt; MaintenanceMode ()
rsoInferFunctionPermissions :: forall impl. ServeOptionsRaw impl -&gt; Maybe InferFunctionPermissions
rsoWebSocketKeepAlive :: forall impl. ServeOptionsRaw impl -&gt; Maybe KeepAliveDelay
rsoWebSocketCompression :: forall impl. ServeOptionsRaw impl -&gt; CompressionOptions
rsoEnableRemoteSchemaPermissions :: forall impl. ServeOptionsRaw impl -&gt; RemoteSchemaPermissions
rsoAsyncActionsFetchInterval :: forall impl. ServeOptionsRaw impl -&gt; Maybe OptionalInterval
rsoEventsFetchInterval :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Milliseconds)
rsoEventsHttpPoolSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe (Refined Positive Int)
rsoAdminInternalErrors :: forall impl.
ServeOptionsRaw impl -&gt; Maybe AdminInternalErrorsStatus
rsoDevMode :: forall impl. ServeOptionsRaw impl -&gt; DevModeStatus
rsoLogLevel :: forall impl. ServeOptionsRaw impl -&gt; Maybe LogLevel
rsoEnabledLogTypes :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (HashSet (EngineLogType impl))
rsoEnableAllowList :: forall impl. ServeOptionsRaw impl -&gt; AllowListStatus
rsoStreamingMxBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe BatchSize
rsoStreamingMxRefetchInt :: forall impl. ServeOptionsRaw impl -&gt; Maybe RefetchInterval
rsoMxBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe BatchSize
rsoMxRefetchInt :: forall impl. ServeOptionsRaw impl -&gt; Maybe RefetchInterval
rsoEnabledAPIs :: forall impl. ServeOptionsRaw impl -&gt; Maybe (HashSet API)
rsoRemoteNullForwardingPolicy :: forall impl.
ServeOptionsRaw impl -&gt; Maybe RemoteNullForwardingPolicy
rsoBackwardsCompatibleNullInNonNullableVariables :: forall impl.
ServeOptionsRaw impl
-&gt; Maybe BackwardsCompatibleNullInNonNullableVariables
rsoDangerousBooleanCollapse :: forall impl.
ServeOptionsRaw impl -&gt; Maybe DangerouslyCollapseBooleans
rsoStringifyNum :: forall impl. ServeOptionsRaw impl -&gt; StringifyNumbers
rsoWsReadCookie :: forall impl. ServeOptionsRaw impl -&gt; WsReadCookieStatus
rsoEnableTelemetry :: forall impl. ServeOptionsRaw impl -&gt; Maybe TelemetryStatus
rsoConsoleSentryDsn :: forall impl. ServeOptionsRaw impl -&gt; Maybe Text
rsoConsoleAssetsDir :: forall impl. ServeOptionsRaw impl -&gt; Maybe Text
rsoConsoleStatus :: forall impl. ServeOptionsRaw impl -&gt; ConsoleStatus
rsoCorsConfig :: forall impl. ServeOptionsRaw impl -&gt; Maybe CorsConfig
rsoUnAuthRole :: forall impl. ServeOptionsRaw impl -&gt; Maybe RoleName
rsoJwtSecret :: forall impl. ServeOptionsRaw impl -&gt; Maybe JWTConfig
rsoAuthHook :: forall impl. ServeOptionsRaw impl -&gt; AuthHookRaw
rsoAdminSecret :: forall impl. ServeOptionsRaw impl -&gt; Maybe AdminSecretHash
rsoTxIso :: forall impl. ServeOptionsRaw impl -&gt; Maybe TxIsolation
rsoConnParams :: forall impl. ServeOptionsRaw impl -&gt; ConnParamsRaw
rsoHost :: forall impl. ServeOptionsRaw impl -&gt; Maybe HostPreference
rsoPort :: forall impl. ServeOptionsRaw impl -&gt; Maybe Port
</span><a href="#local-6989586621687871098"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>  </span><span id="local-6989586621687871206"><span class="annot"><a href="#local-6989586621687871206"><span class="hs-identifier hs-var">soPort</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Port -&gt; Option Port -&gt; WithEnvT Identity Port
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Port
</span><a href="#local-6989586621687871098"><span class="hs-identifier hs-var">rsoPort</span></a></span><span> </span><span class="annot"><span class="annottext">Option Port
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#servePortOption"><span class="hs-identifier hs-var">servePortOption</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span id="local-6989586621687871209"><span class="annot"><a href="#local-6989586621687871209"><span class="hs-identifier hs-var">soHost</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871099"><span class="hs-identifier hs-type">rsoHost</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#serveHostOption"><span class="hs-identifier hs-type">serveHostOption</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621687871211"><span class="annot"><a href="#local-6989586621687871211"><span class="hs-identifier hs-var">soConnParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html#mkConnParams"><span class="hs-identifier hs-type">mkConnParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871100"><span class="hs-identifier hs-type">rsoConnParams</span></a></span><span>
</span><span id="line-157"></span><span>  </span><span id="local-6989586621687871213"><span class="annot"><a href="#local-6989586621687871213"><span class="hs-identifier hs-var">soTxIso</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871101"><span class="hs-identifier hs-type">rsoTxIso</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#txIsolationOption"><span class="hs-identifier hs-type">txIsolationOption</span></a></span><span>
</span><span id="line-158"></span><span>  </span><span id="local-6989586621687871215"><span class="annot"><a href="#local-6989586621687871215"><span class="hs-identifier hs-var">soAdminSecret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#singleton"><span class="hs-identifier hs-type">HashSet.singleton</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptions"><span class="hs-identifier hs-type">withOptions</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871102"><span class="hs-identifier hs-type">rsoAdminSecret</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#adminSecretOption"><span class="hs-identifier hs-type">adminSecretOption</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#accessKeyOption"><span class="hs-identifier hs-type">accessKeyOption</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-159"></span><span>  </span><span id="local-6989586621687871221"><span class="annot"><a href="#local-6989586621687871221"><span class="hs-identifier hs-var">soAuthHook</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html#mkAuthHook"><span class="hs-identifier hs-type">mkAuthHook</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871103"><span class="hs-identifier hs-type">rsoAuthHook</span></a></span><span>
</span><span id="line-160"></span><span>  </span><span id="local-6989586621687871223"><span class="annot"><a href="#local-6989586621687871223"><span class="hs-identifier hs-var">soJwtSecret</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">maybeToList</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-type">withOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871104"><span class="hs-identifier hs-type">rsoJwtSecret</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#jwtSecretOption"><span class="hs-identifier hs-type">jwtSecretOption</span></a></span><span>
</span><span id="line-161"></span><span>  </span><span id="local-6989586621687871226"><span class="annot"><a href="#local-6989586621687871226"><span class="hs-identifier hs-var">soUnAuthRole</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-type">withOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871105"><span class="hs-identifier hs-type">rsoUnAuthRole</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#unAuthRoleOption"><span class="hs-identifier hs-type">unAuthRoleOption</span></a></span><span>
</span><span id="line-162"></span><span>  </span><span id="local-6989586621687871228"><span class="annot"><a href="#local-6989586621687871228"><span class="hs-identifier hs-var">soCorsConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.html#mkCorsConfig"><span class="hs-identifier hs-type">mkCorsConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871097"><span class="hs-identifier hs-type">sor</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871106"><span class="hs-identifier hs-type">rsoCorsConfig</span></a></span><span>
</span><span id="line-163"></span><span>  </span><span id="local-6989586621687871230"><span class="annot"><a href="#local-6989586621687871230"><span class="hs-identifier hs-var">soConsoleStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionSwitch%27"><span class="hs-identifier hs-type">withOptionSwitch'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871107"><span class="hs-identifier hs-type">rsoConsoleStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#isConsoleEnabled"><span class="hs-identifier hs-type">isConsoleEnabled</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">bool</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ConsoleDisabled"><span class="hs-identifier hs-type">ConsoleDisabled</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ConsoleEnabled"><span class="hs-identifier hs-type">ConsoleEnabled</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableConsoleOption"><span class="hs-identifier hs-type">enableConsoleOption</span></a></span><span>
</span><span id="line-164"></span><span>  </span><span id="local-6989586621687871237"><span class="annot"><a href="#local-6989586621687871237"><span class="hs-identifier hs-var">soConsoleAssetsDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-type">withOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871108"><span class="hs-identifier hs-type">rsoConsoleAssetsDir</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#consoleAssetsDirOption"><span class="hs-identifier hs-type">consoleAssetsDirOption</span></a></span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621687871239"><span class="annot"><a href="#local-6989586621687871239"><span class="hs-identifier hs-var">soConsoleSentryDsn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-type">withOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871109"><span class="hs-identifier hs-type">rsoConsoleSentryDsn</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#consoleSentryDsnOption"><span class="hs-identifier hs-type">consoleSentryDsnOption</span></a></span><span>
</span><span id="line-166"></span><span>  </span><span id="local-6989586621687871241"><span class="annot"><a href="#local-6989586621687871241"><span class="hs-identifier hs-var">soEnableTelemetry</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871110"><span class="hs-identifier hs-type">rsoEnableTelemetry</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableTelemetryOption"><span class="hs-identifier hs-type">enableTelemetryOption</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span id="local-6989586621687871243"><span class="annot"><a href="#local-6989586621687871243"><span class="hs-identifier hs-var">soStringifyNum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-168"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871112"><span class="hs-identifier hs-type">rsoStringifyNum</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="Hasura.RQL.Types.Schema.Options.html#Don%27tStringifyNumbers"><span class="hs-identifier hs-var">Options.Don'tStringifyNumbers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe StringifyNumbers
-&gt; Option StringifyNumbers -&gt; WithEnvT Identity StringifyNumbers
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StringifyNumbers
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option StringifyNumbers
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#stringifyNumOption"><span class="hs-identifier hs-var">stringifyNumOption</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span id="local-6989586621687871246"><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621687871246"><span class="hs-identifier hs-var">stringifyNums</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StringifyNumbers -&gt; WithEnvT Identity StringifyNumbers
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">StringifyNumbers
</span><a href="#local-6989586621687871246"><span class="hs-identifier hs-var">stringifyNums</span></a></span><span>
</span><span id="line-171"></span><span>  </span><span id="local-6989586621687871247"><span class="annot"><a href="#local-6989586621687871247"><span class="hs-identifier hs-var">soDangerousBooleanCollapse</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871113"><span class="hs-identifier hs-type">rsoDangerousBooleanCollapse</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#dangerousBooleanCollapseOption"><span class="hs-identifier hs-type">dangerousBooleanCollapseOption</span></a></span><span>
</span><span id="line-172"></span><span>  </span><span id="local-6989586621687871249"><span class="annot"><a href="#local-6989586621687871249"><span class="hs-identifier hs-var">soBackwardsCompatibleNullInNonNullableVariables</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871114"><span class="hs-identifier hs-type">rsoBackwardsCompatibleNullInNonNullableVariables</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#backwardsCompatibleNullInNonNullableVariablesOption"><span class="hs-identifier hs-type">backwardsCompatibleNullInNonNullableVariablesOption</span></a></span><span>
</span><span id="line-173"></span><span>  </span><span id="local-6989586621687871251"><span class="annot"><a href="#local-6989586621687871251"><span class="hs-identifier hs-var">soRemoteNullForwardingPolicy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871115"><span class="hs-identifier hs-type">rsoRemoteNullForwardingPolicy</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#remoteNullForwardingPolicyOption"><span class="hs-identifier hs-type">remoteNullForwardingPolicyOption</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621687871253"><span class="annot"><a href="#local-6989586621687871253"><span class="hs-identifier hs-var">soEnabledAPIs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871116"><span class="hs-identifier hs-type">rsoEnabledAPIs</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#enabledAPIsOption"><span class="hs-identifier hs-type">enabledAPIsOption</span></a></span><span>
</span><span id="line-175"></span><span>  </span><span id="local-6989586621687871255"><span class="annot"><a href="#local-6989586621687871255"><span class="hs-identifier hs-var">soLiveQueryOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621687871256"><span class="annot"><a href="#local-6989586621687871256"><span class="hs-identifier hs-var">_lqoRefetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871117"><span class="hs-identifier hs-type">rsoMxRefetchInt</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#mxRefetchDelayOption"><span class="hs-identifier hs-type">mxRefetchDelayOption</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621687871258"><span class="annot"><a href="#local-6989586621687871258"><span class="hs-identifier hs-var">_lqoBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871118"><span class="hs-identifier hs-type">rsoMxBatchSize</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#mxBatchSizeOption"><span class="hs-identifier hs-type">mxBatchSizeOption</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html#SubscriptionsOptions"><span class="hs-identifier hs-type">Subscription.Options.SubscriptionsOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="#local-6989586621687871256"><span class="hs-glyph hs-type hs-type hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-179"></span><span>  </span><span id="local-6989586621687871263"><span class="annot"><a href="#local-6989586621687871263"><span class="hs-identifier hs-var">soStreamingQueryOpts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621687871264"><span class="annot"><a href="#local-6989586621687871264"><span class="hs-identifier hs-var">_lqoRefetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871119"><span class="hs-identifier hs-type">rsoStreamingMxRefetchInt</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#streamingMxRefetchDelayOption"><span class="hs-identifier hs-type">streamingMxRefetchDelayOption</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621687871266"><span class="annot"><a href="#local-6989586621687871266"><span class="hs-identifier hs-var">_lqoBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871120"><span class="hs-identifier hs-type">rsoStreamingMxBatchSize</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#streamingMxBatchSizeOption"><span class="hs-identifier hs-type">streamingMxBatchSizeOption</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html#SubscriptionsOptions"><span class="hs-identifier hs-type">Subscription.Options.SubscriptionsOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Hasura.GraphQL.Execute.Subscription.Options.html#_lqoRefetchInterval"><span class="hs-glyph hs-var hs-var hs-type hs-type">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-183"></span><span>  </span><span id="local-6989586621687871268"><span class="annot"><a href="#local-6989586621687871268"><span class="hs-identifier hs-var">soEnableAllowList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionSwitch%27"><span class="hs-identifier hs-type">withOptionSwitch'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871121"><span class="hs-identifier hs-type">rsoEnableAllowList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#isAllowListEnabled"><span class="hs-identifier hs-type">isAllowListEnabled</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">bool</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#AllowListDisabled"><span class="hs-identifier hs-type">AllowListDisabled</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#AllowListEnabled"><span class="hs-identifier hs-type">AllowListEnabled</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableAllowlistOption"><span class="hs-identifier hs-type">enableAllowlistOption</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span id="local-6989586621687871273"><span class="annot"><a href="#local-6989586621687871273"><span class="hs-identifier hs-var">soEnabledLogTypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871122"><span class="hs-identifier hs-type">rsoEnabledLogTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#enabledLogsOption"><span class="hs-identifier hs-type">enabledLogsOption</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621687870564"><span class="hs-identifier hs-type">impl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>  </span><span id="local-6989586621687871275"><span class="annot"><a href="#local-6989586621687871275"><span class="hs-identifier hs-var">soLogLevel</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871123"><span class="hs-identifier hs-type">rsoLogLevel</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#logLevelOption"><span class="hs-identifier hs-type">logLevelOption</span></a></span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621687871277"><span class="annot"><a href="#local-6989586621687871277"><span class="hs-identifier hs-var">soDevMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionSwitch%27"><span class="hs-identifier hs-type">withOptionSwitch'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871124"><span class="hs-identifier hs-type">rsoDevMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#isDevModeEnabled"><span class="hs-identifier hs-type">isDevModeEnabled</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">bool</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#DevModeDisabled"><span class="hs-identifier hs-type">DevModeDisabled</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#DevModeEnabled"><span class="hs-identifier hs-type">DevModeEnabled</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlDevModeOption"><span class="hs-identifier hs-type">graphqlDevModeOption</span></a></span><span>
</span><span id="line-187"></span><span>  </span><span id="local-6989586621687871282"><span class="annot"><a href="#local-6989586621687871282"><span class="hs-identifier hs-var">soAdminInternalErrors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871125"><span class="hs-identifier hs-type">rsoAdminInternalErrors</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlAdminInternalErrorsOption"><span class="hs-identifier hs-type">graphqlAdminInternalErrorsOption</span></a></span><span>
</span><span id="line-188"></span><span>  </span><span id="local-6989586621687871284"><span class="annot"><a href="#local-6989586621687871284"><span class="hs-identifier hs-var">soEventsHttpPoolSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871126"><span class="hs-identifier hs-type">rsoEventsHttpPoolSize</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlEventsHttpPoolSizeOption"><span class="hs-identifier hs-type">graphqlEventsHttpPoolSizeOption</span></a></span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621687871286"><span class="annot"><a href="#local-6989586621687871286"><span class="hs-identifier hs-var">soEventsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871127"><span class="hs-identifier hs-type">rsoEventsFetchInterval</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#graphqlEventsFetchIntervalOption"><span class="hs-identifier hs-type">graphqlEventsFetchIntervalOption</span></a></span><span>
</span><span id="line-190"></span><span>  </span><span id="local-6989586621687871288"><span class="annot"><a href="#local-6989586621687871288"><span class="hs-identifier hs-var">soAsyncActionsFetchInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871128"><span class="hs-identifier hs-type">rsoAsyncActionsFetchInterval</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#asyncActionsFetchIntervalOption"><span class="hs-identifier hs-type">asyncActionsFetchIntervalOption</span></a></span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621687871290"><span class="annot"><a href="#local-6989586621687871290"><span class="hs-identifier hs-var">soEnableRemoteSchemaPermissions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871129"><span class="hs-identifier hs-type">rsoEnableRemoteSchemaPermissions</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>      </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="Hasura.RQL.Types.Schema.Options.html#DisableRemoteSchemaPermissions"><span class="hs-identifier hs-var">Options.DisableRemoteSchemaPermissions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe RemoteSchemaPermissions
-&gt; Option RemoteSchemaPermissions
-&gt; WithEnvT Identity RemoteSchemaPermissions
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe RemoteSchemaPermissions
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option RemoteSchemaPermissions
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableRemoteSchemaPermsOption"><span class="hs-identifier hs-var">enableRemoteSchemaPermsOption</span></a></span><span>
</span><span id="line-194"></span><span>      </span><span id="local-6989586621687871293"><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621687871293"><span class="hs-identifier hs-var">enableRemoteSchemaPermissions</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
-&gt; WithEnvT Identity RemoteSchemaPermissions
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaPermissions
</span><a href="#local-6989586621687871293"><span class="hs-identifier hs-var">enableRemoteSchemaPermissions</span></a></span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621687871294"><span class="annot"><a href="#local-6989586621687871294"><span class="hs-identifier hs-var">webSocketCompressionFromEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionSwitch%27"><span class="hs-identifier hs-type">withOptionSwitch'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871130"><span class="hs-identifier hs-type">rsoWebSocketCompression</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#isWebSocketCompressionEnabled"><span class="hs-identifier hs-type">isWebSocketCompressionEnabled</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">bool</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/websockets-0.13.0.0-2cd899d4b3466ebf052047c238a83c60318de1a150acea53b7173aee9736fdbb/share/doc/html/src/Network.WebSockets.Connection.Options.html/Network.WebSockets.Connection.Options.html#NoCompression"><span class="hs-identifier hs-type">WebSockets.NoCompression</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/websockets-0.13.0.0-2cd899d4b3466ebf052047c238a83c60318de1a150acea53b7173aee9736fdbb/share/doc/html/src/Network.WebSockets.Connection.Options.html/Network.WebSockets.Connection.Options.html#PermessageDeflateCompression"><span class="hs-identifier hs-type">WebSockets.PermessageDeflateCompression</span></a></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/websockets-0.13.0.0-2cd899d4b3466ebf052047c238a83c60318de1a150acea53b7173aee9736fdbb/share/doc/html/src/Network.WebSockets.Connection.Options.html/Network.WebSockets.Connection.Options.html#defaultPermessageDeflate"><span class="hs-identifier hs-type">WebSockets.defaultPermessageDeflate</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketCompressionOption"><span class="hs-identifier hs-type">webSocketCompressionOption</span></a></span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687871300"><span class="annot"><a href="#local-6989586621687871300"><span class="hs-identifier hs-var hs-var">soConnectionOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConnectionOptions
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/websockets-0.13.0.0-2cd899d4b3466ebf052047c238a83c60318de1a150acea53b7173aee9736fdbb/share/doc/html/src/Network.WebSockets.Connection.Options.html/Network.WebSockets.Connection.Options.html#defaultConnectionOptions"><span class="hs-identifier hs-var">WebSockets.defaultConnectionOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/websockets-0.13.0.0-2cd899d4b3466ebf052047c238a83c60318de1a150acea53b7173aee9736fdbb/share/doc/html/src/Network.WebSockets.Connection.Options.html/Network.WebSockets.Connection.Options.html#connectionCompressionOptions"><span class="hs-identifier hs-var">WebSockets.connectionCompressionOptions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621687871294"><span class="hs-identifier hs-type">webSocketCompressionFromEnv</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>  </span><span id="local-6989586621687871303"><span class="annot"><a href="#local-6989586621687871303"><span class="hs-identifier hs-var">soWebSocketKeepAlive</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871131"><span class="hs-identifier hs-type">rsoWebSocketKeepAlive</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketKeepAliveOption"><span class="hs-identifier hs-type">webSocketKeepAliveOption</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span id="local-6989586621687871305"><span class="annot"><a href="#local-6989586621687871305"><span class="hs-identifier hs-var">soInferFunctionPermissions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871132"><span class="hs-identifier hs-type">rsoInferFunctionPermissions</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#inferFunctionPermsOption"><span class="hs-identifier hs-type">inferFunctionPermsOption</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span id="local-6989586621687871307"><span class="annot"><a href="#local-6989586621687871307"><span class="hs-identifier hs-var">soEnableMaintenanceMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871133"><span class="hs-identifier hs-type">rsoEnableMaintenanceMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-201"></span><span>    </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="Hasura.Server.Types.html#MaintenanceModeDisabled"><span class="hs-identifier hs-var">Types.MaintenanceModeDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (MaintenanceMode ())
-&gt; Option (MaintenanceMode ())
-&gt; WithEnvT Identity (MaintenanceMode ())
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (MaintenanceMode ())
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option (MaintenanceMode ())
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableMaintenanceModeOption"><span class="hs-identifier hs-var">enableMaintenanceModeOption</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621687871310"><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621687871310"><span class="hs-identifier hs-var">maintenanceModeEnabled</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MaintenanceMode () -&gt; WithEnvT Identity (MaintenanceMode ())
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MaintenanceMode ()
</span><a href="#local-6989586621687871310"><span class="hs-identifier hs-var">maintenanceModeEnabled</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621687871311"><span class="annot"><a href="#local-6989586621687871311"><span class="hs-identifier hs-var">soSchemaPollInterval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871134"><span class="hs-identifier hs-type">rsoSchemaPollInterval</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#schemaPollIntervalOption"><span class="hs-identifier hs-type">schemaPollIntervalOption</span></a></span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621687871313"><span class="annot"><a href="#local-6989586621687871313"><span class="hs-identifier hs-var">soExperimentalFeatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871135"><span class="hs-identifier hs-type">rsoExperimentalFeatures</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#experimentalFeaturesOption"><span class="hs-identifier hs-type">experimentalFeaturesOption</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621687871315"><span class="annot"><a href="#local-6989586621687871315"><span class="hs-identifier hs-var">soEventsFetchBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871136"><span class="hs-identifier hs-type">rsoEventsFetchBatchSize</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#eventsFetchBatchSizeOption"><span class="hs-identifier hs-type">eventsFetchBatchSizeOption</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621687871317"><span class="annot"><a href="#local-6989586621687871317"><span class="hs-identifier hs-var">soGracefulShutdownTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871137"><span class="hs-identifier hs-type">rsoGracefulShutdownTimeout</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#gracefulShutdownOption"><span class="hs-identifier hs-type">gracefulShutdownOption</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span id="local-6989586621687871319"><span class="annot"><a href="#local-6989586621687871319"><span class="hs-identifier hs-var">soWebSocketConnectionInitTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871138"><span class="hs-identifier hs-type">rsoWebSocketConnectionInitTimeout</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#webSocketConnectionInitTimeoutOption"><span class="hs-identifier hs-type">webSocketConnectionInitTimeoutOption</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687871321"><span class="annot"><a href="#local-6989586621687871321"><span class="hs-identifier hs-var hs-var">soEventingMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventingMode
</span><a href="Hasura.Server.Types.html#EventingEnabled"><span class="hs-identifier hs-var">Types.EventingEnabled</span></a></span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687871323"><span class="annot"><a href="#local-6989586621687871323"><span class="hs-identifier hs-var hs-var">soReadOnlyMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReadOnlyMode
</span><a href="Hasura.Server.Types.html#ReadOnlyModeDisabled"><span class="hs-identifier hs-var">Types.ReadOnlyModeDisabled</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621687871325"><span class="annot"><a href="#local-6989586621687871325"><span class="hs-identifier hs-var">soEnableMetadataQueryLogging</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871139"><span class="hs-identifier hs-type">rsoEnableMetadataQueryLoggingEnv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="Hasura.Server.Logging.html#MetadataQueryLoggingDisabled"><span class="hs-identifier hs-var">Server.Logging.MetadataQueryLoggingDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe MetadataQueryLoggingMode
-&gt; Option MetadataQueryLoggingMode
-&gt; WithEnvT Identity MetadataQueryLoggingMode
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataQueryLoggingMode
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option MetadataQueryLoggingMode
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#enableMetadataQueryLoggingOption"><span class="hs-identifier hs-var">enableMetadataQueryLoggingOption</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621687871328"><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621687871328"><span class="hs-identifier hs-var">metadataQueryLoggingEnabled</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
-&gt; WithEnvT Identity MetadataQueryLoggingMode
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">MetadataQueryLoggingMode
</span><a href="#local-6989586621687871328"><span class="hs-identifier hs-var">metadataQueryLoggingEnabled</span></a></span><span>
</span><span id="line-213"></span><span>  </span><span id="local-6989586621687871329"><span class="annot"><a href="#local-6989586621687871329"><span class="hs-identifier hs-var">soHttpLogQueryOnlyOnError</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871140"><span class="hs-identifier hs-type">rsoHttpLogQueryOnlyOnError</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">HttpLogQueryOnlyOnError
</span><a href="Hasura.Server.Logging.html#HttpLogQueryOnlyOnErrorDisabled"><span class="hs-identifier hs-var">Server.Logging.HttpLogQueryOnlyOnErrorDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe HttpLogQueryOnlyOnError
-&gt; Option HttpLogQueryOnlyOnError
-&gt; WithEnvT Identity HttpLogQueryOnlyOnError
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HttpLogQueryOnlyOnError
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option HttpLogQueryOnlyOnError
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#httpLogQueryOnlyOnErrorOption"><span class="hs-identifier hs-var">httpLogQueryOnlyOnErrorOption</span></a></span><span>
</span><span id="line-215"></span><span>    </span><span id="local-6989586621687871332"><span class="annot"><span class="annottext">HttpLogQueryOnlyOnError
</span><a href="#local-6989586621687871332"><span class="hs-identifier hs-var">httpLogQueryOnlyOnError</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HttpLogQueryOnlyOnError
-&gt; WithEnvT Identity HttpLogQueryOnlyOnError
forall a. a -&gt; WithEnvT Identity a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HttpLogQueryOnlyOnError
</span><a href="#local-6989586621687871332"><span class="hs-identifier hs-var">httpLogQueryOnlyOnError</span></a></span><span>
</span><span id="line-216"></span><span>  </span><span id="local-6989586621687871333"><span class="annot"><a href="#local-6989586621687871333"><span class="hs-identifier hs-var">soDefaultNamingConvention</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871141"><span class="hs-identifier hs-type">rsoDefaultNamingConvention</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#defaultNamingConventionOption"><span class="hs-identifier hs-type">defaultNamingConventionOption</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span id="local-6989586621687871335"><span class="annot"><a href="#local-6989586621687871335"><span class="hs-identifier hs-var">soMetadataDefaults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871143"><span class="hs-identifier hs-type">rsoMetadataDefaults</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#metadataDefaultsOption"><span class="hs-identifier hs-type">metadataDefaultsOption</span></a></span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621687871337"><span class="annot"><a href="#local-6989586621687871337"><span class="hs-identifier hs-var">soExtensionsSchema</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871142"><span class="hs-identifier hs-type">rsoExtensionsSchema</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#metadataDBExtensionsSchemaOption"><span class="hs-identifier hs-type">metadataDBExtensionsSchemaOption</span></a></span><span>
</span><span id="line-219"></span><span>  </span><span id="local-6989586621687871339"><span class="annot"><a href="#local-6989586621687871339"><span class="hs-identifier hs-var">soApolloFederationStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621687871340"><span class="annot"><a href="#local-6989586621687871340"><span class="hs-identifier hs-var">apolloFederationStatusOptionM</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621687871144"><span class="hs-identifier hs-type">rsoApolloFederationStatus</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#apolloFederationStatusOption"><span class="hs-identifier hs-type">apolloFederationStatusOption</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.GraphQL.ApolloFederation.html#getApolloFederationStatus"><span class="hs-identifier hs-type">getApolloFederationStatus</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871313"><span class="hs-identifier hs-type">soExperimentalFeatures</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871340"><span class="hs-identifier hs-type">apolloFederationStatusOptionM</span></a></span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621687871342"><span class="annot"><a href="#local-6989586621687871342"><span class="hs-identifier hs-var">soCloseWebsocketsOnMetadataChangeStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871145"><span class="hs-identifier hs-type">rsoCloseWebsocketsOnMetadataChangeStatus</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#closeWebsocketsOnMetadataChangeOption"><span class="hs-identifier hs-type">closeWebsocketsOnMetadataChangeOption</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621687871344"><span class="annot"><a href="#local-6989586621687871344"><span class="hs-identifier hs-var">soMaxTotalHeaderLength</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871146"><span class="hs-identifier hs-type">rsoMaxTotalHeaderLength</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#maxTotalHeaderLengthOption"><span class="hs-identifier hs-type">maxTotalHeaderLengthOption</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621687871346"><span class="annot"><a href="#local-6989586621687871346"><span class="hs-identifier hs-var">soTriggersErrorLogLevelStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871147"><span class="hs-identifier hs-type">rsoTriggersErrorLogLevelStatus</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#triggersErrorLogLevelStatusOption"><span class="hs-identifier hs-type">triggersErrorLogLevelStatusOption</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span id="local-6989586621687871348"><span class="annot"><a href="#local-6989586621687871348"><span class="hs-identifier hs-var">soAsyncActionsFetchBatchSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871148"><span class="hs-identifier hs-type">rsoAsyncActionsFetchBatchSize</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#asyncActionsFetchBatchSizeOption"><span class="hs-identifier hs-type">asyncActionsFetchBatchSizeOption</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span id="local-6989586621687871350"><span class="annot"><a href="#local-6989586621687871350"><span class="hs-identifier hs-var">soPersistedQueries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871149"><span class="hs-identifier hs-type">rsoPersistedQueries</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#persistedQueriesOption"><span class="hs-identifier hs-type">persistedQueriesOption</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span id="local-6989586621687871352"><span class="annot"><a href="#local-6989586621687871352"><span class="hs-identifier hs-var">soPersistedQueriesTtl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871150"><span class="hs-identifier hs-type">rsoPersistedQueriesTtl</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#persistedQueriesTtlOption"><span class="hs-identifier hs-type">persistedQueriesTtlOption</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621687871354"><span class="annot"><a href="#local-6989586621687871354"><span class="hs-identifier hs-var">soTraceQueryStatus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871151"><span class="hs-identifier hs-type">rsoTraceQueryStatus</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#traceQueryStatusOption"><span class="hs-identifier hs-type">traceQueryStatusOption</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptions"><span class="hs-identifier hs-type">ServeOptions</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="#local-6989586621687871206"><span class="hs-glyph hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-231"></span><span>
</span><span id="line-232"></span><span class="hs-comment">-- | Fetch Postgres 'Query.ConnParams' components from the environment</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- and merge with the values consumed by the arg parser in</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- 'ConnParamsRaw'.</span><span>
</span><span id="line-235"></span><span id="local-6989586621687870693"><span class="annot"><a href="Hasura.Server.Init.html#mkConnParams"><span class="hs-identifier hs-type">mkConnParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687870693"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ConnParamsRaw"><span class="hs-identifier hs-type">ConnParamsRaw</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnvT"><span class="hs-identifier hs-type">WithEnvT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870693"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Pool.html/Database.PG.Query.Pool.html#ConnParams"><span class="hs-identifier hs-type">Query.ConnParams</span></a></span></span><span>
</span><span id="line-236"></span><span id="mkConnParams"><span class="annot"><span class="annottext">mkConnParams :: forall (m :: * -&gt; *).
Monad m =&gt;
ConnParamsRaw -&gt; WithEnvT m ConnParams
</span><a href="Hasura.Server.Init.html#mkConnParams"><span class="hs-identifier hs-var hs-var">mkConnParams</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ConnParamsRaw"><span class="hs-identifier hs-type">ConnParamsRaw</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687871457"><span id="local-6989586621687871458"><span id="local-6989586621687871459"><span id="local-6989586621687871460"><span id="local-6989586621687871461"><span id="local-6989586621687871462"><span class="annot"><span class="annottext">Maybe Bool
Maybe (Refined NonNegative Int)
Maybe (Refined NonNegative NominalDiffTime)
rcpStripes :: Maybe (Refined NonNegative Int)
rcpConns :: Maybe (Refined NonNegative Int)
rcpIdleTime :: Maybe (Refined NonNegative Int)
rcpConnLifetime :: Maybe (Refined NonNegative NominalDiffTime)
rcpAllowPrepare :: Maybe Bool
rcpPoolTimeout :: Maybe (Refined NonNegative NominalDiffTime)
rcpPoolTimeout :: ConnParamsRaw -&gt; Maybe (Refined NonNegative NominalDiffTime)
rcpAllowPrepare :: ConnParamsRaw -&gt; Maybe Bool
rcpConnLifetime :: ConnParamsRaw -&gt; Maybe (Refined NonNegative NominalDiffTime)
rcpIdleTime :: ConnParamsRaw -&gt; Maybe (Refined NonNegative Int)
rcpConns :: ConnParamsRaw -&gt; Maybe (Refined NonNegative Int)
rcpStripes :: ConnParamsRaw -&gt; Maybe (Refined NonNegative Int)
</span><a href="#local-6989586621687871457"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>  </span><span id="local-6989586621687871469"><span class="annot"><a href="#local-6989586621687871469"><span class="hs-identifier hs-var">cpStripes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Refined NonNegative Int -&gt; Int
forall {k} (p :: k) x. Refined p x -&gt; x
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/refined-0.8.2-0dcf4cad4ded3c586f9b24c73216dddc25503a45bf2f48d52c9d10964a9a8deb/share/doc/html/src/Refined.html/Refined.html#unrefine"><span class="hs-identifier hs-var">unrefine</span></a></span><span> </span><span class="annot"><span class="annottext">(Refined NonNegative Int -&gt; Int)
-&gt; WithEnvT m (Refined NonNegative Int) -&gt; WithEnvT m Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
-&gt; Option (Refined NonNegative Int)
-&gt; WithEnvT m (Refined NonNegative Int)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Refined NonNegative Int)
</span><a href="#local-6989586621687871457"><span class="hs-identifier hs-var">rcpStripes</span></a></span><span> </span><span class="annot"><span class="annottext">Option (Refined NonNegative Int)
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgStripesOption"><span class="hs-identifier hs-var">pgStripesOption</span></a></span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-comment">-- Note: by Little's Law we can expect e.g. (with 50 max connections) a</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-comment">-- hard throughput cap at 1000RPS when db queries take 50ms on average:</span><span>
</span><span id="line-240"></span><span>  </span><span id="local-6989586621687871471"><span class="annot"><a href="#local-6989586621687871471"><span class="hs-identifier hs-var">cpConns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/refined-0.8.2-0dcf4cad4ded3c586f9b24c73216dddc25503a45bf2f48d52c9d10964a9a8deb/share/doc/html/src/Refined.html/Refined.html#unrefine"><span class="hs-identifier hs-type">unrefine</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871458"><span class="hs-identifier hs-type">rcpConns</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgConnsOption"><span class="hs-identifier hs-type">pgConnsOption</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span id="local-6989586621687871473"><span class="annot"><a href="#local-6989586621687871473"><span class="hs-identifier hs-var">cpIdleTime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/refined-0.8.2-0dcf4cad4ded3c586f9b24c73216dddc25503a45bf2f48d52c9d10964a9a8deb/share/doc/html/src/Refined.html/Refined.html#unrefine"><span class="hs-identifier hs-type">unrefine</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871459"><span class="hs-identifier hs-type">rcpIdleTime</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgTimeoutOption"><span class="hs-identifier hs-type">pgTimeoutOption</span></a></span><span>
</span><span id="line-242"></span><span>  </span><span id="local-6989586621687871475"><span class="annot"><a href="#local-6989586621687871475"><span class="hs-identifier hs-var">cpAllowPrepare</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871461"><span class="hs-identifier hs-type">rcpAllowPrepare</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgUsePreparedStatementsOption"><span class="hs-identifier hs-type">pgUsePreparedStatementsOption</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-comment">-- TODO: Add newtype to allow this:</span><span>
</span><span id="line-244"></span><span>  </span><span id="local-6989586621687871477"><span class="annot"><a href="#local-6989586621687871477"><span class="hs-identifier hs-var">cpMbLifetime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>    </span><span id="local-6989586621687871478"><span class="annot"><a href="#local-6989586621687871478"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/refined-0.8.2-0dcf4cad4ded3c586f9b24c73216dddc25503a45bf2f48d52c9d10964a9a8deb/share/doc/html/src/Refined.html/Refined.html#unrefine"><span class="hs-identifier hs-type">unrefine</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871460"><span class="hs-identifier hs-type">rcpConnLifetime</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgConnLifetimeOption"><span class="hs-identifier hs-type">pgConnLifetimeOption</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621687871478"><span class="hs-identifier hs-type">lifetime</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">==</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-247"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-248"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621687871478"><span class="hs-identifier hs-type">lifetime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621687871480"><span class="annot"><a href="#local-6989586621687871480"><span class="hs-identifier hs-var">cpTimeout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/refined-0.8.2-0dcf4cad4ded3c586f9b24c73216dddc25503a45bf2f48d52c9d10964a9a8deb/share/doc/html/src/Refined.html/Refined.html#unrefine"><span class="hs-identifier hs-type">unrefine</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-type">withOption</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871462"><span class="hs-identifier hs-type">rcpPoolTimeout</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#pgPoolTimeoutOption"><span class="hs-identifier hs-type">pgPoolTimeoutOption</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687871482"><span class="annot"><a href="#local-6989586621687871482"><span class="hs-identifier hs-var hs-var">cpCancel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-251"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/pg-client-0.1.0/opt/doc/html/pg-client/src/Database.PG.Query.Pool.html/Database.PG.Query.Pool.html#ConnParams"><span class="hs-identifier hs-type">Query.ConnParams</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="#local-6989586621687871469"><span class="hs-glyph hs-type hs-type hs-type hs-type hs-type hs-type hs-type hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">-- | Fetch 'Auth.AuthHook' components from the environment and merge</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- with the values consumed by the arg parser in 'AuthHookRaw'.</span><span>
</span><span id="line-256"></span><span id="local-6989586621687870701"><span class="annot"><a href="Hasura.Server.Init.html#mkAuthHook"><span class="hs-identifier hs-type">mkAuthHook</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687870701"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#AuthHookRaw"><span class="hs-identifier hs-type">AuthHookRaw</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnvT"><span class="hs-identifier hs-type">WithEnvT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870701"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Auth.WebHook.html#AuthHook"><span class="hs-identifier hs-type">Auth.AuthHook</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-257"></span><span id="mkAuthHook"><span class="annot"><span class="annottext">mkAuthHook :: forall (m :: * -&gt; *).
Monad m =&gt;
AuthHookRaw -&gt; WithEnvT m (Maybe AuthHook)
</span><a href="Hasura.Server.Init.html#mkAuthHook"><span class="hs-identifier hs-var hs-var">mkAuthHook</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#AuthHookRaw"><span class="hs-identifier hs-type">AuthHookRaw</span></a></span><span> </span><span id="local-6989586621687871512"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687871512"><span class="hs-identifier hs-var">mUrl</span></a></span></span><span> </span><span id="local-6989586621687871513"><span class="annot"><span class="annottext">Maybe AuthHookType
</span><a href="#local-6989586621687871513"><span class="hs-identifier hs-var">mType</span></a></span></span><span> </span><span id="local-6989586621687871514"><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621687871514"><span class="hs-identifier hs-var">mSendRequestBody</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>  </span><span id="local-6989586621687871515"><span class="annot"><a href="#local-6989586621687871515"><span class="hs-identifier hs-var">mUrlEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Text -&gt; Option () -&gt; WithEnvT m (Maybe Text)
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option () -&gt; WithEnvT m (Maybe option)
</span><a href="Hasura.Server.Init.Env.html#withOption"><span class="hs-identifier hs-var">withOption</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621687871512"><span class="hs-identifier hs-var">mUrl</span></a></span><span> </span><span class="annot"><span class="annottext">Option ()
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookOption"><span class="hs-identifier hs-var">authHookOption</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-comment">-- Also support HASURA_GRAPHQL_AUTH_HOOK_TYPE</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-comment">-- TODO (from master):- drop this in next major update &lt;--- (NOTE: This comment is from 2020-08-21)</span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621687871517"><span class="annot"><a href="#local-6989586621687871517"><span class="hs-identifier hs-var">authMode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-type">onNothing</span></a></span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><a href="#local-6989586621687871513"><span class="hs-identifier hs-type">mType</span></a></span><span>
</span><span id="line-264"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Init.Config.html#_default"><span class="hs-identifier hs-var">_default</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookModeOption"><span class="hs-identifier hs-type">authHookModeOption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>          </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#considerEnvs"><span class="hs-identifier hs-type">considerEnvs</span></a></span><span>
</span><span id="line-266"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.Server.Init.Config.html#_envVar"><span class="hs-identifier hs-var">_envVar</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookModeOption"><span class="hs-identifier hs-type">authHookModeOption</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;HASURA_GRAPHQL_AUTH_HOOK_TYPE&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-comment">-- if authMode is `GET` then authSendRequestBody is set to `False`, otherwise we check for the config value</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621687871523"><span class="annot"><a href="#local-6989586621687871523"><span class="hs-identifier hs-var">authSendRequestBody</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871517"><span class="hs-identifier hs-type">authMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>      </span><span class="annot"><span class="annottext">AuthHookType
</span><a href="Hasura.Server.Auth.WebHook.html#AHTGet"><span class="hs-identifier hs-var">Auth.AHTGet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; WithEnvT m Bool
forall a. a -&gt; WithEnvT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-272"></span><span>      </span><span class="annot"><span class="annottext">AuthHookType
</span><a href="Hasura.Server.Auth.WebHook.html#AHTPost"><span class="hs-identifier hs-var">Auth.AHTPost</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-273"></span><span>        </span><span class="annot"><span class="annottext">Maybe Bool -&gt; WithEnvT m Bool -&gt; WithEnvT m Bool
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span>
</span><span id="line-274"></span><span>          </span><span class="annot"><span class="annottext">Maybe Bool
</span><a href="#local-6989586621687871514"><span class="hs-identifier hs-var">mSendRequestBody</span></a></span><span>
</span><span id="line-275"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool -&gt; Bool
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Option Bool -&gt; Bool
forall def. Option def -&gt; def
</span><a href="Hasura.Server.Init.Config.html#_default"><span class="hs-identifier hs-var">_default</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookSendRequestBodyOption"><span class="hs-identifier hs-var">authHookSendRequestBodyOption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>              </span><span class="annot"><span class="annottext">(Maybe Bool -&gt; Bool) -&gt; WithEnvT m (Maybe Bool) -&gt; WithEnvT m Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; WithEnvT m (Maybe Bool)
forall (m :: * -&gt; *) a.
(Monad m, FromEnv a) =&gt;
[String] -&gt; WithEnvT m (Maybe a)
</span><a href="Hasura.Server.Init.Env.html#considerEnvs"><span class="hs-identifier hs-var">considerEnvs</span></a></span><span>
</span><span id="line-277"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Option Bool -&gt; String
forall def. Option def -&gt; String
</span><a href="Hasura.Server.Init.Config.html#_envVar"><span class="hs-identifier hs-var">_envVar</span></a></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#authHookSendRequestBodyOption"><span class="hs-identifier hs-var">authHookSendRequestBodyOption</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-278"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621687871527"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687871527"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AuthHookType -&gt; Bool -&gt; AuthHook
</span><a href="Hasura.Server.Auth.WebHook.html#AuthHook"><span class="hs-identifier hs-var">Auth.AuthHook</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621687871527"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">AuthHookType
</span><a href="#local-6989586621687871517"><span class="hs-identifier hs-var">authMode</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621687871523"><span class="hs-identifier hs-var">authSendRequestBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621687871515"><span class="hs-identifier hs-type">mUrlEnv</span></a></span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="hs-comment">-- | Fetch 'Cors.CorsConfig' settings from the environment and merge</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- with the settings consumed by the arg parser.</span><span>
</span><span id="line-283"></span><span id="local-6989586621687870703"><span id="local-6989586621687870704"><span class="annot"><a href="Hasura.Server.Init.html#mkCorsConfig"><span class="hs-identifier hs-type">mkCorsConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621687870703"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870704"><span class="hs-identifier hs-type">imp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Server.Cors.html#CorsConfig"><span class="hs-identifier hs-type">Cors.CorsConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#WithEnvT"><span class="hs-identifier hs-type">WithEnvT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687870703"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Cors.html#CorsConfig"><span class="hs-identifier hs-type">Cors.CorsConfig</span></a></span></span></span><span>
</span><span id="line-284"></span><span id="mkCorsConfig"><span class="annot"><span class="annottext">mkCorsConfig :: forall (m :: * -&gt; *) imp.
Monad m =&gt;
ServeOptionsRaw imp -&gt; Maybe CorsConfig -&gt; WithEnvT m CorsConfig
</span><a href="Hasura.Server.Init.html#mkCorsConfig"><span class="hs-identifier hs-var hs-var">mkCorsConfig</span></a></span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#ServeOptionsRaw"><span class="hs-identifier hs-type">ServeOptionsRaw</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687871553"><span id="local-6989586621687871554"><span id="local-6989586621687871555"><span id="local-6989586621687871556"><span id="local-6989586621687871557"><span id="local-6989586621687871558"><span id="local-6989586621687871559"><span id="local-6989586621687871560"><span id="local-6989586621687871561"><span id="local-6989586621687871562"><span id="local-6989586621687871563"><span id="local-6989586621687871564"><span id="local-6989586621687871565"><span id="local-6989586621687871566"><span id="local-6989586621687871567"><span id="local-6989586621687871568"><span id="local-6989586621687871569"><span id="local-6989586621687871570"><span id="local-6989586621687871571"><span id="local-6989586621687871572"><span id="local-6989586621687871573"><span id="local-6989586621687871574"><span id="local-6989586621687871575"><span id="local-6989586621687871576"><span id="local-6989586621687871577"><span id="local-6989586621687871578"><span id="local-6989586621687871579"><span id="local-6989586621687871580"><span id="local-6989586621687871581"><span id="local-6989586621687871582"><span id="local-6989586621687871583"><span id="local-6989586621687871584"><span id="local-6989586621687871585"><span id="local-6989586621687871586"><span id="local-6989586621687871587"><span id="local-6989586621687871588"><span id="local-6989586621687871589"><span id="local-6989586621687871590"><span id="local-6989586621687871591"><span id="local-6989586621687871592"><span id="local-6989586621687871593"><span id="local-6989586621687871594"><span id="local-6989586621687871595"><span id="local-6989586621687871596"><span id="local-6989586621687871597"><span id="local-6989586621687871598"><span id="local-6989586621687871599"><span id="local-6989586621687871600"><span id="local-6989586621687871601"><span id="local-6989586621687871602"><span id="local-6989586621687871603"><span id="local-6989586621687871604"><span id="local-6989586621687871605"><span id="local-6989586621687871606"><span class="annot"><span class="annottext">Maybe Int
Maybe Text
Maybe HostPreference
Maybe (HashSet ExperimentalFeature)
Maybe (HashSet (EngineLogType imp))
Maybe (HashSet API)
Maybe TxIsolation
Maybe (Refined NonNegative Int)
Maybe (Refined NonNegative Milliseconds)
Maybe (Refined NonNegative Seconds)
Maybe (Refined Positive Int)
Maybe RoleName
Maybe RefetchInterval
Maybe BatchSize
Maybe NamingCase
Maybe InferFunctionPermissions
Maybe RemoteNullForwardingPolicy
Maybe BackwardsCompatibleNullInNonNullableVariables
Maybe DangerouslyCollapseBooleans
Maybe ExtensionsSchema
Maybe CorsConfig
Maybe PersistedQueriesState
Maybe CloseWebsocketsOnMetadataChangeStatus
Maybe TriggersErrorLogLevelStatus
Maybe ApolloFederationStatus
Maybe TraceQueryStatus
Maybe LogLevel
Maybe JWTConfig
Maybe AdminSecretHash
Maybe MetadataDefaults
Maybe WSConnectionInitTimeout
Maybe KeepAliveDelay
Maybe OptionalInterval
Maybe Port
Maybe TelemetryStatus
Maybe AdminInternalErrorsStatus
CompressionOptions
RemoteSchemaPermissions
StringifyNumbers
MaintenanceMode ()
HttpLogQueryOnlyOnError
MetadataQueryLoggingMode
ConnParamsRaw
AuthHookRaw
WsReadCookieStatus
DevModeStatus
AllowListStatus
ConsoleStatus
rsoTraceQueryStatus :: forall impl. ServeOptionsRaw impl -&gt; Maybe TraceQueryStatus
rsoPersistedQueriesTtl :: forall impl. ServeOptionsRaw impl -&gt; Maybe Int
rsoPersistedQueries :: forall impl. ServeOptionsRaw impl -&gt; Maybe PersistedQueriesState
rsoAsyncActionsFetchBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe Int
rsoTriggersErrorLogLevelStatus :: forall impl.
ServeOptionsRaw impl -&gt; Maybe TriggersErrorLogLevelStatus
rsoMaxTotalHeaderLength :: forall impl. ServeOptionsRaw impl -&gt; Maybe Int
rsoCloseWebsocketsOnMetadataChangeStatus :: forall impl.
ServeOptionsRaw impl -&gt; Maybe CloseWebsocketsOnMetadataChangeStatus
rsoApolloFederationStatus :: forall impl. ServeOptionsRaw impl -&gt; Maybe ApolloFederationStatus
rsoMetadataDefaults :: forall impl. ServeOptionsRaw impl -&gt; Maybe MetadataDefaults
rsoExtensionsSchema :: forall impl. ServeOptionsRaw impl -&gt; Maybe ExtensionsSchema
rsoDefaultNamingConvention :: forall impl. ServeOptionsRaw impl -&gt; Maybe NamingCase
rsoHttpLogQueryOnlyOnError :: forall impl. ServeOptionsRaw impl -&gt; HttpLogQueryOnlyOnError
rsoEnableMetadataQueryLoggingEnv :: forall impl. ServeOptionsRaw impl -&gt; MetadataQueryLoggingMode
rsoWebSocketConnectionInitTimeout :: forall impl. ServeOptionsRaw impl -&gt; Maybe WSConnectionInitTimeout
rsoGracefulShutdownTimeout :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Seconds)
rsoEventsFetchBatchSize :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Int)
rsoExperimentalFeatures :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (HashSet ExperimentalFeature)
rsoSchemaPollInterval :: forall impl. ServeOptionsRaw impl -&gt; Maybe OptionalInterval
rsoEnableMaintenanceMode :: forall impl. ServeOptionsRaw impl -&gt; MaintenanceMode ()
rsoInferFunctionPermissions :: forall impl. ServeOptionsRaw impl -&gt; Maybe InferFunctionPermissions
rsoWebSocketKeepAlive :: forall impl. ServeOptionsRaw impl -&gt; Maybe KeepAliveDelay
rsoWebSocketCompression :: forall impl. ServeOptionsRaw impl -&gt; CompressionOptions
rsoEnableRemoteSchemaPermissions :: forall impl. ServeOptionsRaw impl -&gt; RemoteSchemaPermissions
rsoAsyncActionsFetchInterval :: forall impl. ServeOptionsRaw impl -&gt; Maybe OptionalInterval
rsoEventsFetchInterval :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (Refined NonNegative Milliseconds)
rsoEventsHttpPoolSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe (Refined Positive Int)
rsoAdminInternalErrors :: forall impl.
ServeOptionsRaw impl -&gt; Maybe AdminInternalErrorsStatus
rsoDevMode :: forall impl. ServeOptionsRaw impl -&gt; DevModeStatus
rsoLogLevel :: forall impl. ServeOptionsRaw impl -&gt; Maybe LogLevel
rsoEnabledLogTypes :: forall impl.
ServeOptionsRaw impl -&gt; Maybe (HashSet (EngineLogType impl))
rsoEnableAllowList :: forall impl. ServeOptionsRaw impl -&gt; AllowListStatus
rsoStreamingMxBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe BatchSize
rsoStreamingMxRefetchInt :: forall impl. ServeOptionsRaw impl -&gt; Maybe RefetchInterval
rsoMxBatchSize :: forall impl. ServeOptionsRaw impl -&gt; Maybe BatchSize
rsoMxRefetchInt :: forall impl. ServeOptionsRaw impl -&gt; Maybe RefetchInterval
rsoEnabledAPIs :: forall impl. ServeOptionsRaw impl -&gt; Maybe (HashSet API)
rsoRemoteNullForwardingPolicy :: forall impl.
ServeOptionsRaw impl -&gt; Maybe RemoteNullForwardingPolicy
rsoBackwardsCompatibleNullInNonNullableVariables :: forall impl.
ServeOptionsRaw impl
-&gt; Maybe BackwardsCompatibleNullInNonNullableVariables
rsoDangerousBooleanCollapse :: forall impl.
ServeOptionsRaw impl -&gt; Maybe DangerouslyCollapseBooleans
rsoStringifyNum :: forall impl. ServeOptionsRaw impl -&gt; StringifyNumbers
rsoWsReadCookie :: forall impl. ServeOptionsRaw impl -&gt; WsReadCookieStatus
rsoEnableTelemetry :: forall impl. ServeOptionsRaw impl -&gt; Maybe TelemetryStatus
rsoConsoleSentryDsn :: forall impl. ServeOptionsRaw impl -&gt; Maybe Text
rsoConsoleAssetsDir :: forall impl. ServeOptionsRaw impl -&gt; Maybe Text
rsoConsoleStatus :: forall impl. ServeOptionsRaw impl -&gt; ConsoleStatus
rsoCorsConfig :: forall impl. ServeOptionsRaw impl -&gt; Maybe CorsConfig
rsoUnAuthRole :: forall impl. ServeOptionsRaw impl -&gt; Maybe RoleName
rsoJwtSecret :: forall impl. ServeOptionsRaw impl -&gt; Maybe JWTConfig
rsoAuthHook :: forall impl. ServeOptionsRaw impl -&gt; AuthHookRaw
rsoAdminSecret :: forall impl. ServeOptionsRaw impl -&gt; Maybe AdminSecretHash
rsoTxIso :: forall impl. ServeOptionsRaw impl -&gt; Maybe TxIsolation
rsoConnParams :: forall impl. ServeOptionsRaw impl -&gt; ConnParamsRaw
rsoHost :: forall impl. ServeOptionsRaw impl -&gt; Maybe HostPreference
rsoPort :: forall impl. ServeOptionsRaw impl -&gt; Maybe Port
rsoPort :: Maybe Port
rsoHost :: Maybe HostPreference
rsoConnParams :: ConnParamsRaw
rsoTxIso :: Maybe TxIsolation
rsoAdminSecret :: Maybe AdminSecretHash
rsoAuthHook :: AuthHookRaw
rsoJwtSecret :: Maybe JWTConfig
rsoUnAuthRole :: Maybe RoleName
rsoCorsConfig :: Maybe CorsConfig
rsoConsoleStatus :: ConsoleStatus
rsoConsoleAssetsDir :: Maybe Text
rsoConsoleSentryDsn :: Maybe Text
rsoEnableTelemetry :: Maybe TelemetryStatus
rsoWsReadCookie :: WsReadCookieStatus
rsoStringifyNum :: StringifyNumbers
rsoDangerousBooleanCollapse :: Maybe DangerouslyCollapseBooleans
rsoBackwardsCompatibleNullInNonNullableVariables :: Maybe BackwardsCompatibleNullInNonNullableVariables
rsoRemoteNullForwardingPolicy :: Maybe RemoteNullForwardingPolicy
rsoEnabledAPIs :: Maybe (HashSet API)
rsoMxRefetchInt :: Maybe RefetchInterval
rsoMxBatchSize :: Maybe BatchSize
rsoStreamingMxRefetchInt :: Maybe RefetchInterval
rsoStreamingMxBatchSize :: Maybe BatchSize
rsoEnableAllowList :: AllowListStatus
rsoEnabledLogTypes :: Maybe (HashSet (EngineLogType imp))
rsoLogLevel :: Maybe LogLevel
rsoDevMode :: DevModeStatus
rsoAdminInternalErrors :: Maybe AdminInternalErrorsStatus
rsoEventsHttpPoolSize :: Maybe (Refined Positive Int)
rsoEventsFetchInterval :: Maybe (Refined NonNegative Milliseconds)
rsoAsyncActionsFetchInterval :: Maybe OptionalInterval
rsoEnableRemoteSchemaPermissions :: RemoteSchemaPermissions
rsoWebSocketCompression :: CompressionOptions
rsoWebSocketKeepAlive :: Maybe KeepAliveDelay
rsoInferFunctionPermissions :: Maybe InferFunctionPermissions
rsoEnableMaintenanceMode :: MaintenanceMode ()
rsoSchemaPollInterval :: Maybe OptionalInterval
rsoExperimentalFeatures :: Maybe (HashSet ExperimentalFeature)
rsoEventsFetchBatchSize :: Maybe (Refined NonNegative Int)
rsoGracefulShutdownTimeout :: Maybe (Refined NonNegative Seconds)
rsoWebSocketConnectionInitTimeout :: Maybe WSConnectionInitTimeout
rsoEnableMetadataQueryLoggingEnv :: MetadataQueryLoggingMode
rsoHttpLogQueryOnlyOnError :: HttpLogQueryOnlyOnError
rsoDefaultNamingConvention :: Maybe NamingCase
rsoExtensionsSchema :: Maybe ExtensionsSchema
rsoMetadataDefaults :: Maybe MetadataDefaults
rsoApolloFederationStatus :: Maybe ApolloFederationStatus
rsoCloseWebsocketsOnMetadataChangeStatus :: Maybe CloseWebsocketsOnMetadataChangeStatus
rsoMaxTotalHeaderLength :: Maybe Int
rsoTriggersErrorLogLevelStatus :: Maybe TriggersErrorLogLevelStatus
rsoAsyncActionsFetchBatchSize :: Maybe Int
rsoPersistedQueries :: Maybe PersistedQueriesState
rsoPersistedQueriesTtl :: Maybe Int
rsoTraceQueryStatus :: Maybe TraceQueryStatus
</span><a href="Hasura.Server.Init.Config.html#rsoTraceQueryStatus"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621687871607"><span class="annot"><span class="annottext">Maybe CorsConfig
</span><a href="#local-6989586621687871607"><span class="hs-identifier hs-var">mCfg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621687871608"><span class="annot"><a href="#local-6989586621687871608"><span class="hs-identifier hs-var">corsCfg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621687871609"><span class="annot"><a href="#local-6989586621687871609"><span class="hs-identifier hs-var">corsDisabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Option Bool -&gt; WithEnvT m Bool
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Bool
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option Bool
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#disableCorsOption"><span class="hs-identifier hs-var">disableCorsOption</span></a></span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><a href="#local-6989586621687871609"><span class="hs-identifier hs-type">corsDisabled</span></a></span><span>
</span><span id="line-288"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-type">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Config.html#_default"><span class="hs-identifier hs-var">_default</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#disableCorsOption"><span class="hs-identifier hs-type">disableCorsOption</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-type">withOptionDefault</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871607"><span class="hs-identifier hs-type">mCfg</span></a></span><span> </span><span class="annot"><a href="Hasura.Server.Init.Arg.Command.Serve.html#corsDomainOption"><span class="hs-identifier hs-type">corsDomainOption</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span id="local-6989586621687871613"><span class="annot"><a href="#local-6989586621687871613"><span class="hs-identifier hs-var">readCookVal</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871566"><span class="hs-identifier hs-type">rsoWsReadCookie</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-292"></span><span>      </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="Hasura.Server.Init.Config.html#WsReadCookieDisabled"><span class="hs-identifier hs-var">WsReadCookieDisabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe WsReadCookieStatus
-&gt; Option WsReadCookieStatus -&gt; WithEnvT m WsReadCookieStatus
forall (m :: * -&gt; *) option.
(Monad m, FromEnv option) =&gt;
Maybe option -&gt; Option option -&gt; WithEnvT m option
</span><a href="Hasura.Server.Init.Env.html#withOptionDefault"><span class="hs-identifier hs-var">withOptionDefault</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe WsReadCookieStatus
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">Option WsReadCookieStatus
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#wsReadCookieOption"><span class="hs-identifier hs-var">wsReadCookieOption</span></a></span><span>
</span><span id="line-293"></span><span>      </span><span id="local-6989586621687871616"><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="#local-6989586621687871616"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus -&gt; WithEnvT m WsReadCookieStatus
forall a. a -&gt; WithEnvT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="#local-6989586621687871616"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-294"></span><span>  </span><span id="local-6989586621687871617"><span class="annot"><a href="#local-6989586621687871617"><span class="hs-identifier hs-var">wsReadCookie</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Cors.html#isCorsDisabled"><span class="hs-identifier hs-type">Cors.isCorsDisabled</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687871608"><span class="hs-identifier hs-type">corsCfg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621687871613"><span class="hs-identifier hs-type">readCookVal</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus -&gt; WithEnvT m WsReadCookieStatus
forall a. a -&gt; WithEnvT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="#local-6989586621687871613"><span class="hs-identifier hs-var">readCookVal</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="Hasura.Server.Init.Config.html#WsReadCookieEnabled"><span class="hs-identifier hs-var">WsReadCookieEnabled</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-297"></span><span>      </span><span class="annot"><span class="annottext">String -&gt; WithEnvT m WsReadCookieStatus
forall a. String -&gt; WithEnvT m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-298"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; WithEnvT m WsReadCookieStatus)
-&gt; String -&gt; WithEnvT m WsReadCookieStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Option WsReadCookieStatus -&gt; String
forall def. Option def -&gt; String
</span><a href="Hasura.Server.Init.Config.html#_envVar"><span class="hs-identifier hs-var">_envVar</span></a></span><span> </span><span class="annot"><span class="annottext">Option WsReadCookieStatus
</span><a href="Hasura.Server.Init.Arg.Command.Serve.html#wsReadCookieOption"><span class="hs-identifier hs-var">wsReadCookieOption</span></a></span><span>
</span><span id="line-299"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; can only be used when CORS is disabled&quot;</span></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="Hasura.Server.Init.Config.html#WsReadCookieDisabled"><span class="hs-identifier hs-var">WsReadCookieDisabled</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus -&gt; WithEnvT m WsReadCookieStatus
forall a. a -&gt; WithEnvT m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="Hasura.Server.Init.Config.html#WsReadCookieDisabled"><span class="hs-identifier hs-var">WsReadCookieDisabled</span></a></span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621687871608"><span class="hs-identifier hs-type">corsCfg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-type">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; CorsConfig
</span><a href="Hasura.Server.Cors.html#CCDisabled"><span class="hs-identifier hs-var">Cors.CCDisabled</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; CorsConfig) -&gt; Bool -&gt; CorsConfig
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus -&gt; Bool
</span><a href="Hasura.Server.Init.Config.html#isWsReadCookieEnabled"><span class="hs-identifier hs-var">isWsReadCookieEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">WsReadCookieStatus
</span><a href="#local-6989586621687871617"><span class="hs-identifier hs-var">wsReadCookie</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">CorsConfig
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CorsConfig
</span><a href="#local-6989586621687871608"><span class="hs-identifier hs-var">corsCfg</span></a></span><span>
</span><span id="line-304"></span></pre></body></html>