<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html"><span class="hs-identifier">Hasura.RQL.DDL.Metadata</span></a></span><span>
</span><span id="line-2"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadata"><span class="hs-identifier">runReplaceMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2"><span class="hs-identifier">runReplaceMetadataV2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runExportMetadata"><span class="hs-identifier">runExportMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-5"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runExportMetadataV2"><span class="hs-identifier">runExportMetadataV2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runClearMetadata"><span class="hs-identifier">runClearMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReloadMetadata"><span class="hs-identifier">runReloadMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runDumpInternalState"><span class="hs-identifier">runDumpInternalState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runGetInconsistentMetadata"><span class="hs-identifier">runGetInconsistentMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runDropInconsistentMetadata"><span class="hs-identifier">runDropInconsistentMetadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runGetCatalogState"><span class="hs-identifier">runGetCatalogState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runSetCatalogState"><span class="hs-identifier">runSetCatalogState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runTestWebhookTransform"><span class="hs-identifier">runTestWebhookTransform</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runSetMetricsConfig"><span class="hs-identifier">runSetMetricsConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runRemoveMetricsConfig"><span class="hs-identifier">runRemoveMetricsConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html"><span class="hs-identifier">Hasura.RQL.DDL.Metadata.Types</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">where</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.html/Control.Lens.html"><span class="hs-identifier">Control.Lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#to"><span class="hs-identifier">to</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator">(.~)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator">(^.)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Fold.html/Control.Lens.Fold.html#%5E%3F"><span class="hs-operator">(^?)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html"><span class="hs-identifier">Control.Monad.Trans.Control</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier">MonadBaseControl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.html/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">J</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src/Data.Aeson.Ordered.html/Data.Aeson.Ordered.html"><span class="hs-identifier">Data.Aeson.Ordered</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AO</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/attoparsec-0.14.4-721a423332575cfaea849bb008ae3e4fa4a9b17020621984e1f9839d812448cb/share/doc/html/src/Data.Attoparsec.Text.html/Data.Attoparsec.Text.html"><span class="hs-identifier">Data.Attoparsec.Text</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AT</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bitraversable</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/case-insensitive-1.2.1.0-65ff744e416d3483f48f17f0840924ef454e127ea866e868409ab395a75d4bb7/share/doc/html/src/Data.CaseInsensitive.html/Data.CaseInsensitive.html"><span class="hs-identifier">Data.CaseInsensitive</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/ci-info-0.1.0.0/opt/doc/html/ci-info/src/CI.html/CI.html"><span class="hs-identifier">CI</span></a></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html/Data.Environment.html"><span class="hs-identifier">Data.Environment</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html"><span class="hs-identifier">Data.Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#Has"><span class="hs-identifier">Has</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#getter"><span class="hs-identifier">getter</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashMap.Strict.html/Data.HashMap.Strict.html"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.HashMap.Strict.InsOrd.Extended.html/Data.HashMap.Strict.InsOrd.Extended.html"><span class="hs-identifier">Data.HashMap.Strict.InsOrd.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InsOrdHashMap</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.html/Data.HashSet.html"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HS</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.List.Extended.html/Data.List.Extended.html"><span class="hs-identifier">Data.List.Extended</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.SerializableBlob.html/Data.SerializableBlob.html"><span class="hs-identifier">Data.SerializableBlob</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SB</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TE</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html"><span class="hs-identifier">Data.Text.Extended</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#dquote"><span class="hs-identifier">dquote</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#dquoteList"><span class="hs-identifier">dquoteList</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator">(&lt;&lt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html"><span class="hs-identifier">Hasura.EncJSON</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Eventing.Backend.html"><span class="hs-identifier">Hasura.Eventing.Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier">BackendEventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Function.API.html"><span class="hs-identifier">Hasura.Function.API</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Logging.html"><span class="hs-identifier">Hasura.Logging</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HL</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.LogicalModel.API.html"><span class="hs-identifier">Hasura.LogicalModel.API</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.LogicalModelResolver.Lenses.html"><span class="hs-identifier">Hasura.LogicalModelResolver.Lenses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModelResolver.Lenses.html#_LMIInlineLogicalModel"><span class="hs-identifier">_LMIInlineLogicalModel</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Metadata.Class.html"><span class="hs-identifier">Hasura.Metadata.Class</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.NativeQuery.API.html"><span class="hs-identifier">Hasura.NativeQuery.API</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.NativeQuery.Lenses.html"><span class="hs-identifier">Hasura.NativeQuery.Lenses</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.NativeQuery.Lenses.html#nqmReturns"><span class="hs-identifier">nqmReturns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Action.html"><span class="hs-identifier">Hasura.RQL.DDL.Action</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.ApiLimit.html"><span class="hs-identifier">Hasura.RQL.DDL.ApiLimit</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.ComputedField.html"><span class="hs-identifier">Hasura.RQL.DDL.ComputedField</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.CustomTypes.html"><span class="hs-identifier">Hasura.RQL.DDL.CustomTypes</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Endpoint.html"><span class="hs-identifier">Hasura.RQL.DDL.Endpoint</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.EventTrigger</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.InheritedRoles.html"><span class="hs-identifier">Hasura.RQL.DDL.InheritedRoles</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html"><span class="hs-identifier">Hasura.RQL.DDL.Metadata.Types</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Permission.html"><span class="hs-identifier">Hasura.RQL.DDL.Permission</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Relationship.html"><span class="hs-identifier">Hasura.RQL.DDL.Relationship</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.RemoteRelationship.html"><span class="hs-identifier">Hasura.RQL.DDL.RemoteRelationship</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.ScheduledTrigger.html"><span class="hs-identifier">Hasura.RQL.DDL.ScheduledTrigger</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Schema.Source.html"><span class="hs-identifier">Hasura.RQL.DDL.Schema.Source</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html"><span class="hs-identifier">Hasura.RQL.DDL.Warnings</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Webhook.Transform.html"><span class="hs-identifier">Hasura.RQL.DDL.Webhook.Transform</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html"><span class="hs-identifier">Hasura.RQL.Types.Allowlist</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ApiLimit.html"><span class="hs-identifier">Hasura.RQL.Types.ApiLimit</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html"><span class="hs-identifier">Hasura.RQL.Types.BackendType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#BackendType"><span class="hs-identifier">BackendType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html"><span class="hs-identifier">Hasura.RQL.Types.Common</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html"><span class="hs-identifier">Hasura.RQL.Types.Endpoint</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.EventTrigger</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.EventTrigger</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ET</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Backend</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html"><span class="hs-identifier">Hasura.RQL.Types.Metadata.Object</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html"><span class="hs-identifier">Hasura.RQL.Types.OpenTelemetry</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html"><span class="hs-identifier">Hasura.RQL.Types.QueryCollection</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html"><span class="hs-identifier">Hasura.RQL.Types.ScheduledTrigger</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html"><span class="hs-identifier">Hasura.RQL.Types.SchemaCache.Build</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Source.html"><span class="hs-identifier">Hasura.RQL.Types.Source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Source.html#unsafeSourceInfo"><span class="hs-identifier">unsafeSourceInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SourceCustomization.html"><span class="hs-identifier">Hasura.RQL.Types.SourceCustomization</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html"><span class="hs-identifier">Hasura.SQL.AnyBackend</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AB</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.SQL.BackendMap.html"><span class="hs-identifier">Hasura.SQL.BackendMap</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BackendMap</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Logging.html"><span class="hs-identifier">Hasura.Server.Logging</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Logging.html#MetadataLog"><span class="hs-identifier">MetadataLog</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Server.Types.html"><span class="hs-identifier">Hasura.Server.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier">MonadGetPolicies</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.StoredProcedure.API.html"><span class="hs-identifier">Hasura.StoredProcedure.API</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.StoredProcedure.API.html#dropStoredProcedureInMetadata"><span class="hs-identifier">dropStoredProcedureInMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Table.Metadata.html"><span class="hs-identifier">Hasura.Table.Metadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Table.Metadata.html#TableMetadata"><span class="hs-identifier">TableMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html"><span class="hs-identifier">Network.HTTP.Client.Transformable</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HTTP</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Types.Extended.html/Network.Types.Extended.html"><span class="hs-identifier">Network.Types.Extended</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="annot"><span class="hs-comment">-- | Helper function to run the post drop source hook</span></span><span>
</span><span id="line-96"></span><span id="local-6989586621688026545"><span id="local-6989586621688026549"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#postDropSourceHookHelper"><span class="hs-identifier hs-type">postDropSourceHookHelper</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621688026549"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026545"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">HL.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688026549"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#MonadWarnings"><span class="hs-identifier hs-type">MonadWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026545"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="#local-6989586621688026545"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-108"></span><span id="postDropSourceHookHelper"><span class="annot"><span class="annottext">postDropSourceHookHelper :: forall (m :: * -&gt; *) r.
(MonadError QErr m, MonadIO m, MonadBaseControl IO m,
 MonadReader r m, Has (Logger Hasura) r, MonadWarnings m) =&gt;
SchemaCache -&gt; SourceName -&gt; AnyBackend SourceMetadata -&gt; m ()
</span><a href="Hasura.RQL.DDL.Metadata.html#postDropSourceHookHelper"><span class="hs-identifier hs-var hs-var">postDropSourceHookHelper</span></a></span></span><span> </span><span id="local-6989586621688027340"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621688027340"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span></span><span> </span><span id="local-6989586621688027341"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027341"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621688027342"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621688027342"><span class="hs-identifier hs-var">sourceMetadataBackend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-109"></span><span>  </span><span id="local-6989586621688027343"><span class="annot"><a href="#local-6989586621688027343"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HL.Logger</span></span><span> </span><span class="annot"><span class="hs-identifier">HL.Hasura</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(r -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Logger Hasura
forall a t. Has a t =&gt; t -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#getter"><span class="hs-identifier hs-var">getter</span></a></span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-type">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027342"><span class="hs-identifier hs-type">sourceMetadataBackend</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688027381"><span id="local-6989586621688027382"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027382"><span class="hs-identifier hs-var">oldSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027381"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027383"><span class="annot"><span class="annottext">sourceInfoMaybe :: Maybe (SourceInfo b)
</span><a href="#local-6989586621688027383"><span class="hs-identifier hs-var hs-var">sourceInfoMaybe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
HasTag b =&gt;
BackendSourceInfo -&gt; Maybe (SourceInfo b)
</span><a href="Hasura.RQL.Types.Source.html#unsafeSourceInfo"><span class="hs-identifier hs-var">unsafeSourceInfo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688027381"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">(BackendSourceInfo -&gt; Maybe (SourceInfo b))
-&gt; Maybe BackendSourceInfo -&gt; Maybe (SourceInfo b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
-&gt; HashMap SourceName BackendSourceInfo -&gt; Maybe BackendSourceInfo
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashMap.Internal.html/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">HashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027341"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchemaCache -&gt; HashMap SourceName BackendSourceInfo
</span><a href="Hasura.RQL.Types.SchemaCache.html#scSources"><span class="hs-identifier hs-var">scSources</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621688027340"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SourceInfo b)
</span><a href="#local-6989586621688027383"><span class="hs-identifier hs-var">sourceInfoMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>      </span><span class="annot"><span class="annottext">Maybe (SourceInfo b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; Bool
forall a. InsOrdHashMap TriggerName a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall (b :: BackendType).
SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getTriggersMap"><span class="hs-identifier hs-var">getTriggersMap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027382"><span class="hs-identifier hs-var">oldSourceMetadata</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-116"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027390"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621688027390"><span class="hs-identifier hs-var hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>                </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Could not cleanup the source '&quot;</span></span><span>
</span><span id="line-118"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027341"><span class="hs-identifier hs-var">sourceName</span></a></span><span>
</span><span id="line-119"></span><span>                  </span><span class="annot"><span class="annottext">SourceName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;' while dropping it from the graphql-engine as it is inconsistent.&quot;</span></span><span>
</span><span id="line-120"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Please consider cleaning the resources created by the graphql engine,&quot;</span></span><span>
</span><span id="line-121"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; refer https://hasura.io/docs/latest/graphql/core/event-triggers/remove-event-triggers/#clean-footprints-manually&quot;</span></span><span>
</span><span id="line-122"></span><span>          </span><span class="annot"><span class="annottext">Logger Hasura
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a Hasura, MonadIO m) =&gt;
   a -&gt; m ()
forall impl.
Logger impl
-&gt; forall a (m :: * -&gt; *).
   (ToEngineLog a impl, MonadIO m) =&gt;
   a -&gt; m ()
</span><a href="Hasura.Logging.html#unLogger"><span class="hs-identifier hs-var">HL.unLogger</span></a></span><span> </span><span class="annot"><span class="annottext">Logger Hasura
</span><a href="#local-6989586621688027343"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataLog -&gt; m ()) -&gt; MetadataLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; Value -&gt; MetadataLog
</span><a href="Hasura.Server.Logging.html#MetadataLog"><span class="hs-identifier hs-var">MetadataLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">HL.LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688027390"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span>
</span><span id="line-123"></span><span>          </span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarning -&gt; m ()) -&gt; MetadataWarning -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WarningCode -&gt; MetadataObjId -&gt; Text -&gt; MetadataWarning
</span><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarning"><span class="hs-identifier hs-var">MetadataWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarningCode
</span><a href="Hasura.RQL.DDL.Warnings.html#WCSourceCleanupFailed"><span class="hs-identifier hs-var">WCSourceCleanupFailed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSource"><span class="hs-identifier hs-var">MOSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027341"><span class="hs-identifier hs-var">sourceName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688027390"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688027399"><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621688027399"><span class="hs-identifier hs-var">sourceInfo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceInfo b -&gt; m ()
forall (m :: * -&gt; *) r (b :: BackendType).
(MonadError QErr m, MonadIO m, MonadBaseControl IO m,
 MonadReader r m, Has (Logger Hasura) r, BackendMetadata b) =&gt;
SourceName -&gt; SourceInfo b -&gt; m ()
</span><a href="Hasura.RQL.DDL.Schema.Source.html#runPostDropSourceHook"><span class="hs-identifier hs-var">runPostDropSourceHook</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-var">defaultSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceInfo b
</span><a href="#local-6989586621688027399"><span class="hs-identifier hs-var">sourceInfo</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runClearMetadata"><span class="hs-identifier hs-type">runClearMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688026612"><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621688026616"><span class="annot"><a href="#local-6989586621688026616"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621688026616"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">HL.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688026616"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ClearMetadata"><span class="hs-identifier hs-type">ClearMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><a href="#local-6989586621688026612"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-141"></span><span id="runClearMetadata"><span class="annot"><span class="annottext">runClearMetadata :: forall (m :: * -&gt; *) r.
(MonadIO m, CacheRWM m, MetadataM m, MonadMetadataStorage m,
 MonadBaseControl IO m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m,
 MonadGetPolicies m) =&gt;
ClearMetadata -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runClearMetadata"><span class="hs-identifier hs-var hs-var">runClearMetadata</span></a></span></span><span> </span><span class="annot"><span class="annottext">ClearMetadata
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>  </span><span id="local-6989586621688027483"><span class="annot"><a href="#local-6989586621688027483"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Metadata
forall (m :: * -&gt; *). MetadataM m =&gt; m Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a></span><span>
</span><span id="line-143"></span><span>
</span><span id="line-144"></span><span>  </span><span id="local-6989586621688027485"><span class="annot"><a href="#local-6989586621688027485"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-type">askSchemaCache</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-comment">-- We can infer whether the server is started with `--database-url` option</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-comment">-- (or corresponding env variable) by checking the existence of @'defaultSource'</span><span>
</span><span id="line-148"></span><span>  </span><span class="hs-comment">-- in current metadata.</span><span>
</span><span id="line-149"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027487"><span class="annot"><a href="#local-6989586621688027487"><span class="hs-identifier hs-var hs-var">maybeDefaultSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027483"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
-&gt; Getting
     (First (AnyBackend SourceMetadata))
     Metadata
     (AnyBackend SourceMetadata)
-&gt; Maybe (AnyBackend SourceMetadata)
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Fold.html/Control.Lens.Fold.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">(Sources -&gt; Const (First (AnyBackend SourceMetadata)) Sources)
-&gt; Metadata -&gt; Const (First (AnyBackend SourceMetadata)) Metadata
Lens' Metadata Sources
</span><a href="Hasura.RQL.Types.Metadata.html#metaSources"><span class="hs-identifier hs-var">metaSources</span></a></span><span> </span><span class="annot"><span class="annottext">((Sources -&gt; Const (First (AnyBackend SourceMetadata)) Sources)
 -&gt; Metadata -&gt; Const (First (AnyBackend SourceMetadata)) Metadata)
-&gt; ((AnyBackend SourceMetadata
     -&gt; Const
          (First (AnyBackend SourceMetadata)) (AnyBackend SourceMetadata))
    -&gt; Sources -&gt; Const (First (AnyBackend SourceMetadata)) Sources)
-&gt; Getting
     (First (AnyBackend SourceMetadata))
     Metadata
     (AnyBackend SourceMetadata)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index Sources -&gt; Traversal' Sources (IxValue Sources)
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.At.html/Control.Lens.At.html#ix"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Index Sources
SourceName
</span><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-var">defaultSource</span></a></span><span> </span><span class="annot"><span class="annottext">((BackendSourceMetadata
  -&gt; Const (First (AnyBackend SourceMetadata)) BackendSourceMetadata)
 -&gt; Sources -&gt; Const (First (AnyBackend SourceMetadata)) Sources)
-&gt; ((AnyBackend SourceMetadata
     -&gt; Const
          (First (AnyBackend SourceMetadata)) (AnyBackend SourceMetadata))
    -&gt; BackendSourceMetadata
    -&gt; Const (First (AnyBackend SourceMetadata)) BackendSourceMetadata)
-&gt; (AnyBackend SourceMetadata
    -&gt; Const
         (First (AnyBackend SourceMetadata)) (AnyBackend SourceMetadata))
-&gt; Sources
-&gt; Const (First (AnyBackend SourceMetadata)) Sources
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(BackendSourceMetadata -&gt; AnyBackend SourceMetadata)
-&gt; (AnyBackend SourceMetadata
    -&gt; Const
         (First (AnyBackend SourceMetadata)) (AnyBackend SourceMetadata))
-&gt; BackendSourceMetadata
-&gt; Const (First (AnyBackend SourceMetadata)) BackendSourceMetadata
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; AnyBackend SourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendSourceMetadata"><span class="hs-identifier hs-var">unBackendSourceMetadata</span></a></span><span>
</span><span id="line-150"></span><span>      </span><span id="local-6989586621688027492"><span class="annot"><a href="#local-6989586621688027492"><span class="hs-identifier hs-var hs-var">emptyMetadata'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (AnyBackend SourceMetadata)
</span><a href="#local-6989586621688027487"><span class="hs-identifier hs-var">maybeDefaultSourceMetadata</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><span class="annottext">Maybe (AnyBackend SourceMetadata)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#emptyMetadata"><span class="hs-identifier hs-var">emptyMetadata</span></a></span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688027494"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621688027494"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>          </span><span class="hs-comment">-- If default postgres source is defined, we need to set metadata</span><span>
</span><span id="line-154"></span><span>          </span><span class="hs-comment">-- which contains only default source without any tables and functions.</span><span>
</span><span id="line-155"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027495"><span class="annot"><span class="annottext">emptyDefaultSource :: BackendSourceMetadata
</span><a href="#local-6989586621688027495"><span class="hs-identifier hs-var hs-var">emptyDefaultSource</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-156"></span><span>                </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621688027494"><span class="hs-identifier hs-var">exists</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688027521"><span id="local-6989586621688027522"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027522"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027521"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>                  </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata -&gt; BackendSourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-var">BackendSourceMetadata</span></a></span><span>
</span><span id="line-158"></span><span>                    </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadata -&gt; BackendSourceMetadata)
-&gt; AnyBackend SourceMetadata -&gt; BackendSourceMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688027521"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-159"></span><span>                    </span><span class="annot"><span class="annottext">(SourceMetadata b -&gt; AnyBackend SourceMetadata)
-&gt; SourceMetadata b -&gt; AnyBackend SourceMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceName
-&gt; BackendSourceKind b
-&gt; Tables b
-&gt; Functions b
-&gt; NativeQueries b
-&gt; StoredProcedures b
-&gt; LogicalModels b
-&gt; SourceConnConfiguration b
-&gt; Maybe QueryTagsConfig
-&gt; SourceCustomization
-&gt; Maybe (HealthCheckConfig b)
-&gt; SourceMetadata b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-var">SourceMetadata</span></a></span><span>
</span><span id="line-160"></span><span>                      </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688027521"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-161"></span><span>                      </span><span class="annot"><span class="annottext">SourceName
</span><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-var">defaultSource</span></a></span><span>
</span><span id="line-162"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType). SourceMetadata b -&gt; BackendSourceKind b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smKind"><span class="hs-identifier hs-var">_smKind</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688027521"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027522"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>                      </span><span class="annot"><span class="annottext">InsOrdHashMap (TableName b) (TableMetadata b)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-164"></span><span>                      </span><span class="annot"><span class="annottext">InsOrdHashMap (FunctionName b) (FunctionMetadata b)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-165"></span><span>                      </span><span class="annot"><span class="annottext">NativeQueries b
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-166"></span><span>                      </span><span class="annot"><span class="annottext">InsOrdHashMap (FunctionName b) (StoredProcedureMetadata b)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-167"></span><span>                      </span><span class="annot"><span class="annottext">LogicalModels b
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-168"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (b :: BackendType).
SourceMetadata b -&gt; SourceConnConfiguration b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smConfiguration"><span class="hs-identifier hs-var">_smConfiguration</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688027521"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027522"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>                      </span><span class="annot"><span class="annottext">Maybe QueryTagsConfig
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-170"></span><span>                      </span><span class="annot"><span class="annottext">SourceCustomization
</span><a href="Hasura.RQL.Types.SourceCustomization.html#emptySourceCustomization"><span class="hs-identifier hs-var">emptySourceCustomization</span></a></span><span>
</span><span id="line-171"></span><span>                      </span><span class="annot"><span class="annottext">Maybe (HealthCheckConfig b)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-172"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#emptyMetadata"><span class="hs-identifier hs-var">emptyMetadata</span></a></span><span>
</span><span id="line-173"></span><span>                </span><span class="annot"><span class="annottext">Metadata -&gt; (Metadata -&gt; Metadata) -&gt; Metadata
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Sources -&gt; Identity Sources) -&gt; Metadata -&gt; Identity Metadata
Lens' Metadata Sources
</span><a href="Hasura.RQL.Types.Metadata.html#metaSources"><span class="hs-identifier hs-var">metaSources</span></a></span><span>
</span><span id="line-174"></span><span>                </span><span class="annot"><span class="annottext">((Sources -&gt; Identity Sources) -&gt; Metadata -&gt; Identity Metadata)
-&gt; (Sources -&gt; Sources) -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; BackendSourceMetadata -&gt; Sources -&gt; Sources
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; v -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#insert"><span class="hs-identifier hs-var">InsOrdHashMap.insert</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-var">defaultSource</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688027495"><span class="hs-identifier hs-var">emptyDefaultSource</span></a></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621688027532"><span class="annot"><a href="#local-6989586621688027532"><span class="hs-identifier hs-var">_inconsistencies</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027533"><span class="annot"><a href="#local-6989586621688027533"><span class="hs-identifier hs-var">replaceMetadataWarnings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#runMetadataWarnings"><span class="hs-identifier hs-type">runMetadataWarnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2%27"><span class="hs-identifier hs-type">runReplaceMetadataV2'</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReplaceMetadataV2"><span class="hs-identifier hs-type">ReplaceMetadataV2</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#NoAllowInconsistentMetadata"><span class="hs-identifier hs-type">NoAllowInconsistentMetadata</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#AllowWarnings"><span class="hs-identifier hs-type">AllowWarnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMWithSources"><span class="hs-identifier hs-type">RMWithSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027492"><span class="hs-identifier hs-type">emptyMetadata'</span></a></span><span>
</span><span id="line-177"></span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-comment">-- Cleanup the default source explicitly because in the `runReplaceMetadataV1`</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-comment">-- call it won't be considered as a dropped source because we artificially add</span><span>
</span><span id="line-180"></span><span>  </span><span class="hs-comment">-- a empty source metadata for the default source metadata. So, for `runReplaceMetadataV1`</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-comment">-- the default source will not be a dropped source and hence there will not be</span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-comment">-- any post drop source action on it. So, here we expicitly do the post drop source</span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-comment">-- action for the default source, if it existed in the metadata.</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027540"><span class="annot"><a href="#local-6989586621688027540"><span class="hs-identifier hs-var">dropSourceHookWarnings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#runMetadataWarnings"><span class="hs-identifier hs-type">runMetadataWarnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">for</span></span><span> </span><span class="annot"><a href="#local-6989586621688027487"><span class="hs-identifier hs-type">maybeDefaultSourceMetadata</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#postDropSourceHookHelper"><span class="hs-identifier hs-type">postDropSourceHookHelper</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027485"><span class="hs-identifier hs-type">oldSchemaCache</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-type">defaultSource</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#mkSuccessResponseWithWarnings"><span class="hs-identifier hs-type">mkSuccessResponseWithWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621688027533"><span class="hs-identifier hs-type">replaceMetadataWarnings</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621688027540"><span class="hs-identifier hs-type">dropSourceHookWarnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span class="hs-comment">{- Note [Cleanup for dropped triggers]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There was an issue (https://github.com/hasura/graphql-engine/issues/5461)
fixed (via https://github.com/hasura/graphql-engine/pull/6137) related to
event triggers while replacing metadata in the catalog prior to metadata
separation. The metadata separation solves the issue naturally, since the
'hdb_catalog.event_triggers' table is no more in use and new/updated event
triggers are processed in building schema cache. But we need to drop the
database trigger and archive events for dropped event triggers. This is handled
explicitly in @'runReplaceMetadata' function.
-}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-comment">-- | Replace the 'current metadata' with the 'new metadata'</span><span>
</span><span id="line-200"></span><span class="hs-comment">-- The 'new metadata' might come via the 'Import Metadata' in console</span><span>
</span><span id="line-201"></span><span id="local-6989586621688026734"><span id="local-6989586621688026735"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadata"><span class="hs-identifier hs-type">runReplaceMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621688026735"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">HL.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688026735"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReplaceMetadata"><span class="hs-identifier hs-type">ReplaceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="#local-6989586621688026734"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span></span><span>
</span><span id="line-215"></span><span id="runReplaceMetadata"><span class="annot"><span class="annottext">runReplaceMetadata :: forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m,
 MonadGetPolicies m) =&gt;
ReplaceMetadata -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadata"><span class="hs-identifier hs-var hs-var">runReplaceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMReplaceMetadataV1"><span class="hs-identifier hs-type">RMReplaceMetadataV1</span></a></span><span> </span><span id="local-6989586621688027574"><span class="annot"><span class="annottext">ReplaceMetadataV1
</span><a href="#local-6989586621688027574"><span class="hs-identifier hs-var">v1args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV1 -&gt; m EncJSON
forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m,
 MonadGetPolicies m) =&gt;
ReplaceMetadataV1 -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV1"><span class="hs-identifier hs-var">runReplaceMetadataV1</span></a></span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV1
</span><a href="#local-6989586621688027574"><span class="hs-identifier hs-var">v1args</span></a></span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMReplaceMetadataV2"><span class="hs-identifier hs-type">RMReplaceMetadataV2</span></a></span><span> </span><span id="local-6989586621688027577"><span class="annot"><span class="annottext">ReplaceMetadataV2
</span><a href="#local-6989586621688027577"><span class="hs-identifier hs-var">v2args</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV2 -&gt; m EncJSON
forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m,
 MonadGetPolicies m) =&gt;
ReplaceMetadataV2 -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2"><span class="hs-identifier hs-var">runReplaceMetadataV2</span></a></span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV2
</span><a href="#local-6989586621688027577"><span class="hs-identifier hs-var">v2args</span></a></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="local-6989586621688026739"><span id="local-6989586621688026740"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV1"><span class="hs-identifier hs-type">runReplaceMetadataV1</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621688026740"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">HL.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688026740"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-231"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReplaceMetadataV1"><span class="hs-identifier hs-type">ReplaceMetadataV1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="#local-6989586621688026739"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span></span><span>
</span><span id="line-233"></span><span id="runReplaceMetadataV1"><span class="annot"><span class="annottext">runReplaceMetadataV1 :: forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m,
 MonadGetPolicies m) =&gt;
ReplaceMetadataV1 -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV1"><span class="hs-identifier hs-var hs-var">runReplaceMetadataV1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-234"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataWarnings -&gt; EncJSON
</span><a href="Hasura.RQL.DDL.Warnings.html#mkSuccessResponseWithWarnings"><span class="hs-identifier hs-var">mkSuccessResponseWithWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarnings -&gt; EncJSON)
-&gt; (([InconsistentMetadata], MetadataWarnings) -&gt; MetadataWarnings)
-&gt; ([InconsistentMetadata], MetadataWarnings)
-&gt; EncJSON
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([InconsistentMetadata], MetadataWarnings) -&gt; MetadataWarnings
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([InconsistentMetadata], MetadataWarnings) -&gt; EncJSON)
-&gt; m ([InconsistentMetadata], MetadataWarnings) -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m ([InconsistentMetadata], MetadataWarnings) -&gt; m EncJSON)
-&gt; (ReplaceMetadataV1
    -&gt; m ([InconsistentMetadata], MetadataWarnings))
-&gt; ReplaceMetadataV1
-&gt; m EncJSON
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">StateT MetadataWarnings m [InconsistentMetadata]
-&gt; m ([InconsistentMetadata], MetadataWarnings)
forall (m :: * -&gt; *) a.
StateT MetadataWarnings m a -&gt; m (a, MetadataWarnings)
</span><a href="Hasura.RQL.DDL.Warnings.html#runMetadataWarnings"><span class="hs-identifier hs-var">runMetadataWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT MetadataWarnings m [InconsistentMetadata]
 -&gt; m ([InconsistentMetadata], MetadataWarnings))
-&gt; (ReplaceMetadataV1
    -&gt; StateT MetadataWarnings m [InconsistentMetadata])
-&gt; ReplaceMetadataV1
-&gt; m ([InconsistentMetadata], MetadataWarnings)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV2
-&gt; StateT MetadataWarnings m [InconsistentMetadata]
forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m, MonadWarnings m,
 MonadGetPolicies m) =&gt;
ReplaceMetadataV2 -&gt; m [InconsistentMetadata]
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2%27"><span class="hs-identifier hs-var">runReplaceMetadataV2'</span></a></span><span> </span><span class="annot"><span class="annottext">(ReplaceMetadataV2
 -&gt; StateT MetadataWarnings m [InconsistentMetadata])
-&gt; (ReplaceMetadataV1 -&gt; ReplaceMetadataV2)
-&gt; ReplaceMetadataV1
-&gt; StateT MetadataWarnings m [InconsistentMetadata]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AllowInconsistentMetadata
-&gt; AllowWarnings -&gt; ReplaceMetadataV1 -&gt; ReplaceMetadataV2
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#ReplaceMetadataV2"><span class="hs-identifier hs-var">ReplaceMetadataV2</span></a></span><span> </span><span class="annot"><span class="annottext">AllowInconsistentMetadata
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#NoAllowInconsistentMetadata"><span class="hs-identifier hs-var">NoAllowInconsistentMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">AllowWarnings
</span><a href="Hasura.RQL.DDL.Warnings.html#AllowWarnings"><span class="hs-identifier hs-var">AllowWarnings</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2"><span class="hs-identifier hs-type">runReplaceMetadataV2</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688026741"><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621688026742"><span class="annot"><a href="#local-6989586621688026742"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-238"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621688026742"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">HL.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688026742"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-249"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReplaceMetadataV2"><span class="hs-identifier hs-type">ReplaceMetadataV2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><a href="#local-6989586621688026741"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-251"></span><span id="runReplaceMetadataV2"><span class="annot"><span class="annottext">runReplaceMetadataV2 :: forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m,
 MonadGetPolicies m) =&gt;
ReplaceMetadataV2 -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2"><span class="hs-identifier hs-var hs-var">runReplaceMetadataV2</span></a></span></span><span> </span><span id="local-6989586621688027643"><span class="annot"><span class="annottext">ReplaceMetadataV2
</span><a href="#local-6989586621688027643"><span class="hs-identifier hs-var">replaceMetadataArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621688027644"><span class="annot"><a href="#local-6989586621688027644"><span class="hs-identifier hs-var">inconsistentObjects</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027645"><span class="annot"><a href="#local-6989586621688027645"><span class="hs-identifier hs-var">metadataWarnings</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT MetadataWarnings m [InconsistentMetadata]
-&gt; m ([InconsistentMetadata], MetadataWarnings)
forall (m :: * -&gt; *) a.
StateT MetadataWarnings m a -&gt; m (a, MetadataWarnings)
</span><a href="Hasura.RQL.DDL.Warnings.html#runMetadataWarnings"><span class="hs-identifier hs-var">runMetadataWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(StateT MetadataWarnings m [InconsistentMetadata]
 -&gt; m ([InconsistentMetadata], MetadataWarnings))
-&gt; StateT MetadataWarnings m [InconsistentMetadata]
-&gt; m ([InconsistentMetadata], MetadataWarnings)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReplaceMetadataV2
-&gt; StateT MetadataWarnings m [InconsistentMetadata]
forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m, MonadWarnings m,
 MonadGetPolicies m) =&gt;
ReplaceMetadataV2 -&gt; m [InconsistentMetadata]
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2%27"><span class="hs-identifier hs-var">runReplaceMetadataV2'</span></a></span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV2
</span><a href="#local-6989586621688027643"><span class="hs-identifier hs-var">replaceMetadataArgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#_rmv2AllowWarningss"><span class="hs-identifier hs-var">_rmv2AllowWarningss</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027643"><span class="hs-identifier hs-type">replaceMetadataArgs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">AllowWarnings
</span><a href="Hasura.RQL.DDL.Warnings.html#AllowWarnings"><span class="hs-identifier hs-var">AllowWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">AllowWarnings
</span><a href="Hasura.RQL.DDL.Warnings.html#DisallowWarnings"><span class="hs-identifier hs-var">DisallowWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataWarnings -&gt; Bool
forall a. Seq a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">MetadataWarnings
</span><a href="#local-6989586621688027645"><span class="hs-identifier hs-var">metadataWarnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; Value -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; Value -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400WithDetail"><span class="hs-identifier hs-var">throw400WithDetail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#CustomCode"><span class="hs-identifier hs-var">CustomCode</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;metadata-warnings&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;failed due to metadata warnings&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataWarnings -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataWarnings
</span><a href="#local-6989586621688027645"><span class="hs-identifier hs-var">metadataWarnings</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-type">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#formatInconsistentObjs"><span class="hs-identifier hs-type">formatInconsistentObjs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027644"><span class="hs-identifier hs-type">inconsistentObjects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027645"><span class="hs-identifier hs-type">metadataWarnings</span></a></span><span>
</span><span id="line-259"></span><span>
</span><span id="line-260"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2%27"><span class="hs-identifier hs-type">runReplaceMetadataV2'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688026725"><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621688026726"><span class="annot"><a href="#local-6989586621688026726"><span class="hs-identifier hs-type">r</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/monad-control-1.0.3.1-127c0b1895a90d6faa345827c6b6be6447278996974a93c84184eef9ccf5fbbc/share/doc/html/src/Control.Monad.Trans.Control.html/Control.Monad.Trans.Control.html#MonadBaseControl"><span class="hs-identifier hs-type">MonadBaseControl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621688026726"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-268"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#Has"><span class="hs-identifier hs-type">Has</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">HL.Hasura</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688026726"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#MonadEventLogCleanup"><span class="hs-identifier hs-type">MonadEventLogCleanup</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#MonadWarnings"><span class="hs-identifier hs-type">MonadWarnings</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><a href="Hasura.Server.Types.html#MonadGetPolicies"><span class="hs-identifier hs-type">MonadGetPolicies</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReplaceMetadataV2"><span class="hs-identifier hs-type">ReplaceMetadataV2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span id="runReplaceMetadataV2%27"><span class="annot"><span class="annottext">runReplaceMetadataV2' :: forall (m :: * -&gt; *) r.
(CacheRWM m, MetadataM m, MonadIO m, MonadBaseControl IO m,
 MonadMetadataStorage m, MonadReader r m, MonadError QErr m,
 Has (Logger Hasura) r, MonadEventLogCleanup m, MonadWarnings m,
 MonadGetPolicies m) =&gt;
ReplaceMetadataV2 -&gt; m [InconsistentMetadata]
</span><a href="Hasura.RQL.DDL.Metadata.html#runReplaceMetadataV2%27"><span class="hs-identifier hs-var hs-var">runReplaceMetadataV2'</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReplaceMetadataV2"><span class="hs-identifier hs-type">ReplaceMetadataV2</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688027826"><span id="local-6989586621688027827"><span id="local-6989586621688027828"><span class="annot"><span class="annottext">AllowWarnings
ReplaceMetadataV1
AllowInconsistentMetadata
_rmv2AllowWarningss :: ReplaceMetadataV2 -&gt; AllowWarnings
_rmv2AllowInconsistentMetadata :: AllowInconsistentMetadata
_rmv2AllowWarningss :: AllowWarnings
_rmv2Metadata :: ReplaceMetadataV1
_rmv2Metadata :: ReplaceMetadataV2 -&gt; ReplaceMetadataV1
_rmv2AllowInconsistentMetadata :: ReplaceMetadataV2 -&gt; AllowInconsistentMetadata
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#_rmv2AllowWarningss"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>  </span><span id="local-6989586621688027831"><span class="annot"><a href="#local-6989586621688027831"><span class="hs-identifier hs-var">logger</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HL.Logger</span></span><span> </span><span class="annot"><span class="hs-identifier">HL.Hasura</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(r -&gt; Logger Hasura) -&gt; m (Logger Hasura)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Logger Hasura
forall a t. Has a t =&gt; t -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/data-has-0.4.0.0-53a688b2221046a4de0fb8e7927d1d69f385837da1af187d22b34ea76ed4183c/share/doc/html/src/Data.Has.html/Data.Has.html#getter"><span class="hs-identifier hs-var">getter</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-comment">-- we drop all the future cron trigger events before inserting the new metadata</span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-comment">-- and re-populating future cron events below</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027832"><span class="annot"><a href="#local-6989586621688027832"><span class="hs-identifier hs-var hs-var">introspectionDisabledRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV1
</span><a href="#local-6989586621688027828"><span class="hs-identifier hs-var">_rmv2Metadata</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-282"></span><span>          </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMWithSources"><span class="hs-identifier hs-type">RMWithSources</span></a></span><span> </span><span id="local-6989586621688027833"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027833"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; SetGraphqlIntrospectionOptions
</span><a href="Hasura.RQL.Types.Metadata.html#_metaSetGraphqlIntrospectionOptions"><span class="hs-identifier hs-var">_metaSetGraphqlIntrospectionOptions</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027833"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-283"></span><span>          </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMWithoutSources"><span class="hs-identifier hs-type">RMWithoutSources</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataNoSources
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SetGraphqlIntrospectionOptions
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-284"></span><span>  </span><span id="local-6989586621688027836"><span class="annot"><a href="#local-6989586621688027836"><span class="hs-identifier hs-var">oldMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-type">getMetadata</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621688027837"><span class="annot"><a href="#local-6989586621688027837"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-type">askSchemaCache</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621688027838"><span class="annot"><a href="#local-6989586621688027838"><span class="hs-identifier hs-var">cronTriggersMetadata</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027839"><span class="annot"><a href="#local-6989586621688027839"><span class="hs-identifier hs-var">cronTriggersToBeAdded</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="#local-6989586621688027840"><span class="hs-identifier hs-type">processCronTriggers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027836"><span class="hs-identifier hs-type">oldMetadata</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>  </span><span id="local-6989586621688027841"><span class="annot"><a href="#local-6989586621688027841"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688027828"><span class="hs-identifier hs-type">_rmv2Metadata</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMWithSources"><span class="hs-identifier hs-type">RMWithSources</span></a></span><span> </span><span id="local-6989586621688027842"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027842"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; m Metadata
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; m Metadata) -&gt; Metadata -&gt; m Metadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027842"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaCronTriggers"><span class="hs-identifier hs-var">_metaCronTriggers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621688027838"><span class="hs-identifier hs-type">cronTriggersMetadata</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMWithoutSources"><span class="hs-identifier hs-type">RMWithoutSources</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataNoSources"><span class="hs-identifier hs-type">MetadataNoSources</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688027845"><span id="local-6989586621688027846"><span id="local-6989586621688027847"><span id="local-6989586621688027848"><span id="local-6989586621688027849"><span id="local-6989586621688027850"><span id="local-6989586621688027851"><span id="local-6989586621688027852"><span class="annot"><span class="annottext">QueryCollections
MetadataAllowlist
RemoteSchemas
Tables ('Postgres 'Vanilla)
Functions ('Postgres 'Vanilla)
CronTriggers
Actions
CustomTypes
_mnsTables :: Tables ('Postgres 'Vanilla)
_mnsFunctions :: Functions ('Postgres 'Vanilla)
_mnsRemoteSchemas :: RemoteSchemas
_mnsQueryCollections :: QueryCollections
_mnsAllowlist :: MetadataAllowlist
_mnsCustomTypes :: CustomTypes
_mnsActions :: Actions
_mnsCronTriggers :: CronTriggers
_mnsCronTriggers :: MetadataNoSources -&gt; CronTriggers
_mnsActions :: MetadataNoSources -&gt; Actions
_mnsCustomTypes :: MetadataNoSources -&gt; CustomTypes
_mnsAllowlist :: MetadataNoSources -&gt; MetadataAllowlist
_mnsQueryCollections :: MetadataNoSources -&gt; QueryCollections
_mnsRemoteSchemas :: MetadataNoSources -&gt; RemoteSchemas
_mnsFunctions :: MetadataNoSources -&gt; Functions ('Postgres 'Vanilla)
_mnsTables :: MetadataNoSources -&gt; Tables ('Postgres 'Vanilla)
</span><a href="#local-6989586621688027845"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027861"><span class="annot"><span class="annottext">maybeDefaultSourceMetadata :: Maybe (SourceMetadata ('Postgres 'Vanilla))
</span><a href="#local-6989586621688027861"><span class="hs-identifier hs-var hs-var hs-var">maybeDefaultSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027836"><span class="hs-identifier hs-var">oldMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
-&gt; Getting
     (First (SourceMetadata ('Postgres 'Vanilla)))
     Metadata
     (SourceMetadata ('Postgres 'Vanilla))
-&gt; Maybe (SourceMetadata ('Postgres 'Vanilla))
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Fold.html/Control.Lens.Fold.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">(Sources
 -&gt; Const (First (SourceMetadata ('Postgres 'Vanilla))) Sources)
-&gt; Metadata
-&gt; Const (First (SourceMetadata ('Postgres 'Vanilla))) Metadata
Lens' Metadata Sources
</span><a href="Hasura.RQL.Types.Metadata.html#metaSources"><span class="hs-identifier hs-var">metaSources</span></a></span><span> </span><span class="annot"><span class="annottext">((Sources
  -&gt; Const (First (SourceMetadata ('Postgres 'Vanilla))) Sources)
 -&gt; Metadata
 -&gt; Const (First (SourceMetadata ('Postgres 'Vanilla))) Metadata)
-&gt; ((SourceMetadata ('Postgres 'Vanilla)
     -&gt; Const
          (First (SourceMetadata ('Postgres 'Vanilla)))
          (SourceMetadata ('Postgres 'Vanilla)))
    -&gt; Sources
    -&gt; Const (First (SourceMetadata ('Postgres 'Vanilla))) Sources)
-&gt; Getting
     (First (SourceMetadata ('Postgres 'Vanilla)))
     Metadata
     (SourceMetadata ('Postgres 'Vanilla))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Index Sources -&gt; Traversal' Sources (IxValue Sources)
forall m. Ixed m =&gt; Index m -&gt; Traversal' m (IxValue m)
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.At.html/Control.Lens.At.html#ix"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Index Sources
SourceName
</span><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-var">defaultSource</span></a></span><span> </span><span class="annot"><span class="annottext">((BackendSourceMetadata
  -&gt; Const
       (First (SourceMetadata ('Postgres 'Vanilla)))
       BackendSourceMetadata)
 -&gt; Sources
 -&gt; Const (First (SourceMetadata ('Postgres 'Vanilla))) Sources)
-&gt; ((SourceMetadata ('Postgres 'Vanilla)
     -&gt; Const
          (First (SourceMetadata ('Postgres 'Vanilla)))
          (SourceMetadata ('Postgres 'Vanilla)))
    -&gt; BackendSourceMetadata
    -&gt; Const
         (First (SourceMetadata ('Postgres 'Vanilla)))
         BackendSourceMetadata)
-&gt; (SourceMetadata ('Postgres 'Vanilla)
    -&gt; Const
         (First (SourceMetadata ('Postgres 'Vanilla)))
         (SourceMetadata ('Postgres 'Vanilla)))
-&gt; Sources
-&gt; Const (First (SourceMetadata ('Postgres 'Vanilla))) Sources
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(SourceMetadata ('Postgres 'Vanilla)
 -&gt; Const
      (First (SourceMetadata ('Postgres 'Vanilla)))
      (SourceMetadata ('Postgres 'Vanilla)))
-&gt; BackendSourceMetadata
-&gt; Const
     (First (SourceMetadata ('Postgres 'Vanilla))) BackendSourceMetadata
forall (b :: BackendType).
Backend b =&gt;
Prism' BackendSourceMetadata (SourceMetadata b)
Prism' BackendSourceMetadata (SourceMetadata ('Postgres 'Vanilla))
</span><a href="Hasura.RQL.Types.Metadata.Common.html#toSourceMetadata"><span class="hs-identifier hs-var">toSourceMetadata</span></a></span><span>
</span><span id="line-293"></span><span>      </span><span id="local-6989586621688027863"><span class="annot"><a href="#local-6989586621688027863"><span class="hs-identifier hs-var">defaultSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-294"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SourceMetadata ('Postgres 'Vanilla))
-&gt; m (SourceMetadata ('Postgres 'Vanilla))
-&gt; m (SourceMetadata ('Postgres 'Vanilla))
forall (m :: * -&gt; *) a. Applicative m =&gt; Maybe a -&gt; m a -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#onNothing"><span class="hs-identifier hs-var">onNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SourceMetadata ('Postgres 'Vanilla))
</span><a href="#local-6989586621688027861"><span class="hs-identifier hs-var">maybeDefaultSourceMetadata</span></a></span><span>
</span><span id="line-295"></span><span>          </span><span class="annot"><span class="annottext">(m (SourceMetadata ('Postgres 'Vanilla))
 -&gt; m (SourceMetadata ('Postgres 'Vanilla)))
-&gt; m (SourceMetadata ('Postgres 'Vanilla))
-&gt; m (SourceMetadata ('Postgres 'Vanilla))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m (SourceMetadata ('Postgres 'Vanilla))
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#NotSupported"><span class="hs-identifier hs-var">NotSupported</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cannot import metadata without sources since no default source is defined&quot;</span></span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027867"><span class="annot"><a href="#local-6989586621688027867"><span class="hs-identifier hs-var hs-var">newDefaultSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-297"></span><span>            </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata -&gt; BackendSourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-var">BackendSourceMetadata</span></a></span><span>
</span><span id="line-298"></span><span>              </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadata -&gt; BackendSourceMetadata)
-&gt; AnyBackend SourceMetadata -&gt; BackendSourceMetadata
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadata ('Postgres 'Vanilla) -&gt; AnyBackend SourceMetadata
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span>
</span><span id="line-299"></span><span>                </span><span class="annot"><span class="annottext">SourceMetadata ('Postgres 'Vanilla)
</span><a href="#local-6989586621688027863"><span class="hs-identifier hs-var">defaultSourceMetadata</span></a></span><span>
</span><span id="line-300"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#_smTables"><span class="hs-identifier hs-var">_smTables</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621688027845"><span class="hs-identifier hs-type">_mnsTables</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>                    </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#_smFunctions"><span class="hs-identifier hs-var">_smFunctions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621688027846"><span class="hs-identifier hs-type">_mnsFunctions</span></a></span><span>
</span><span id="line-302"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-303"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span>
</span><span id="line-305"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#singleton"><span class="hs-identifier hs-type">InsOrdHashMap.singleton</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#defaultSource"><span class="hs-identifier hs-type">defaultSource</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027867"><span class="hs-identifier hs-type">newDefaultSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>          </span><span class="annot"><a href="#local-6989586621688027847"><span class="hs-identifier hs-type">_mnsRemoteSchemas</span></a></span><span>
</span><span id="line-307"></span><span>          </span><span class="annot"><a href="#local-6989586621688027848"><span class="hs-identifier hs-type">_mnsQueryCollections</span></a></span><span>
</span><span id="line-308"></span><span>          </span><span class="annot"><a href="#local-6989586621688027849"><span class="hs-identifier hs-type">_mnsAllowlist</span></a></span><span>
</span><span id="line-309"></span><span>          </span><span class="annot"><a href="#local-6989586621688027850"><span class="hs-identifier hs-type">_mnsCustomTypes</span></a></span><span>
</span><span id="line-310"></span><span>          </span><span class="annot"><a href="#local-6989586621688027851"><span class="hs-identifier hs-type">_mnsActions</span></a></span><span>
</span><span id="line-311"></span><span>          </span><span class="annot"><a href="#local-6989586621688027838"><span class="hs-identifier hs-type">cronTriggersMetadata</span></a></span><span>
</span><span id="line-312"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaRestEndpoints"><span class="hs-identifier hs-var">_metaRestEndpoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027836"><span class="hs-identifier hs-type">oldMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.ApiLimit.html#emptyApiLimit"><span class="hs-identifier hs-type">emptyApiLimit</span></a></span><span>
</span><span id="line-314"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#emptyMetricsConfig"><span class="hs-identifier hs-type">emptyMetricsConfig</span></a></span><span>
</span><span id="line-315"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-316"></span><span>          </span><span class="annot"><a href="#local-6989586621688027832"><span class="hs-identifier hs-type">introspectionDisabledRoles</span></a></span><span>
</span><span id="line-317"></span><span>          </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.Types.Extended.html/Network.Types.Extended.html#emptyNetwork"><span class="hs-identifier hs-type">emptyNetwork</span></a></span><span>
</span><span id="line-318"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-319"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.OpenTelemetry.html#emptyOpenTelemetryConfig"><span class="hs-identifier hs-type">emptyOpenTelemetryConfig</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621688027877"><span class="annot"><a href="#local-6989586621688027877"><span class="hs-identifier hs-var">oldSources</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027878"><span class="annot"><a href="#local-6989586621688027878"><span class="hs-identifier hs-var">newSources</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaSources"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027836"><span class="hs-identifier hs-type">oldMetadata</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaSources"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027841"><span class="hs-identifier hs-type">metadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>  </span><span class="hs-comment">-- Check for duplicate and illegal trigger names in the new source metadata</span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-type">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027878"><span class="hs-identifier hs-type">newSources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688027882"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027882"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027883"><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688027883"><span class="hs-identifier hs-var">newBackendSourceMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>    </span><span class="annot"><span class="annottext">Maybe BackendSourceMetadata
-&gt; (BackendSourceMetadata -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; Sources -&gt; Maybe BackendSourceMetadata
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#lookup"><span class="hs-identifier hs-var">InsOrdHashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027882"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688027877"><span class="hs-identifier hs-var">oldSources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((BackendSourceMetadata -&gt; m ()) -&gt; m ())
-&gt; (BackendSourceMetadata -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688027885"><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688027885"><span class="hs-identifier hs-var">oldBackendSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-326"></span><span>      </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; AnyBackend SourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendSourceMetadata"><span class="hs-identifier hs-var">unBackendSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688027883"><span class="hs-identifier hs-var">newBackendSourceMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688027903"><span id="local-6989586621688027904"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027904"><span class="hs-identifier hs-var">newSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027903"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027905"><span class="annot"><span class="annottext">newTriggerNames :: [TriggerName]
</span><a href="#local-6989586621688027905"><span class="hs-identifier hs-var hs-var hs-var">newTriggerNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TableMetadata b -&gt; [TriggerName])
-&gt; [TableMetadata b] -&gt; [TriggerName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; [TriggerName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; [TriggerName])
-&gt; (TableMetadata b
    -&gt; InsOrdHashMap TriggerName (EventTriggerConf b))
-&gt; TableMetadata b
-&gt; [TriggerName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TableMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall (b :: BackendType). TableMetadata b -&gt; EventTriggers b
</span><a href="Hasura.Table.Metadata.html#_tmEventTriggers"><span class="hs-identifier hs-var">_tmEventTriggers</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap (TableName b) (TableMetadata b) -&gt; [TableMetadata b]
forall k v. InsOrdHashMap k v -&gt; [v]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#elems"><span class="hs-identifier hs-var">InsOrdHashMap.elems</span></a></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap (TableName b) (TableMetadata b)
 -&gt; [TableMetadata b])
-&gt; InsOrdHashMap (TableName b) (TableMetadata b)
-&gt; [TableMetadata b]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; InsOrdHashMap (TableName b) (TableMetadata b)
forall (b :: BackendType). SourceMetadata b -&gt; Tables b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#_smTables"><span class="hs-identifier hs-var">_smTables</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027904"><span class="hs-identifier hs-var">newSourceMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>            </span><span id="local-6989586621688027910"><span class="annot"><span class="annottext">duplicateTriggerNamesInNewMetadata :: [TriggerName]
</span><a href="#local-6989586621688027910"><span class="hs-identifier hs-var hs-var hs-var">duplicateTriggerNamesInNewMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621688027905"><span class="hs-identifier hs-var">newTriggerNames</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName] -&gt; [TriggerName] -&gt; [TriggerName]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">\\</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TriggerName] -&gt; [TriggerName]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.List.Extended.html/Data.List.Extended.html#uniques"><span class="hs-identifier hs-var">L.uniques</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621688027905"><span class="hs-identifier hs-var">newTriggerNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TriggerName] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621688027910"><span class="hs-identifier hs-var">duplicateTriggerNamesInNewMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-330"></span><span>          </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#NotSupported"><span class="hs-identifier hs-var">NotSupported</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Event trigger with duplicate names not allowed: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall t (f :: * -&gt; *). (ToTxt t, Foldable f) =&gt; f t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#dquoteList"><span class="hs-identifier hs-var">dquoteList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TriggerName -&gt; Text) -&gt; [TriggerName] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621688027910"><span class="hs-identifier hs-var">duplicateTriggerNamesInNewMetadata</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">BackendSourceMetadata
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    SourceMetadata b -&gt; m ())
-&gt; m ()
forall {r}.
BackendSourceMetadata
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    SourceMetadata b -&gt; r)
-&gt; r
</span><a href="#local-6989586621688027914"><span class="hs-identifier hs-var">dispatch</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688027885"><span class="hs-identifier hs-var">oldBackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688027929"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027929"><span class="hs-identifier hs-var">oldSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027930"><span class="annot"><span class="annottext">oldTriggersMap :: InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688027930"><span class="hs-identifier hs-var hs-var">oldTriggersMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall (b :: BackendType).
SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getTriggersMap"><span class="hs-identifier hs-var">getTriggersMap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027929"><span class="hs-identifier hs-var">oldSourceMetadata</span></a></span><span>
</span><span id="line-333"></span><span>              </span><span id="local-6989586621688027931"><span class="annot"><span class="annottext">addedTriggerNames :: [(TableName b, TriggerName)]
</span><a href="#local-6989586621688027931"><span class="hs-identifier hs-var hs-var">addedTriggerNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TableName b, TriggerName) -&gt; Bool)
-&gt; [(TableName b, TriggerName)] -&gt; [(TableName b, TriggerName)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableName b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027932"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027932"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName
-&gt; InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; Bool
forall k a. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#member"><span class="hs-identifier hs-var">InsOrdHashMap.member</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027932"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688027930"><span class="hs-identifier hs-var">oldTriggersMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(TableName b, TriggerName)] -&gt; [(TableName b, TriggerName)])
-&gt; [(TableName b, TriggerName)] -&gt; [(TableName b, TriggerName)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; [(TableName b, TriggerName)]
forall (b :: BackendType).
SourceMetadata b -&gt; [(TableName b, TriggerName)]
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getSourceTableAndTriggers"><span class="hs-identifier hs-var">getSourceTableAndTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688027904"><span class="hs-identifier hs-var">newSourceMetadata</span></a></span><span>
</span><span id="line-334"></span><span>              </span><span id="local-6989586621688027936"><span class="annot"><span class="annottext">newIllegalTriggerNamesInNewMetadata :: [(TableName b, TriggerName)]
</span><a href="#local-6989586621688027936"><span class="hs-identifier hs-var hs-var">newIllegalTriggerNamesInNewMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TableName b, TriggerName) -&gt; Bool)
-&gt; [(TableName b, TriggerName)] -&gt; [(TableName b, TriggerName)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; Bool
</span><a href="Hasura.RQL.Types.EventTrigger.html#isIllegalTriggerName"><span class="hs-identifier hs-var">isIllegalTriggerName</span></a></span><span> </span><span class="annot"><span class="annottext">(TriggerName -&gt; Bool)
-&gt; ((TableName b, TriggerName) -&gt; TriggerName)
-&gt; (TableName b, TriggerName)
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TableName b, TriggerName) -&gt; TriggerName
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TableName b, TriggerName)]
</span><a href="#local-6989586621688027931"><span class="hs-identifier hs-var">addedTriggerNames</span></a></span><span>
</span><span id="line-335"></span><span>              </span><span id="local-6989586621688027938"><span class="annot"><span class="annottext">mkEventTriggerObjID :: TableName b -&gt; TriggerName -&gt; MetadataObjId
</span><a href="#local-6989586621688027938"><span class="hs-identifier hs-var hs-var">mkEventTriggerObjID</span></a></span></span><span> </span><span id="local-6989586621688027939"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688027939"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span id="local-6989586621688027940"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027940"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-var">MOSourceObjId</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027882"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">(AnyBackend SourceMetadataObjId -&gt; MetadataObjId)
-&gt; AnyBackend SourceMetadataObjId -&gt; MetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
i b -&gt; AnyBackend i
</span><a href="Hasura.SQL.AnyBackend.html#mkAnyBackend"><span class="hs-identifier hs-var">AB.mkAnyBackend</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId)
-&gt; SourceMetadataObjId b -&gt; AnyBackend SourceMetadataObjId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
TableName b -&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
</span><a href="Hasura.RQL.Types.Metadata.Object.html#SMOTableObj"><span class="hs-identifier hs-var">SMOTableObj</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688027903"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688027939"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">(TableMetadataObjId -&gt; SourceMetadataObjId b)
-&gt; TableMetadataObjId -&gt; SourceMetadataObjId b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; TableMetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MTOTrigger"><span class="hs-identifier hs-var">MTOTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027940"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-336"></span><span>              </span><span id="local-6989586621688027944"><span class="annot"><span class="annottext">mkIllegalEventTriggerNameWarning :: (TableName b, TriggerName) -&gt; MetadataWarning
</span><a href="#local-6989586621688027944"><span class="hs-identifier hs-var hs-var">mkIllegalEventTriggerNameWarning</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621688027945"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688027945"><span class="hs-identifier hs-var">tableName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027946"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027946"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-337"></span><span>                </span><span class="hs-comment">-- TODO: capture the path as well</span><span>
</span><span id="line-338"></span><span>                </span><span class="annot"><span class="annottext">WarningCode -&gt; MetadataObjId -&gt; Text -&gt; MetadataWarning
</span><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarning"><span class="hs-identifier hs-var">MetadataWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarningCode
</span><a href="Hasura.RQL.DDL.Warnings.html#WCIllegalEventTriggerName"><span class="hs-identifier hs-var">WCIllegalEventTriggerName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TableName b -&gt; TriggerName -&gt; MetadataObjId
</span><a href="#local-6989586621688027938"><span class="hs-identifier hs-var">mkEventTriggerObjID</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688027945"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027946"><span class="hs-identifier hs-var">triggerName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>                  </span><span class="annot"><span class="annottext">(Text -&gt; MetadataWarning) -&gt; Text -&gt; MetadataWarning
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;The event trigger with name &quot;</span></span><span>
</span><span id="line-340"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#dquote"><span class="hs-identifier hs-var">dquote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="Hasura.RQL.Types.EventTrigger.html#triggerNameToTxt"><span class="hs-identifier hs-var">triggerNameToTxt</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027946"><span class="hs-identifier hs-var">triggerName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>                  </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; may not work as expected, hasura suggests to use only alphanumeric, underscore and hyphens in an event trigger name&quot;</span></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(TableName b, TriggerName)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(TableName b, TriggerName)]
</span><a href="#local-6989586621688027936"><span class="hs-identifier hs-var">newIllegalTriggerNamesInNewMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>            </span><span class="annot"><span class="annottext">((TableName b, TriggerName) -&gt; m ())
-&gt; [(TableName b, TriggerName)] -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarning -&gt; m ())
-&gt; ((TableName b, TriggerName) -&gt; MetadataWarning)
-&gt; (TableName b, TriggerName)
-&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(TableName b, TriggerName) -&gt; MetadataWarning
</span><a href="#local-6989586621688027944"><span class="hs-identifier hs-var">mkIllegalEventTriggerNameWarning</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TableName b, TriggerName)]
</span><a href="#local-6989586621688027936"><span class="hs-identifier hs-var">newIllegalTriggerNamesInNewMetadata</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-comment">-- Throw a warning if the API time limit exceeds the system limit</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027949"><span class="annot"><a href="#local-6989586621688027949"><span class="hs-identifier hs-var hs-var">userTimeLimitAPILimit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Limit MaxTime -&gt; MaxTime
forall a. Limit a -&gt; a
</span><a href="Hasura.RQL.Types.ApiLimit.html#_lGlobal"><span class="hs-identifier hs-var">_lGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">(Limit MaxTime -&gt; MaxTime)
-&gt; Maybe (Limit MaxTime) -&gt; Maybe MaxTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ApiLimit -&gt; Maybe (Limit MaxTime)
</span><a href="Hasura.RQL.Types.ApiLimit.html#_alTimeLimit"><span class="hs-identifier hs-var">_alTimeLimit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Metadata -&gt; ApiLimit
</span><a href="Hasura.RQL.Types.Metadata.html#_metaApiLimits"><span class="hs-identifier hs-var">_metaApiLimits</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027841"><span class="hs-identifier hs-var">metadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>  </span><span id="local-6989586621688027953"><span class="annot"><a href="#local-6989586621688027953"><span class="hs-identifier hs-var">warningResultEither</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.ApiLimit.html#compareTimeLimitWith"><span class="hs-identifier hs-type">compareTimeLimitWith</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027949"><span class="hs-identifier hs-type">userTimeLimitAPILimit</span></a></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688027953"><span class="hs-identifier hs-type">warningResultEither</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-350"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621688027955"><span class="annot"><span class="annottext">MetadataWarning
</span><a href="#local-6989586621688027955"><span class="hs-identifier hs-var">warning</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataWarning
</span><a href="#local-6989586621688027955"><span class="hs-identifier hs-var">warning</span></a></span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027956"><span class="annot"><a href="#local-6989586621688027956"><span class="hs-identifier hs-var hs-var">cacheInvalidations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span>
</span><span id="line-355"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ciMetadata :: Bool
</span><a href="#local-6989586621688027958"><span class="hs-identifier hs-var">ciMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>            </span><span class="annot"><span class="annottext">ciRemoteSchemas :: HashSet RemoteSchemaName
</span><a href="#local-6989586621688027959"><span class="hs-identifier hs-var">ciRemoteSchemas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">,</span><span>
</span><span id="line-357"></span><span>            </span><span class="annot"><span class="annottext">ciSources :: HashSet SourceName
</span><a href="#local-6989586621688027960"><span class="hs-identifier hs-var">ciSources</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SourceName] -&gt; HashSet SourceName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">HS.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([SourceName] -&gt; HashSet SourceName)
-&gt; [SourceName] -&gt; HashSet SourceName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sources -&gt; [SourceName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688027878"><span class="hs-identifier hs-var">newSources</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-358"></span><span>            </span><span class="annot"><span class="annottext">ciDataConnectors :: HashSet DataConnectorName
</span><a href="#local-6989586621688027962"><span class="hs-identifier hs-var">ciDataConnectors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span>  </span><span class="hs-comment">-- put the new metadata in the state managed by the `MetadataT`</span><span>
</span><span id="line-362"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#putMetadata"><span class="hs-identifier hs-type">putMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027841"><span class="hs-identifier hs-type">metadata</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-comment">-- build the schema cache with the new metadata</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithInvalidations"><span class="hs-identifier hs-type">buildSchemaCacheWithInvalidations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027956"><span class="hs-identifier hs-type">cacheInvalidations</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688027826"><span class="hs-identifier hs-type">_rmv2AllowInconsistentMetadata</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-368"></span><span>    </span><span class="annot"><span class="annottext">AllowInconsistentMetadata
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#AllowInconsistentMetadata"><span class="hs-identifier hs-var">AllowInconsistentMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; m ()
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">AllowInconsistentMetadata
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#NoAllowInconsistentMetadata"><span class="hs-identifier hs-var">NoAllowInconsistentMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *). (QErrM m, CacheRWM m) =&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#throwOnInconsistencies"><span class="hs-identifier hs-var">throwOnInconsistencies</span></a></span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>  </span><span class="hs-comment">-- populate future cron events for all the new cron triggers that are imported</span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span> </span><span class="annot"><a href="#local-6989586621688027839"><span class="hs-identifier hs-type">cronTriggersToBeAdded</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Hasura.RQL.Types.ScheduledTrigger.html#CronTriggerMetadata"><span class="hs-identifier hs-type">CronTriggerMetadata</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688027968"><span id="local-6989586621688027969"><span id="local-6989586621688027970"><span id="local-6989586621688027971"><span id="local-6989586621688027972"><span id="local-6989586621688027973"><span id="local-6989586621688027974"><span id="local-6989586621688027975"><span id="local-6989586621688027976"><span id="local-6989586621688027977"><span class="annot"><span class="annottext">Bool
[HeaderConf]
Maybe Text
Maybe Value
Maybe RequestTransform
Maybe MetadataResponseTransform
CronSchedule
InputWebhook
TriggerName
STRetryConf
ctName :: TriggerName
ctWebhook :: InputWebhook
ctSchedule :: CronSchedule
ctPayload :: Maybe Value
ctRetryConf :: STRetryConf
ctHeaders :: [HeaderConf]
ctIncludeInMetadata :: Bool
ctComment :: Maybe Text
ctRequestTransform :: Maybe RequestTransform
ctResponseTransform :: Maybe MetadataResponseTransform
ctResponseTransform :: CronTriggerMetadata -&gt; Maybe MetadataResponseTransform
ctRequestTransform :: CronTriggerMetadata -&gt; Maybe RequestTransform
ctComment :: CronTriggerMetadata -&gt; Maybe Text
ctIncludeInMetadata :: CronTriggerMetadata -&gt; Bool
ctHeaders :: CronTriggerMetadata -&gt; [HeaderConf]
ctRetryConf :: CronTriggerMetadata -&gt; STRetryConf
ctPayload :: CronTriggerMetadata -&gt; Maybe Value
ctSchedule :: CronTriggerMetadata -&gt; CronSchedule
ctWebhook :: CronTriggerMetadata -&gt; InputWebhook
ctName :: CronTriggerMetadata -&gt; TriggerName
</span><a href="#local-6989586621688027968"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>    </span><span class="annot"><span class="annottext">CronSchedule -&gt; TriggerName -&gt; m ()
forall (m :: * -&gt; *).
(MonadIO m, MonadError QErr m, MonadMetadataStorage m) =&gt;
CronSchedule -&gt; TriggerName -&gt; m ()
</span><a href="Hasura.RQL.DDL.ScheduledTrigger.html#populateInitialCronTriggerEvents"><span class="hs-identifier hs-var">populateInitialCronTriggerEvents</span></a></span><span> </span><span class="annot"><span class="annottext">CronSchedule
</span><a href="#local-6989586621688027970"><span class="hs-identifier hs-var">ctSchedule</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688027968"><span class="hs-identifier hs-var">ctName</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-comment">-- See Note [Cleanup for dropped triggers]</span><span>
</span><span id="line-376"></span><span>  </span><span class="annot"><a href="#local-6989586621688027989"><span class="hs-identifier hs-type">dropSourceSQLTriggers</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027831"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027837"><span class="hs-identifier hs-type">oldSchemaCache</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaSources"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027836"><span class="hs-identifier hs-type">oldMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaSources"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027841"><span class="hs-identifier hs-type">metadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>  </span><span id="local-6989586621688027990"><span class="annot"><a href="#local-6989586621688027990"><span class="hs-identifier hs-var">newSchemaCache</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-type">askSchemaCache</span></a></span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.EventTrigger.html#updateTriggerCleanupSchedules"><span class="hs-identifier hs-type">updateTriggerCleanupSchedules</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027831"><span class="hs-identifier hs-type">logger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaSources"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027836"><span class="hs-identifier hs-type">oldMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaSources"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027841"><span class="hs-identifier hs-type">metadata</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688027990"><span class="hs-identifier hs-type">newSchemaCache</span></a></span><span>
</span><span id="line-381"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">`onLeft`</span></span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688027994"><span class="annot"><a href="#local-6989586621688027994"><span class="hs-identifier hs-var hs-var">droppedSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Sources -&gt; Sources -&gt; Sources
forall k v w.
(Eq k, Hashable k) =&gt;
InsOrdHashMap k v -&gt; InsOrdHashMap k w -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#difference"><span class="hs-identifier hs-var">InsOrdHashMap.difference</span></a></span><span> </span><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688027877"><span class="hs-identifier hs-var">oldSources</span></a></span><span> </span><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688027878"><span class="hs-identifier hs-var">newSources</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-comment">-- Clean up the sources that are not present in the new metadata</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-type">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027994"><span class="hs-identifier hs-type">droppedSources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688027996"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027996"><span class="hs-identifier hs-var">oldSource</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688027997"><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688027997"><span class="hs-identifier hs-var">oldSourceBackendMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>    </span><span class="annot"><span class="annottext">SchemaCache -&gt; SourceName -&gt; AnyBackend SourceMetadata -&gt; m ()
forall (m :: * -&gt; *) r.
(MonadError QErr m, MonadIO m, MonadBaseControl IO m,
 MonadReader r m, Has (Logger Hasura) r, MonadWarnings m) =&gt;
SchemaCache -&gt; SourceName -&gt; AnyBackend SourceMetadata -&gt; m ()
</span><a href="Hasura.RQL.DDL.Metadata.html#postDropSourceHookHelper"><span class="hs-identifier hs-var">postDropSourceHookHelper</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621688027837"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688027996"><span class="hs-identifier hs-var">oldSource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; AnyBackend SourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendSourceMetadata"><span class="hs-identifier hs-var">unBackendSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688027997"><span class="hs-identifier hs-var">oldSourceBackendMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621688027990"><span class="hs-identifier hs-type">newSchemaCache</span></a></span><span>
</span><span id="line-390"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-comment">{- Note [Cron triggers behaviour with replace metadata]
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

    When the metadata is replaced, we delete only the cron triggers
    that were deleted, instead of deleting all the old cron triggers (which
    existed in the metadata before it was replaced) and inserting all the
    new cron triggers. This is done this way, because when a cron trigger is
    dropped, the cron events associated with it will also be dropped from the DB
    and when a new cron trigger is added, new cron events are generated by the
    graphql-engine. So, this way we only delete and insert the data which has been changed.

    The cron triggers that were deleted is calculated by getting a diff
    of the old cron triggers and the new cron triggers. Note that we don't just
    check the name of the trigger to calculate the diff, the whole cron trigger
    definition is considered in the calculation.

    Note: Only cron triggers with `include_in_metadata` set to `true` can be updated/deleted
    via the replace metadata API. Cron triggers with `include_in_metadata` can only be modified
    via the `create_cron_trigger` and `delete_cron_trigger` APIs.

    -}</span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621688027840"><span class="annot"><span class="annottext">processCronTriggers :: Metadata
-&gt; m (CronTriggers, HashMap TriggerName CronTriggerMetadata)
</span><a href="#local-6989586621688027840"><span class="hs-identifier hs-var hs-var">processCronTriggers</span></a></span></span><span> </span><span id="local-6989586621688027999"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027999"><span class="hs-identifier hs-var">oldMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-413"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621688028000"><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028000"><span class="hs-identifier hs-var hs-var">oldCronTriggersIncludedInMetadata</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688028001"><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028001"><span class="hs-identifier hs-var hs-var">oldCronTriggersNotIncludedInMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-414"></span><span>            </span><span class="annot"><span class="annottext">(CronTriggerMetadata -&gt; Bool)
-&gt; CronTriggers -&gt; (CronTriggers, CronTriggers)
forall k v.
Hashable k =&gt;
(v -&gt; Bool)
-&gt; InsOrdHashMap k v -&gt; (InsOrdHashMap k v, InsOrdHashMap k v)
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.HashMap.Strict.InsOrd.Extended.html/Data.HashMap.Strict.InsOrd.Extended.html#partition"><span class="hs-identifier hs-var">InsOrdHashMap.partition</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; Bool
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctIncludeInMetadata"><span class="hs-identifier hs-var">ctIncludeInMetadata</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Metadata -&gt; CronTriggers
</span><a href="Hasura.RQL.Types.Metadata.html#_metaCronTriggers"><span class="hs-identifier hs-var">_metaCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688027999"><span class="hs-identifier hs-var">oldMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>          </span><span id="local-6989586621688028003"><span class="annot"><span class="annottext">allNewCronTriggers :: CronTriggers
</span><a href="#local-6989586621688028003"><span class="hs-identifier hs-var hs-var hs-var">allNewCronTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ReplaceMetadataV1
</span><a href="#local-6989586621688027828"><span class="hs-identifier hs-var">_rmv2Metadata</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-417"></span><span>              </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMWithoutSources"><span class="hs-identifier hs-type">RMWithoutSources</span></a></span><span> </span><span id="local-6989586621688028004"><span class="annot"><span class="annottext">MetadataNoSources
</span><a href="#local-6989586621688028004"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetadataNoSources -&gt; CronTriggers
</span><a href="Hasura.RQL.Types.Metadata.html#_mnsCronTriggers"><span class="hs-identifier hs-var">_mnsCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataNoSources
</span><a href="#local-6989586621688028004"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-418"></span><span>              </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RMWithSources"><span class="hs-identifier hs-type">RMWithSources</span></a></span><span> </span><span id="local-6989586621688028005"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028005"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; CronTriggers
</span><a href="Hasura.RQL.Types.Metadata.html#_metaCronTriggers"><span class="hs-identifier hs-var">_metaCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028005"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-419"></span><span>          </span><span class="hs-comment">-- this function is intended to use with `HashMap.differenceWith`, it's used when two</span><span>
</span><span id="line-420"></span><span>          </span><span class="hs-comment">-- equal keys are encountered, then the values are compared to calculate the diff.</span><span>
</span><span id="line-421"></span><span>          </span><span class="hs-comment">-- see https://hackage.haskell.org/package/unordered-containers-0.2.14.0/docs/Data-HashMap-Internal.html#v:differenceWith</span><span>
</span><span id="line-422"></span><span>          </span><span id="local-6989586621688028008"><span class="annot"><span class="annottext">leftIfDifferent :: a -&gt; a -&gt; Maybe a
</span><a href="#local-6989586621688028008"><span class="hs-identifier hs-var hs-var hs-var">leftIfDifferent</span></a></span></span><span> </span><span id="local-6989586621688028009"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688028009"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621688028010"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688028010"><span class="hs-identifier hs-var">r</span></a></span></span><span>
</span><span id="line-423"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688028009"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688028010"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-424"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621688028009"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-425"></span><span>          </span><span id="local-6989586621688028011"><span class="annot"><span class="annottext">cronTriggersToBeAdded :: HashMap TriggerName CronTriggerMetadata
</span><a href="#local-6989586621688028011"><span class="hs-identifier hs-var hs-var hs-var">cronTriggersToBeAdded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-426"></span><span>            </span><span class="annot"><span class="annottext">(CronTriggerMetadata
 -&gt; CronTriggerMetadata -&gt; Maybe CronTriggerMetadata)
-&gt; HashMap TriggerName CronTriggerMetadata
-&gt; HashMap TriggerName CronTriggerMetadata
-&gt; HashMap TriggerName CronTriggerMetadata
forall k v w.
(Eq k, Hashable k) =&gt;
(v -&gt; w -&gt; Maybe v) -&gt; HashMap k v -&gt; HashMap k w -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashMap.Internal.Strict.html/Data.HashMap.Internal.Strict.html#differenceWith"><span class="hs-identifier hs-var">HashMap.differenceWith</span></a></span><span>
</span><span id="line-427"></span><span>              </span><span class="annot"><span class="annottext">CronTriggerMetadata
-&gt; CronTriggerMetadata -&gt; Maybe CronTriggerMetadata
forall {a}. Eq a =&gt; a -&gt; a -&gt; Maybe a
</span><a href="#local-6989586621688028008"><span class="hs-identifier hs-var">leftIfDifferent</span></a></span><span>
</span><span id="line-428"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggers -&gt; HashMap TriggerName CronTriggerMetadata
forall k v. InsOrdHashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toHashMap"><span class="hs-identifier hs-var">InsOrdHashMap.toHashMap</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028003"><span class="hs-identifier hs-var">allNewCronTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggers -&gt; HashMap TriggerName CronTriggerMetadata
forall k v. InsOrdHashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toHashMap"><span class="hs-identifier hs-var">InsOrdHashMap.toHashMap</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028000"><span class="hs-identifier hs-var">oldCronTriggersIncludedInMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>          </span><span id="local-6989586621688028014"><span class="annot"><span class="annottext">cronTriggersToBeDropped :: HashMap TriggerName CronTriggerMetadata
</span><a href="#local-6989586621688028014"><span class="hs-identifier hs-var hs-var hs-var">cronTriggersToBeDropped</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-431"></span><span>            </span><span class="annot"><span class="annottext">(CronTriggerMetadata
 -&gt; CronTriggerMetadata -&gt; Maybe CronTriggerMetadata)
-&gt; HashMap TriggerName CronTriggerMetadata
-&gt; HashMap TriggerName CronTriggerMetadata
-&gt; HashMap TriggerName CronTriggerMetadata
forall k v w.
(Eq k, Hashable k) =&gt;
(v -&gt; w -&gt; Maybe v) -&gt; HashMap k v -&gt; HashMap k w -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashMap.Internal.Strict.html/Data.HashMap.Internal.Strict.html#differenceWith"><span class="hs-identifier hs-var">HashMap.differenceWith</span></a></span><span>
</span><span id="line-432"></span><span>              </span><span class="annot"><span class="annottext">CronTriggerMetadata
-&gt; CronTriggerMetadata -&gt; Maybe CronTriggerMetadata
forall {a}. Eq a =&gt; a -&gt; a -&gt; Maybe a
</span><a href="#local-6989586621688028008"><span class="hs-identifier hs-var">leftIfDifferent</span></a></span><span>
</span><span id="line-433"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggers -&gt; HashMap TriggerName CronTriggerMetadata
forall k v. InsOrdHashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toHashMap"><span class="hs-identifier hs-var">InsOrdHashMap.toHashMap</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028000"><span class="hs-identifier hs-var">oldCronTriggersIncludedInMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggers -&gt; HashMap TriggerName CronTriggerMetadata
forall k v. InsOrdHashMap k v -&gt; HashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toHashMap"><span class="hs-identifier hs-var">InsOrdHashMap.toHashMap</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028003"><span class="hs-identifier hs-var">allNewCronTriggers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>      </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ClearCronEvents -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
ClearCronEvents -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#dropFutureCronEvents"><span class="hs-identifier hs-var">dropFutureCronEvents</span></a></span><span> </span><span class="annot"><span class="annottext">(ClearCronEvents -&gt; m (Either QErr ()))
-&gt; ClearCronEvents -&gt; m (Either QErr ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[TriggerName] -&gt; ClearCronEvents
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#MetadataCronTriggers"><span class="hs-identifier hs-var">MetadataCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">([TriggerName] -&gt; ClearCronEvents)
-&gt; [TriggerName] -&gt; ClearCronEvents
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerMetadata -&gt; [TriggerName]
forall k v. HashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashMap.Internal.html/Data.HashMap.Internal.html#keys"><span class="hs-identifier hs-var">HashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap TriggerName CronTriggerMetadata
</span><a href="#local-6989586621688028014"><span class="hs-identifier hs-var">cronTriggersToBeDropped</span></a></span><span>
</span><span id="line-436"></span><span>      </span><span id="local-6989586621688028019"><span class="annot"><a href="#local-6989586621688028019"><span class="hs-identifier hs-var">cronTriggers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-comment">-- traverse over the new cron triggers and check if any of them</span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-comment">-- already exists as a cron trigger with &quot;included_in_metadata: false&quot;</span><span>
</span><span id="line-439"></span><span>        </span><span class="annot"><span class="annottext">CronTriggers -&gt; (CronTriggerMetadata -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028003"><span class="hs-identifier hs-var">allNewCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">((CronTriggerMetadata -&gt; m ()) -&gt; m ())
-&gt; (CronTriggerMetadata -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688028020"><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621688028020"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-440"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621688028020"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; CronTriggers -&gt; Bool
forall k a. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#member"><span class="hs-operator hs-var">`InsOrdHashMap.member`</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028001"><span class="hs-identifier hs-var">oldCronTriggersNotIncludedInMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span>            </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#AlreadyExists"><span class="hs-identifier hs-var">AlreadyExists</span></a></span><span>
</span><span id="line-442"></span><span>            </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;cron trigger with name &quot;</span></span><span>
</span><span id="line-443"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; TriggerName
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctName"><span class="hs-identifier hs-var">ctName</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata
</span><a href="#local-6989586621688028020"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-444"></span><span>            </span><span class="annot"><span class="annottext">TriggerName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; already exists as a cron trigger with \&quot;included_in_metadata\&quot; as false&quot;</span></span><span>
</span><span id="line-445"></span><span>        </span><span class="hs-comment">-- we add the old cron triggers with included_in_metadata set to false with the</span><span>
</span><span id="line-446"></span><span>        </span><span class="hs-comment">-- newly added cron triggers</span><span>
</span><span id="line-447"></span><span>        </span><span class="annot"><span class="annottext">CronTriggers -&gt; m CronTriggers
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CronTriggers -&gt; m CronTriggers) -&gt; CronTriggers -&gt; m CronTriggers
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028003"><span class="hs-identifier hs-var">allNewCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggers -&gt; CronTriggers -&gt; CronTriggers
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CronTriggers
</span><a href="#local-6989586621688028001"><span class="hs-identifier hs-var">oldCronTriggersNotIncludedInMetadata</span></a></span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621688028019"><span class="hs-identifier hs-type">cronTriggers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621688028011"><span class="hs-identifier hs-type">cronTriggersToBeAdded</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span>    </span><span class="annot"><a href="#local-6989586621688027989"><span class="hs-identifier hs-type">dropSourceSQLTriggers</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-451"></span><span>      </span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span class="annot"><a href="Hasura.Logging.html#Hasura"><span class="hs-identifier hs-type">HL.Hasura</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#SchemaCache"><span class="hs-identifier hs-type">SchemaCache</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-453"></span><span>      </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#InsOrdHashMap"><span class="hs-identifier hs-type">InsOrdHashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-454"></span><span>      </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#InsOrdHashMap"><span class="hs-identifier hs-type">InsOrdHashMap</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-455"></span><span>      </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span>    </span><span id="local-6989586621688027989"><span class="annot"><span class="annottext">dropSourceSQLTriggers :: Logger Hasura -&gt; SchemaCache -&gt; Sources -&gt; Sources -&gt; m ()
</span><a href="#local-6989586621688027989"><span class="hs-identifier hs-var hs-var">dropSourceSQLTriggers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Logging.html#Logger"><span class="hs-identifier hs-type">HL.Logger</span></a></span><span> </span><span id="local-6989586621688028024"><span class="annot"><span class="annottext">forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621688028024"><span class="hs-identifier hs-var">logger</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621688028025"><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621688028025"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span></span><span> </span><span id="local-6989586621688028026"><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688028026"><span class="hs-identifier hs-var">oldSources</span></a></span></span><span> </span><span id="local-6989586621688028027"><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688028027"><span class="hs-identifier hs-var">newSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-comment">-- NOTE: the current implementation of this function has an edge case.</span><span>
</span><span id="line-458"></span><span>      </span><span class="hs-comment">-- The edge case is that when a `SourceA` which contained some event triggers</span><span>
</span><span id="line-459"></span><span>      </span><span class="hs-comment">-- is modified to point to a new database, this function will try to drop the</span><span>
</span><span id="line-460"></span><span>      </span><span class="hs-comment">-- SQL triggers of the dropped event triggers on the new database which doesn't exist.</span><span>
</span><span id="line-461"></span><span>      </span><span class="hs-comment">-- In the current implementation, this doesn't throw an error because the trigger is dropped</span><span>
</span><span id="line-462"></span><span>      </span><span class="hs-comment">-- using `DROP IF EXISTS..` meaning this silently fails without throwing an error.</span><span>
</span><span id="line-463"></span><span>      </span><span class="annot"><span class="annottext">[(SourceName, BackendSourceMetadata)]
-&gt; ((SourceName, BackendSourceMetadata) -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Sources -&gt; [(SourceName, BackendSourceMetadata)]
forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-var">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688028027"><span class="hs-identifier hs-var">newSources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((SourceName, BackendSourceMetadata) -&gt; m ()) -&gt; m ())
-&gt; ((SourceName, BackendSourceMetadata) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688028028"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688028029"><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688028029"><span class="hs-identifier hs-var">newBackendSourceMetadata</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-464"></span><span>        </span><span class="annot"><span class="annottext">Maybe BackendSourceMetadata
-&gt; (BackendSourceMetadata -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; Sources -&gt; Maybe BackendSourceMetadata
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#lookup"><span class="hs-identifier hs-var">InsOrdHashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Sources
</span><a href="#local-6989586621688028026"><span class="hs-identifier hs-var">oldSources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((BackendSourceMetadata -&gt; m ()) -&gt; m ())
-&gt; (BackendSourceMetadata -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688028030"><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688028030"><span class="hs-identifier hs-var">oldBackendSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-465"></span><span>          </span><span class="annot"><span class="annottext">SourceName
-&gt; AnyBackend SourceMetadata
-&gt; AnyBackend SourceMetadata
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    SourceMetadata b -&gt; SourceMetadata b -&gt; m ())
-&gt; m ()
forall (i :: BackendType -&gt; *).
SourceName
-&gt; AnyBackend i
-&gt; AnyBackend i
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    i b -&gt; i b -&gt; m ())
-&gt; m ()
</span><a href="#local-6989586621688028031"><span class="hs-identifier hs-var">compose</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; AnyBackend SourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendSourceMetadata"><span class="hs-identifier hs-var">unBackendSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688028029"><span class="hs-identifier hs-var">newBackendSourceMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BackendSourceMetadata -&gt; AnyBackend SourceMetadata
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendSourceMetadata"><span class="hs-identifier hs-var">unBackendSourceMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688028030"><span class="hs-identifier hs-var">oldBackendSourceMetadata</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688028034"><span id="local-6989586621688028035"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688028035"><span class="hs-identifier hs-var">newSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SourceMetadata"><span class="hs-identifier hs-type">SourceMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028034"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-466"></span><span>            </span><span class="annot"><span class="annottext">BackendSourceMetadata
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    SourceMetadata b -&gt; SourceMetadata b -&gt; m ())
-&gt; SourceMetadata b
-&gt; m ()
forall {r}.
BackendSourceMetadata
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    SourceMetadata b -&gt; r)
-&gt; r
</span><a href="#local-6989586621688027914"><span class="hs-identifier hs-var">dispatch</span></a></span><span> </span><span class="annot"><span class="annottext">BackendSourceMetadata
</span><a href="#local-6989586621688028030"><span class="hs-identifier hs-var">oldBackendSourceMetadata</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688028099"><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688028099"><span class="hs-identifier hs-var">oldSourceMetadata</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-467"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028100"><span class="annot"><span class="annottext">oldTriggersMap :: InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028100"><span class="hs-identifier hs-var hs-var">oldTriggersMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall (b :: BackendType).
SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getTriggersMap"><span class="hs-identifier hs-var">getTriggersMap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688028099"><span class="hs-identifier hs-var">oldSourceMetadata</span></a></span><span>
</span><span id="line-468"></span><span>                  </span><span id="local-6989586621688028101"><span class="annot"><span class="annottext">newTriggersMap :: InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028101"><span class="hs-identifier hs-var hs-var">newTriggersMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall (b :: BackendType).
SourceMetadata b -&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getTriggersMap"><span class="hs-identifier hs-var">getTriggersMap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceMetadata b
</span><a href="#local-6989586621688028035"><span class="hs-identifier hs-var">newSourceMetadata</span></a></span><span>
</span><span id="line-469"></span><span>                  </span><span id="local-6989586621688028102"><span class="annot"><span class="annottext">droppedEventTriggers :: [TriggerName]
</span><a href="#local-6989586621688028102"><span class="hs-identifier hs-var hs-var">droppedEventTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; [TriggerName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">(InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; [TriggerName])
-&gt; InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; [TriggerName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028100"><span class="hs-identifier hs-var">oldTriggersMap</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
-&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
-&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall k v w.
(Eq k, Hashable k) =&gt;
InsOrdHashMap k v -&gt; InsOrdHashMap k w -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#difference"><span class="hs-operator hs-var">`InsOrdHashMap.difference`</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028101"><span class="hs-identifier hs-var">newTriggersMap</span></a></span><span>
</span><span id="line-470"></span><span>                  </span><span id="local-6989586621688028103"><span class="annot"><span class="annottext">retainedNewTriggers :: InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028103"><span class="hs-identifier hs-var hs-var">retainedNewTriggers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028101"><span class="hs-identifier hs-var">newTriggersMap</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
-&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
-&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
forall k v w.
(Eq k, Hashable k) =&gt;
InsOrdHashMap k v -&gt; InsOrdHashMap k w -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#intersection"><span class="hs-operator hs-var">`InsOrdHashMap.intersection`</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028100"><span class="hs-identifier hs-var">oldTriggersMap</span></a></span><span>
</span><span id="line-471"></span><span>                  </span><span id="local-6989586621688028117"><span class="annot"><span class="annottext">catcher :: QErr -&gt; f ()
</span><a href="#local-6989586621688028117"><span class="hs-identifier hs-var hs-var">catcher</span></a></span></span><span> </span><span id="local-6989586621688028118"><span class="annot"><span class="annottext">e :: QErr
</span><a href="#local-6989586621688028118"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688028120"><span class="annot"><span class="annottext">Code
qeCode :: Code
qeCode :: QErr -&gt; Code
</span><a href="#local-6989586621688028120"><span class="hs-identifier hs-var hs-var">qeCode</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-472"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="#local-6989586621688028120"><span class="hs-identifier hs-var">qeCode</span></a></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Code -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-var">Unexpected</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- NOTE: This information should be returned by the inconsistent_metadata response, so doesn't need additional logging.</span><span>
</span><span id="line-473"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; f ()
forall a. QErr -&gt; f a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">QErr
</span><a href="#local-6989586621688028118"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-comment">-- rethrow other errors</span><span>
</span><span id="line-474"></span><span>                  </span><span id="local-6989586621688028123"><span class="annot"><span class="annottext">sourceObjID :: MetadataObjId
</span><a href="#local-6989586621688028123"><span class="hs-identifier hs-var hs-var">sourceObjID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-475"></span><span>                    </span><span class="annot"><span class="annottext">SourceName -&gt; MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOSource"><span class="hs-identifier hs-var">MOSource</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>              </span><span class="hs-comment">-- This will swallow Unexpected exceptions for sources if allow_inconsistent_metadata is enabled</span><span>
</span><span id="line-478"></span><span>              </span><span class="hs-comment">-- This should be ok since if the sources are already missing from the cache then they should</span><span>
</span><span id="line-479"></span><span>              </span><span class="hs-comment">-- not need to be removed.</span><span>
</span><span id="line-480"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-481"></span><span>              </span><span class="hs-comment">-- TODO: Determine if any errors should be thrown from askSourceConfig at all if the errors are just being discarded</span><span>
</span><span id="line-482"></span><span>              </span><span class="annot"><span class="annottext">m () -&gt; SourceMetadata b -&gt; m ()
forall a. a -&gt; SourceMetadata b -&gt; a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span>
</span><span id="line-483"></span><span>                </span><span class="annot"><span class="annottext">(m () -&gt; SourceMetadata b -&gt; m ())
-&gt; m () -&gt; SourceMetadata b -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; (QErr -&gt; m ()) -&gt; m ()) -&gt; (QErr -&gt; m ()) -&gt; m () -&gt; m ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; (QErr -&gt; m ()) -&gt; m ()
forall a. m a -&gt; (QErr -&gt; m a) -&gt; m a
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-identifier hs-var">catchError</span></span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m ()
forall {f :: * -&gt; *}. MonadError QErr f =&gt; QErr -&gt; f ()
</span><a href="#local-6989586621688028117"><span class="hs-identifier hs-var">catcher</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-484"></span><span>                  </span><span id="local-6989586621688028126"><span class="annot"><a href="#local-6989586621688028126"><span class="hs-identifier hs-var">sourceConfigMaybe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(CacheRM m, Backend b) =&gt;
SourceName -&gt; m (Maybe (SourceConfig b))
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSourceConfigMaybe"><span class="hs-identifier hs-var">askSourceConfigMaybe</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688028034"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-485"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688028126"><span class="hs-identifier hs-type">sourceConfigMaybe</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-486"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (SourceConfig b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-487"></span><span>                      </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b) -&gt; Bool
forall a. InsOrdHashMap TriggerName a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028100"><span class="hs-identifier hs-var">oldTriggersMap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-488"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028128"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621688028128"><span class="hs-identifier hs-var hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-489"></span><span>                              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Could not drop SQL triggers present in the source '&quot;</span></span><span>
</span><span id="line-490"></span><span>                                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-491"></span><span>                                </span><span class="annot"><span class="annottext">SourceName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;' as it is inconsistent.&quot;</span></span><span>
</span><span id="line-492"></span><span>                                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; While creating an event trigger, Hasura creates SQL triggers on the table.&quot;</span></span><span>
</span><span id="line-493"></span><span>                                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Please refer https://hasura.io/docs/latest/graphql/core/event-triggers/remove-event-triggers/#clean-up-event-trigger-footprints-manually &quot;</span></span><span>
</span><span id="line-494"></span><span>                                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; to delete the sql triggers from the database manually.&quot;</span></span><span>
</span><span id="line-495"></span><span>                                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; For more details, please refer https://hasura.io/docs/latest/graphql/core/event-triggers/index.html &quot;</span></span><span>
</span><span id="line-496"></span><span>                        </span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarning -&gt; m ()) -&gt; MetadataWarning -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WarningCode -&gt; MetadataObjId -&gt; Text -&gt; MetadataWarning
</span><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarning"><span class="hs-identifier hs-var">MetadataWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarningCode
</span><a href="Hasura.RQL.DDL.Warnings.html#WCSourceCleanupFailed"><span class="hs-identifier hs-var">WCSourceCleanupFailed</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621688028123"><span class="hs-identifier hs-var">sourceObjID</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028128"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-497"></span><span>                        </span><span class="annot"><span class="annottext">MetadataLog -&gt; m ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621688028024"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataLog -&gt; m ()) -&gt; MetadataLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; Value -&gt; MetadataLog
</span><a href="Hasura.Server.Logging.html#MetadataLog"><span class="hs-identifier hs-var">MetadataLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">HL.LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028128"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span>
</span><span id="line-498"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688028129"><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621688028129"><span class="hs-identifier hs-var">sourceConfig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>                      </span><span class="annot"><span class="annottext">[TriggerName] -&gt; (TriggerName -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="annot"><span class="annottext">[TriggerName]
</span><a href="#local-6989586621688028102"><span class="hs-identifier hs-var">droppedEventTriggers</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621688028130"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028130"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-500"></span><span>                        </span><span class="hs-comment">-- TODO: The `tableName` parameter could be computed while building</span><span>
</span><span id="line-501"></span><span>                        </span><span class="hs-comment">-- the triggers map and avoid the cache lookup.</span><span>
</span><span id="line-502"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SchemaCache -&gt; SourceName -&gt; TriggerName -&gt; Maybe (TableName b)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getTableNameFromTrigger"><span class="hs-identifier hs-var">getTableNameFromTrigger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688028034"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621688028025"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028130"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-503"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (TableName b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-504"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028132"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621688028132"><span class="hs-identifier hs-var hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="#local-6989586621688028133"><span class="hs-identifier hs-var">sqlTriggerError</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028130"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-505"></span><span>                            </span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarning -&gt; m ()) -&gt; MetadataWarning -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WarningCode -&gt; MetadataObjId -&gt; Text -&gt; MetadataWarning
</span><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarning"><span class="hs-identifier hs-var">MetadataWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarningCode
</span><a href="Hasura.RQL.DDL.Warnings.html#WCSourceCleanupFailed"><span class="hs-identifier hs-var">WCSourceCleanupFailed</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621688028123"><span class="hs-identifier hs-var">sourceObjID</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028132"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-506"></span><span>                            </span><span class="annot"><span class="annottext">MetadataLog -&gt; m ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621688028024"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataLog -&gt; m ()) -&gt; MetadataLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; Value -&gt; MetadataLog
</span><a href="Hasura.Server.Logging.html#MetadataLog"><span class="hs-identifier hs-var">MetadataLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">HL.LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028132"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span>
</span><span id="line-507"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688028134"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028134"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-508"></span><span>                            </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadIO m, MonadError QErr m) =&gt;
SourceConfig b -&gt; TriggerName -&gt; TableName b -&gt; m ()
</span><a href="Hasura.Eventing.Backend.html#dropTriggerAndArchiveEvents"><span class="hs-identifier hs-var">dropTriggerAndArchiveEvents</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688028034"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621688028129"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028130"><span class="hs-identifier hs-var">triggerName</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028134"><span class="hs-identifier hs-var">tableName</span></a></span><span>
</span><span id="line-509"></span><span>                      </span><span class="annot"><span class="annottext">[(TriggerName, EventTriggerConf b)]
-&gt; ((TriggerName, EventTriggerConf b) -&gt; m ()) -&gt; m ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><span class="hs-identifier hs-var">for_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
-&gt; [(TriggerName, EventTriggerConf b)]
forall k v. InsOrdHashMap k v -&gt; [(k, v)]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#toList"><span class="hs-identifier hs-var">InsOrdHashMap.toList</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028103"><span class="hs-identifier hs-var">retainedNewTriggers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((TriggerName, EventTriggerConf b) -&gt; m ()) -&gt; m ())
-&gt; ((TriggerName, EventTriggerConf b) -&gt; m ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621688028136"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028136"><span class="hs-identifier hs-var">retainedNewTriggerName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621688028137"><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621688028137"><span class="hs-identifier hs-var">retainedNewTriggerConf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-510"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TriggerName
-&gt; InsOrdHashMap TriggerName (EventTriggerConf b)
-&gt; Maybe (EventTriggerConf b)
forall k v. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k v -&gt; Maybe v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#lookup"><span class="hs-identifier hs-var">InsOrdHashMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028136"><span class="hs-identifier hs-var">retainedNewTriggerName</span></a></span><span> </span><span class="annot"><span class="annottext">InsOrdHashMap TriggerName (EventTriggerConf b)
</span><a href="#local-6989586621688028100"><span class="hs-identifier hs-var">oldTriggersMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-511"></span><span>                          </span><span class="annot"><span class="annottext">Maybe (EventTriggerConf b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-512"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028138"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621688028138"><span class="hs-identifier hs-var hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="#local-6989586621688028133"><span class="hs-identifier hs-var">sqlTriggerError</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028136"><span class="hs-identifier hs-var">retainedNewTriggerName</span></a></span><span>
</span><span id="line-513"></span><span>                            </span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarning -&gt; m ()) -&gt; MetadataWarning -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WarningCode -&gt; MetadataObjId -&gt; Text -&gt; MetadataWarning
</span><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarning"><span class="hs-identifier hs-var">MetadataWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarningCode
</span><a href="Hasura.RQL.DDL.Warnings.html#WCSourceCleanupFailed"><span class="hs-identifier hs-var">WCSourceCleanupFailed</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621688028123"><span class="hs-identifier hs-var">sourceObjID</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028138"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-514"></span><span>                            </span><span class="annot"><span class="annottext">MetadataLog -&gt; m ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621688028024"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataLog -&gt; m ()) -&gt; MetadataLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; Value -&gt; MetadataLog
</span><a href="Hasura.Server.Logging.html#MetadataLog"><span class="hs-identifier hs-var">MetadataLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">HL.LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028138"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span>
</span><span id="line-515"></span><span>                          </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688028139"><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621688028139"><span class="hs-identifier hs-var">oldTriggerConf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-516"></span><span>                            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028140"><span class="annot"><span class="annottext">newTriggerOps :: TriggerOpsDef b
</span><a href="#local-6989586621688028140"><span class="hs-identifier hs-var hs-var">newTriggerOps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerOpsDef b
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621688028137"><span class="hs-identifier hs-var">retainedNewTriggerConf</span></a></span><span>
</span><span id="line-517"></span><span>                                </span><span id="local-6989586621688028142"><span class="annot"><span class="annottext">oldTriggerOps :: TriggerOpsDef b
</span><a href="#local-6989586621688028142"><span class="hs-identifier hs-var hs-var">oldTriggerOps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b -&gt; TriggerOpsDef b
forall (b :: BackendType). EventTriggerConf b -&gt; TriggerOpsDef b
</span><a href="Hasura.RQL.Types.EventTrigger.html#etcDefinition"><span class="hs-identifier hs-var">etcDefinition</span></a></span><span> </span><span class="annot"><span class="annottext">EventTriggerConf b
</span><a href="#local-6989586621688028139"><span class="hs-identifier hs-var">oldTriggerConf</span></a></span><span>
</span><span id="line-518"></span><span>                                </span><span id="local-6989586621688028143"><span class="annot"><span class="annottext">isDroppedOp :: Maybe a -&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621688028143"><span class="hs-identifier hs-var hs-var">isDroppedOp</span></a></span></span><span> </span><span id="local-6989586621688028144"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621688028144"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span id="local-6989586621688028145"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621688028145"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621688028144"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621688028145"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-519"></span><span>                                </span><span id="local-6989586621688028149"><span class="annot"><span class="annottext">droppedOps :: [Maybe Ops]
</span><a href="#local-6989586621688028149"><span class="hs-identifier hs-var hs-var">droppedOps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-520"></span><span>                                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Ops -&gt; Maybe Ops -&gt; Bool -&gt; Maybe Ops
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">Maybe Ops
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ops -&gt; Maybe Ops
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ops
</span><a href="Hasura.RQL.Types.EventTrigger.html#INSERT"><span class="hs-identifier hs-var">INSERT</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (SubscribeOpSpec b) -&gt; Maybe (SubscribeOpSpec b) -&gt; Bool
forall {a} {a}. Maybe a -&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621688028143"><span class="hs-identifier hs-var">isDroppedOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
forall (b :: BackendType).
TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
</span><a href="Hasura.RQL.Types.EventTrigger.html#tdInsert"><span class="hs-identifier hs-var">tdInsert</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621688028142"><span class="hs-identifier hs-var">oldTriggerOps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
forall (b :: BackendType).
TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
</span><a href="Hasura.RQL.Types.EventTrigger.html#tdInsert"><span class="hs-identifier hs-var">tdInsert</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621688028140"><span class="hs-identifier hs-var">newTriggerOps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-521"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Ops -&gt; Maybe Ops -&gt; Bool -&gt; Maybe Ops
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">Maybe Ops
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ops -&gt; Maybe Ops
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ops
</span><a href="Hasura.RQL.Types.EventTrigger.html#UPDATE"><span class="hs-identifier hs-var">UPDATE</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (SubscribeOpSpec b) -&gt; Maybe (SubscribeOpSpec b) -&gt; Bool
forall {a} {a}. Maybe a -&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621688028143"><span class="hs-identifier hs-var">isDroppedOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
forall (b :: BackendType).
TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
</span><a href="Hasura.RQL.Types.EventTrigger.html#tdUpdate"><span class="hs-identifier hs-var">tdUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621688028142"><span class="hs-identifier hs-var">oldTriggerOps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
forall (b :: BackendType).
TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
</span><a href="Hasura.RQL.Types.EventTrigger.html#tdUpdate"><span class="hs-identifier hs-var">tdUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621688028140"><span class="hs-identifier hs-var">newTriggerOps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-522"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Ops -&gt; Maybe Ops -&gt; Bool -&gt; Maybe Ops
forall a. a -&gt; a -&gt; Bool -&gt; a
</span><span class="hs-identifier hs-var">bool</span></span><span> </span><span class="annot"><span class="annottext">Maybe Ops
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ops -&gt; Maybe Ops
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Ops
</span><a href="Hasura.RQL.Types.EventTrigger.html#DELETE"><span class="hs-identifier hs-var">ET.DELETE</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (SubscribeOpSpec b) -&gt; Maybe (SubscribeOpSpec b) -&gt; Bool
forall {a} {a}. Maybe a -&gt; Maybe a -&gt; Bool
</span><a href="#local-6989586621688028143"><span class="hs-identifier hs-var">isDroppedOp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
forall (b :: BackendType).
TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
</span><a href="Hasura.RQL.Types.EventTrigger.html#tdDelete"><span class="hs-identifier hs-var">tdDelete</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621688028142"><span class="hs-identifier hs-var">oldTriggerOps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
forall (b :: BackendType).
TriggerOpsDef b -&gt; Maybe (SubscribeOpSpec b)
</span><a href="Hasura.RQL.Types.EventTrigger.html#tdDelete"><span class="hs-identifier hs-var">tdDelete</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerOpsDef b
</span><a href="#local-6989586621688028140"><span class="hs-identifier hs-var">newTriggerOps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>                                  </span><span class="hs-special">]</span><span>
</span><span id="line-524"></span><span>                            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SchemaCache -&gt; SourceName -&gt; TriggerName -&gt; Maybe (TableName b)
</span><a href="Hasura.RQL.DDL.EventTrigger.html#getTableNameFromTrigger"><span class="hs-identifier hs-var">getTableNameFromTrigger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688028034"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621688028025"><span class="hs-identifier hs-var">oldSchemaCache</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028028"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028136"><span class="hs-identifier hs-var">retainedNewTriggerName</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-525"></span><span>                              </span><span class="annot"><span class="annottext">Maybe (TableName b)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028157"><span class="annot"><span class="annottext">message :: Text
</span><a href="#local-6989586621688028157"><span class="hs-identifier hs-var hs-var hs-var">message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; Text
</span><a href="#local-6989586621688028133"><span class="hs-identifier hs-var">sqlTriggerError</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028136"><span class="hs-identifier hs-var">retainedNewTriggerName</span></a></span><span>
</span><span id="line-527"></span><span>                                </span><span class="annot"><span class="annottext">MetadataWarning -&gt; m ()
forall (m :: * -&gt; *). MonadWarnings m =&gt; MetadataWarning -&gt; m ()
</span><a href="Hasura.RQL.DDL.Warnings.html#warn"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataWarning -&gt; m ()) -&gt; MetadataWarning -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">WarningCode -&gt; MetadataObjId -&gt; Text -&gt; MetadataWarning
</span><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarning"><span class="hs-identifier hs-var">MetadataWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarningCode
</span><a href="Hasura.RQL.DDL.Warnings.html#WCSourceCleanupFailed"><span class="hs-identifier hs-var">WCSourceCleanupFailed</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="#local-6989586621688028123"><span class="hs-identifier hs-var">sourceObjID</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028157"><span class="hs-identifier hs-var">message</span></a></span><span>
</span><span id="line-528"></span><span>                                </span><span class="annot"><span class="annottext">MetadataLog -&gt; m ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621688028024"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(MetadataLog -&gt; m ()) -&gt; MetadataLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; Text -&gt; Value -&gt; MetadataLog
</span><a href="Hasura.Server.Logging.html#MetadataLog"><span class="hs-identifier hs-var">MetadataLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelWarn"><span class="hs-identifier hs-var">HL.LevelWarn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028157"><span class="hs-identifier hs-var">message</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span>
</span><span id="line-529"></span><span>                              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688028158"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028158"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-530"></span><span>                                </span><span class="annot"><span class="annottext">forall (b :: BackendType) (m :: * -&gt; *).
(BackendEventTrigger b, MonadIO m, MonadError QErr m) =&gt;
SourceConfig b -&gt; TriggerName -&gt; TableName b -&gt; HashSet Ops -&gt; m ()
</span><a href="Hasura.Eventing.Backend.html#dropDanglingSQLTrigger"><span class="hs-identifier hs-var">dropDanglingSQLTrigger</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688028034"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceConfig b
</span><a href="#local-6989586621688028129"><span class="hs-identifier hs-var">sourceConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028136"><span class="hs-identifier hs-var">retainedNewTriggerName</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028158"><span class="hs-identifier hs-var">tableName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ops] -&gt; HashSet Ops
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">HS.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([Ops] -&gt; HashSet Ops) -&gt; [Ops] -&gt; HashSet Ops
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe Ops] -&gt; [Ops]
forall a. [Maybe a] -&gt; [a]
forall (f :: * -&gt; *) a. Filterable f =&gt; f (Maybe a) -&gt; f a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/witherable-0.5-ed5d92584b79c1fa03d7efeb1159ae93eef86189605b088dd8806eb40d0b16f5/share/doc/html/src/Witherable.html/Witherable.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe Ops]
</span><a href="#local-6989586621688028149"><span class="hs-identifier hs-var">droppedOps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-532"></span><span>        </span><span id="local-6989586621688026877"><span class="annot"><a href="#local-6989586621688028031"><span class="hs-identifier hs-type">compose</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-533"></span><span>          </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-534"></span><span>          </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026877"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-535"></span><span>          </span><span class="annot"><a href="Hasura.SQL.AnyBackend.html#AnyBackend"><span class="hs-identifier hs-type">AB.AnyBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026877"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-536"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688026876"><span class="annot"><a href="#local-6989586621688026876"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026876"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688026877"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026876"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688026877"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026876"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-537"></span><span>          </span><span class="annot"><a href="#local-6989586621688026725"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-538"></span><span>        </span><span id="local-6989586621688028031"><span class="annot"><span class="annottext">compose :: forall (i :: BackendType -&gt; *).
SourceName
-&gt; AnyBackend i
-&gt; AnyBackend i
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    i b -&gt; i b -&gt; m ())
-&gt; m ()
</span><a href="#local-6989586621688028031"><span class="hs-identifier hs-var hs-var">compose</span></a></span></span><span> </span><span id="local-6989586621688028169"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028169"><span class="hs-identifier hs-var">sourceName</span></a></span></span><span> </span><span id="local-6989586621688028170"><span class="annot"><span class="annottext">AnyBackend i
</span><a href="#local-6989586621688028170"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621688028171"><span class="annot"><span class="annottext">AnyBackend i
</span><a href="#local-6989586621688028171"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621688028172"><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendEventTrigger b =&gt;
i b -&gt; i b -&gt; m ()
</span><a href="#local-6989586621688028172"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
(forall (b :: BackendType). c b =&gt; i b -&gt; i b -&gt; r)
-&gt; AnyBackend i -&gt; AnyBackend i -&gt; r -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#composeAnyBackend"><span class="hs-identifier hs-var">AB.composeAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">i b -&gt; i b -&gt; m ()
forall (b :: BackendType).
BackendEventTrigger b =&gt;
i b -&gt; i b -&gt; m ()
</span><a href="#local-6989586621688028172"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend i
</span><a href="#local-6989586621688028170"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend i
</span><a href="#local-6989586621688028171"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnstructuredLog -&gt; m ()
forall a (m :: * -&gt; *).
(ToEngineLog a Hasura, MonadIO m) =&gt;
a -&gt; m ()
</span><a href="#local-6989586621688028024"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">(UnstructuredLog -&gt; m ()) -&gt; UnstructuredLog -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">LogLevel -&gt; SerializableBlob -&gt; UnstructuredLog
</span><a href="Hasura.Logging.html#UnstructuredLog"><span class="hs-identifier hs-var">HL.UnstructuredLog</span></a></span><span> </span><span class="annot"><span class="annottext">LogLevel
</span><a href="Hasura.Logging.html#LevelInfo"><span class="hs-identifier hs-var">HL.LevelInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(SerializableBlob -&gt; UnstructuredLog)
-&gt; SerializableBlob -&gt; UnstructuredLog
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; SerializableBlob
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.SerializableBlob.html/Data.SerializableBlob.html#fromText"><span class="hs-identifier hs-var">SB.fromText</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; SerializableBlob) -&gt; Text -&gt; SerializableBlob
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Event trigger clean up couldn't be done on the source &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028169"><span class="hs-identifier hs-var">sourceName</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; because it has changed its type&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>
</span><span id="line-540"></span><span>        </span><span class="annot"><a href="#local-6989586621688028133"><span class="hs-identifier hs-type">sqlTriggerError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.EventTrigger.html#TriggerName"><span class="hs-identifier hs-type">TriggerName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-541"></span><span>        </span><span id="local-6989586621688028133"><span class="annot"><span class="annottext">sqlTriggerError :: TriggerName -&gt; Text
</span><a href="#local-6989586621688028133"><span class="hs-identifier hs-var hs-var">sqlTriggerError</span></a></span></span><span> </span><span id="local-6989586621688028179"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028179"><span class="hs-identifier hs-var">triggerName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-542"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Could not drop SQL triggers associated with event trigger '&quot;</span></span><span>
</span><span id="line-543"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028179"><span class="hs-identifier hs-var">triggerName</span></a></span><span>
</span><span id="line-544"></span><span>              </span><span class="annot"><span class="annottext">TriggerName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'. While creating an event trigger, Hasura creates SQL triggers on the table.&quot;</span></span><span>
</span><span id="line-545"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Please refer https://hasura.io/docs/latest/graphql/core/event-triggers/remove-event-triggers/#clean-up-event-trigger-footprints-manually &quot;</span></span><span>
</span><span id="line-546"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; to delete the sql triggers from the database manually.&quot;</span></span><span>
</span><span id="line-547"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; For more details, please refer https://hasura.io/docs/latest/graphql/core/event-triggers/index.html &quot;</span></span><span>
</span><span id="line-548"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>
</span><span id="line-550"></span><span>    </span><span id="local-6989586621688027914"><span class="annot"><span class="annottext">dispatch :: BackendSourceMetadata
-&gt; (forall (b :: BackendType).
    BackendEventTrigger b =&gt;
    SourceMetadata b -&gt; r)
-&gt; r
</span><a href="#local-6989586621688027914"><span class="hs-identifier hs-var hs-var">dispatch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#BackendSourceMetadata"><span class="hs-identifier hs-type">BackendSourceMetadata</span></a></span><span> </span><span id="local-6989586621688028187"><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621688028187"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.Eventing.Backend.html#BackendEventTrigger"><span class="hs-identifier hs-type">BackendEventTrigger</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadata
</span><a href="#local-6989586621688028187"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-551"></span><span>
</span><span id="line-552"></span><span class="annot"><span class="hs-comment">-- | Only includes the cron triggers with `included_in_metadata` set to `True`</span></span><span>
</span><span id="line-553"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#processCronTriggersMetadata"><span class="hs-identifier hs-type">processCronTriggersMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#Metadata"><span class="hs-identifier hs-type">Metadata</span></a></span><span>
</span><span id="line-554"></span><span id="processCronTriggersMetadata"><span class="annot"><span class="annottext">processCronTriggersMetadata :: Metadata -&gt; Metadata
</span><a href="Hasura.RQL.DDL.Metadata.html#processCronTriggersMetadata"><span class="hs-identifier hs-var hs-var">processCronTriggersMetadata</span></a></span></span><span> </span><span id="local-6989586621688028189"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028189"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028190"><span class="annot"><span class="annottext">cronTriggersIncludedInMetadata :: CronTriggers
</span><a href="#local-6989586621688028190"><span class="hs-identifier hs-var hs-var">cronTriggersIncludedInMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CronTriggerMetadata -&gt; Bool) -&gt; CronTriggers -&gt; CronTriggers
forall v k. (v -&gt; Bool) -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#filter"><span class="hs-identifier hs-var">InsOrdHashMap.filter</span></a></span><span> </span><span class="annot"><span class="annottext">CronTriggerMetadata -&gt; Bool
</span><a href="Hasura.RQL.Types.ScheduledTrigger.html#ctIncludeInMetadata"><span class="hs-identifier hs-var">ctIncludeInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(CronTriggers -&gt; CronTriggers) -&gt; CronTriggers -&gt; CronTriggers
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; CronTriggers
</span><a href="Hasura.RQL.Types.Metadata.html#_metaCronTriggers"><span class="hs-identifier hs-var">_metaCronTriggers</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028189"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-556"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028189"><span class="hs-identifier hs-var">metadata</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaCronTriggers"><span class="hs-identifier hs-var">_metaCronTriggers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621688028190"><span class="hs-identifier hs-type">cronTriggersIncludedInMetadata</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runExportMetadata"><span class="hs-identifier hs-type">runExportMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-559"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688026915"><span class="annot"><a href="#local-6989586621688026915"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-560"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026915"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026915"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ExportMetadata"><span class="hs-identifier hs-type">ExportMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-562"></span><span>  </span><span class="annot"><a href="#local-6989586621688026915"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-563"></span><span id="runExportMetadata"><span class="annot"><span class="annottext">runExportMetadata :: forall (m :: * -&gt; *).
(QErrM m, MetadataM m) =&gt;
ExportMetadata -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runExportMetadata"><span class="hs-identifier hs-var hs-var">runExportMetadata</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ExportMetadata"><span class="hs-identifier hs-type">ExportMetadata</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-564"></span><span>  </span><span class="annot"><span class="annottext">Value -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromOrderedValue"><span class="hs-identifier hs-var">encJFromOrderedValue</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; EncJSON) -&gt; (Metadata -&gt; Value) -&gt; Metadata -&gt; EncJSON
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Value
</span><a href="Hasura.RQL.Types.Metadata.html#metadataToOrdJSON"><span class="hs-identifier hs-var">metadataToOrdJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; EncJSON) -&gt; m Metadata -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Metadata -&gt; Metadata
</span><a href="Hasura.RQL.DDL.Metadata.html#processCronTriggersMetadata"><span class="hs-identifier hs-var">processCronTriggersMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; m Metadata -&gt; m Metadata
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Metadata
forall (m :: * -&gt; *). MetadataM m =&gt; m Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runExportMetadataV2"><span class="hs-identifier hs-type">runExportMetadataV2</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688026919"><span class="annot"><a href="#local-6989586621688026919"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026919"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026919"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-569"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#MetadataResourceVersion"><span class="hs-identifier hs-type">MetadataResourceVersion</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ExportMetadata"><span class="hs-identifier hs-type">ExportMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-571"></span><span>  </span><span class="annot"><a href="#local-6989586621688026919"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span><span>
</span><span id="line-572"></span><span id="runExportMetadataV2"><span class="annot"><span class="annottext">runExportMetadataV2 :: forall (m :: * -&gt; *).
(QErrM m, MetadataM m) =&gt;
MetadataResourceVersion -&gt; ExportMetadata -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runExportMetadataV2"><span class="hs-identifier hs-var hs-var">runExportMetadataV2</span></a></span></span><span> </span><span id="local-6989586621688028216"><span class="annot"><span class="annottext">MetadataResourceVersion
</span><a href="#local-6989586621688028216"><span class="hs-identifier hs-var">currentResourceVersion</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ExportMetadata"><span class="hs-identifier hs-type">ExportMetadata</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-573"></span><span>  </span><span id="local-6989586621688028217"><span class="annot"><a href="#local-6989586621688028217"><span class="hs-identifier hs-var">exportMetadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Metadata
</span><a href="Hasura.RQL.DDL.Metadata.html#processCronTriggersMetadata"><span class="hs-identifier hs-var">processCronTriggersMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; m Metadata -&gt; m Metadata
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Metadata
forall (m :: * -&gt; *). MetadataM m =&gt; m Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a></span><span>
</span><span id="line-574"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-575"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromOrderedValue"><span class="hs-identifier hs-type">encJFromOrderedValue</span></a></span><span>
</span><span id="line-576"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src/Data.Aeson.Ordered.html/Data.Aeson.Ordered.html#object"><span class="hs-identifier hs-type">AO.object</span></a></span><span>
</span><span id="line-577"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;resource_version&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/aeson-ordered-0.1.0.0/opt/doc/html/aeson-ordered/src/Data.Aeson.Ordered.html/Data.Aeson.Ordered.html#toOrdered"><span class="hs-identifier hs-type">AO.toOrdered</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028216"><span class="hs-identifier hs-type">currentResourceVersion</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;metadata&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#metadataToOrdJSON"><span class="hs-identifier hs-type">metadataToOrdJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028217"><span class="hs-identifier hs-type">exportMetadata</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span id="local-6989586621688026923"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runReloadMetadata"><span class="hs-identifier hs-type">runReloadMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026923"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026923"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026923"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReloadMetadata"><span class="hs-identifier hs-type">ReloadMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688026923"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-582"></span><span id="runReloadMetadata"><span class="annot"><span class="annottext">runReloadMetadata :: forall (m :: * -&gt; *).
(QErrM m, CacheRWM m, MetadataM m) =&gt;
ReloadMetadata -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runReloadMetadata"><span class="hs-identifier hs-var hs-var">runReloadMetadata</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#ReloadMetadata"><span class="hs-identifier hs-type">ReloadMetadata</span></a></span><span> </span><span id="local-6989586621688028312"><span class="annot"><span class="annottext">ReloadRemoteSchemas
</span><a href="#local-6989586621688028312"><span class="hs-identifier hs-var">reloadRemoteSchemas</span></a></span></span><span> </span><span id="local-6989586621688028313"><span class="annot"><span class="annottext">ReloadSources
</span><a href="#local-6989586621688028313"><span class="hs-identifier hs-var">reloadSources</span></a></span></span><span> </span><span id="local-6989586621688028314"><span class="annot"><span class="annottext">ReloadSources
</span><a href="#local-6989586621688028314"><span class="hs-identifier hs-var">reloadRecreateEventTriggers</span></a></span></span><span> </span><span id="local-6989586621688028315"><span class="annot"><span class="annottext">ReloadDataConnectors
</span><a href="#local-6989586621688028315"><span class="hs-identifier hs-var">reloadDataConnectors</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-583"></span><span>  </span><span id="local-6989586621688028316"><span class="annot"><a href="#local-6989586621688028316"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Metadata
forall (m :: * -&gt; *). MetadataM m =&gt; m Metadata
</span><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-var">getMetadata</span></a></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028317"><span class="annot"><a href="#local-6989586621688028317"><span class="hs-identifier hs-var hs-var">allSources</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SourceName] -&gt; HashSet SourceName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">HS.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([SourceName] -&gt; HashSet SourceName)
-&gt; [SourceName] -&gt; HashSet SourceName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Sources -&gt; [SourceName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">(Sources -&gt; [SourceName]) -&gt; Sources -&gt; [SourceName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Sources
</span><a href="Hasura.RQL.Types.Metadata.html#_metaSources"><span class="hs-identifier hs-var">_metaSources</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028316"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-585"></span><span>      </span><span id="local-6989586621688028318"><span class="annot"><a href="#local-6989586621688028318"><span class="hs-identifier hs-var hs-var">allRemoteSchemas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RemoteSchemaName] -&gt; HashSet RemoteSchemaName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">HS.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([RemoteSchemaName] -&gt; HashSet RemoteSchemaName)
-&gt; [RemoteSchemaName] -&gt; HashSet RemoteSchemaName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemas -&gt; [RemoteSchemaName]
forall k v. InsOrdHashMap k v -&gt; [k]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#keys"><span class="hs-identifier hs-var">InsOrdHashMap.keys</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteSchemas -&gt; [RemoteSchemaName])
-&gt; RemoteSchemas -&gt; [RemoteSchemaName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; RemoteSchemas
</span><a href="Hasura.RQL.Types.Metadata.html#_metaRemoteSchemas"><span class="hs-identifier hs-var">_metaRemoteSchemas</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028316"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-586"></span><span>      </span><span id="local-6989586621688028320"><span class="annot"><a href="#local-6989586621688028320"><span class="hs-identifier hs-var hs-var">allDataConnectors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-587"></span><span>        </span><span class="annot"><span class="annottext">HashSet DataConnectorName
-&gt; (BackendConfigWrapper 'DataConnector
    -&gt; HashSet DataConnectorName)
-&gt; Maybe (BackendConfigWrapper 'DataConnector)
-&gt; HashSet DataConnectorName
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DataConnectorName] -&gt; HashSet DataConnectorName
forall a. (Eq a, Hashable a) =&gt; [a] -&gt; HashSet a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#fromList"><span class="hs-identifier hs-var">HS.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([DataConnectorName] -&gt; HashSet DataConnectorName)
-&gt; (BackendConfigWrapper 'DataConnector -&gt; [DataConnectorName])
-&gt; BackendConfigWrapper 'DataConnector
-&gt; HashSet DataConnectorName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map DataConnectorName DataConnectorOptions -&gt; [DataConnectorName]
forall k a. Map k a -&gt; [k]
</span><span class="hs-identifier hs-var">Map.keys</span></span><span> </span><span class="annot"><span class="annottext">(Map DataConnectorName DataConnectorOptions -&gt; [DataConnectorName])
-&gt; (BackendConfigWrapper 'DataConnector
    -&gt; Map DataConnectorName DataConnectorOptions)
-&gt; BackendConfigWrapper 'DataConnector
-&gt; [DataConnectorName]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BackendConfigWrapper 'DataConnector
-&gt; Map DataConnectorName DataConnectorOptions
BackendConfigWrapper 'DataConnector -&gt; BackendConfig 'DataConnector
forall (b :: BackendType).
BackendConfigWrapper b -&gt; BackendConfig b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendConfigWrapper"><span class="hs-identifier hs-var">unBackendConfigWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>          </span><span class="annot"><span class="annottext">(Maybe (BackendConfigWrapper 'DataConnector)
 -&gt; HashSet DataConnectorName)
-&gt; Maybe (BackendConfigWrapper 'DataConnector)
-&gt; HashSet DataConnectorName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
HasTag b =&gt;
BackendMap i -&gt; Maybe (i b)
</span><a href="Hasura.SQL.BackendMap.html#lookup"><span class="hs-identifier hs-var">BackendMap.lookup</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#DataConnector"><span class="hs-identifier hs-type">DataConnector</span></a></span><span>
</span><span id="line-589"></span><span>          </span><span class="annot"><span class="annottext">(BackendMap BackendConfigWrapper
 -&gt; Maybe (BackendConfigWrapper 'DataConnector))
-&gt; BackendMap BackendConfigWrapper
-&gt; Maybe (BackendConfigWrapper 'DataConnector)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; BackendMap BackendConfigWrapper
</span><a href="Hasura.RQL.Types.Metadata.html#_metaBackendConfigs"><span class="hs-identifier hs-var">_metaBackendConfigs</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028316"><span class="hs-identifier hs-var">metadata</span></a></span><span>
</span><span id="line-590"></span><span>      </span><span id="local-6989586621688028326"><span class="annot"><a href="#local-6989586621688028326"><span class="hs-identifier hs-var hs-var">checkRemoteSchema</span></a></span></span><span> </span><span id="local-6989586621688028327"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028327"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-591"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; HashSet RemoteSchemaName -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">HS.member</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028327"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621688028318"><span class="hs-identifier hs-var">allRemoteSchemas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>          </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span>
</span><span id="line-593"></span><span>          </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Remote schema with name &quot;</span></span><span>
</span><span id="line-594"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028327"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-595"></span><span>          </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not found in metadata&quot;</span></span><span>
</span><span id="line-596"></span><span>      </span><span id="local-6989586621688028330"><span class="annot"><a href="#local-6989586621688028330"><span class="hs-identifier hs-var hs-var">checkSource</span></a></span></span><span> </span><span id="local-6989586621688028331"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028331"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-597"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceName -&gt; HashSet SourceName -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">HS.member</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028331"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028317"><span class="hs-identifier hs-var">allSources</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-598"></span><span>          </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span>
</span><span id="line-599"></span><span>          </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Source with name &quot;</span></span><span>
</span><span id="line-600"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028331"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-601"></span><span>          </span><span class="annot"><span class="annottext">SourceName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not found in metadata&quot;</span></span><span>
</span><span id="line-602"></span><span>      </span><span id="local-6989586621688028332"><span class="annot"><a href="#local-6989586621688028332"><span class="hs-identifier hs-var hs-var">checkDataConnector</span></a></span></span><span> </span><span id="local-6989586621688028333"><span class="annot"><span class="annottext">DataConnectorName
</span><a href="#local-6989586621688028333"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-603"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataConnectorName -&gt; HashSet DataConnectorName -&gt; Bool
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/unordered-containers-0.2.20-6d56f9b3abc6011ddb6e237c415126423ab5ceb5c078221bba2ff80dbe921009/share/doc/html/src/Data.HashSet.Internal.html/Data.HashSet.Internal.html#member"><span class="hs-identifier hs-var">HS.member</span></a></span><span> </span><span class="annot"><span class="annottext">DataConnectorName
</span><a href="#local-6989586621688028333"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621688028320"><span class="hs-identifier hs-var">allDataConnectors</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-604"></span><span>          </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; m ()
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400"><span class="hs-identifier hs-var">throw400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#NotExists"><span class="hs-identifier hs-var">NotExists</span></a></span><span>
</span><span id="line-605"></span><span>          </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Data connector with name &quot;</span></span><span>
</span><span id="line-606"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">DataConnectorName
</span><a href="#local-6989586621688028333"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-607"></span><span>          </span><span class="annot"><span class="annottext">DataConnectorName -&gt; Text -&gt; Text
forall t. ToTxt t =&gt; t -&gt; Text -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Text.Extended.html/Data.Text.Extended.html#%3C%3C%3E"><span class="hs-operator hs-var">&lt;&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; not found in metadata&quot;</span></span><span>
</span><span id="line-608"></span><span>
</span><span id="line-609"></span><span>  </span><span id="local-6989586621688028334"><span class="annot"><a href="#local-6989586621688028334"><span class="hs-identifier hs-var">remoteSchemaInvalidations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688028312"><span class="hs-identifier hs-type">reloadRemoteSchemas</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-610"></span><span>    </span><span class="annot"><span class="annottext">ReloadRemoteSchemas
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadAll"><span class="hs-identifier hs-var">RSReloadAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName -&gt; m (HashSet RemoteSchemaName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621688028318"><span class="hs-identifier hs-var">allRemoteSchemas</span></a></span><span>
</span><span id="line-611"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadList"><span class="hs-identifier hs-type">RSReloadList</span></a></span><span> </span><span id="local-6989586621688028337"><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621688028337"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(RemoteSchemaName -&gt; m ()) -&gt; HashSet RemoteSchemaName -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; m ()
</span><a href="#local-6989586621688028326"><span class="hs-identifier hs-var">checkRemoteSchema</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621688028337"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
-&gt; m (HashSet RemoteSchemaName) -&gt; m (HashSet RemoteSchemaName)
forall a b. m a -&gt; m b -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName -&gt; m (HashSet RemoteSchemaName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621688028337"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-612"></span><span>  </span><span id="local-6989586621688028339"><span class="annot"><a href="#local-6989586621688028339"><span class="hs-identifier hs-var">sourcesInvalidations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688028313"><span class="hs-identifier hs-type">reloadSources</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><span class="annottext">ReloadSources
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadAll"><span class="hs-identifier hs-var">RSReloadAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashSet SourceName -&gt; m (HashSet SourceName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028317"><span class="hs-identifier hs-var">allSources</span></a></span><span>
</span><span id="line-614"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadList"><span class="hs-identifier hs-type">RSReloadList</span></a></span><span> </span><span id="local-6989586621688028340"><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028340"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SourceName -&gt; m ()) -&gt; HashSet SourceName -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; m ()
</span><a href="#local-6989586621688028330"><span class="hs-identifier hs-var">checkSource</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028340"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (HashSet SourceName) -&gt; m (HashSet SourceName)
forall a b. m a -&gt; m b -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName -&gt; m (HashSet SourceName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028340"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-615"></span><span>  </span><span id="local-6989586621688028341"><span class="annot"><a href="#local-6989586621688028341"><span class="hs-identifier hs-var">recreateEventTriggersSources</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688028314"><span class="hs-identifier hs-type">reloadRecreateEventTriggers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><span class="annottext">ReloadSources
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadAll"><span class="hs-identifier hs-var">RSReloadAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashSet SourceName -&gt; m (HashSet SourceName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028317"><span class="hs-identifier hs-var">allSources</span></a></span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadList"><span class="hs-identifier hs-type">RSReloadList</span></a></span><span> </span><span id="local-6989586621688028342"><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028342"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SourceName -&gt; m ()) -&gt; HashSet SourceName -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; m ()
</span><a href="#local-6989586621688028330"><span class="hs-identifier hs-var">checkSource</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028342"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m (HashSet SourceName) -&gt; m (HashSet SourceName)
forall a b. m a -&gt; m b -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName -&gt; m (HashSet SourceName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028342"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-618"></span><span>  </span><span id="local-6989586621688028343"><span class="annot"><a href="#local-6989586621688028343"><span class="hs-identifier hs-var">dataConnectorInvalidations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688028315"><span class="hs-identifier hs-type">reloadDataConnectors</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><span class="annottext">ReloadDataConnectors
</span><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadAll"><span class="hs-identifier hs-var">RSReloadAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName -&gt; m (HashSet DataConnectorName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621688028320"><span class="hs-identifier hs-var">allDataConnectors</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#RSReloadList"><span class="hs-identifier hs-type">RSReloadList</span></a></span><span> </span><span id="local-6989586621688028344"><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621688028344"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DataConnectorName -&gt; m ()) -&gt; HashSet DataConnectorName -&gt; m ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="annot"><span class="annottext">DataConnectorName -&gt; m ()
</span><a href="#local-6989586621688028332"><span class="hs-identifier hs-var">checkDataConnector</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621688028344"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
-&gt; m (HashSet DataConnectorName) -&gt; m (HashSet DataConnectorName)
forall a b. m a -&gt; m b -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName -&gt; m (HashSet DataConnectorName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621688028344"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028345"><span class="annot"><a href="#local-6989586621688028345"><span class="hs-identifier hs-var hs-var">cacheInvalidations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-623"></span><span>        </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheInvalidations"><span class="hs-identifier hs-type">CacheInvalidations</span></a></span><span>
</span><span id="line-624"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ciMetadata :: Bool
</span><a href="#local-6989586621688027958"><span class="hs-identifier hs-var">ciMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span>
</span><span id="line-625"></span><span>            </span><span class="annot"><span class="annottext">ciRemoteSchemas :: HashSet RemoteSchemaName
</span><a href="#local-6989586621688027959"><span class="hs-identifier hs-var">ciRemoteSchemas</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet RemoteSchemaName
</span><a href="#local-6989586621688028334"><span class="hs-identifier hs-var">remoteSchemaInvalidations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-626"></span><span>            </span><span class="annot"><span class="annottext">ciSources :: HashSet SourceName
</span><a href="#local-6989586621688027960"><span class="hs-identifier hs-var">ciSources</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet SourceName
</span><a href="#local-6989586621688028339"><span class="hs-identifier hs-var">sourcesInvalidations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-627"></span><span>            </span><span class="annot"><span class="annottext">ciDataConnectors :: HashSet DataConnectorName
</span><a href="#local-6989586621688027962"><span class="hs-identifier hs-var">ciDataConnectors</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet DataConnectorName
</span><a href="#local-6989586621688028343"><span class="hs-identifier hs-var">dataConnectorInvalidations</span></a></span><span>
</span><span id="line-628"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCacheWithOptions"><span class="hs-identifier hs-type">buildSchemaCacheWithOptions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CatalogUpdate"><span class="hs-identifier hs-type">CatalogUpdate</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><a href="#local-6989586621688028341"><span class="hs-identifier hs-type">recreateEventTriggersSources</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688028345"><span class="hs-identifier hs-type">cacheInvalidations</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028316"><span class="hs-identifier hs-type">metadata</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>
</span><span id="line-631"></span><span>  </span><span id="local-6989586621688028348"><span class="annot"><a href="#local-6989586621688028348"><span class="hs-identifier hs-var">inconsObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-type">askSchemaCache</span></a></span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-633"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-type">encJFromJValue</span></a></span><span>
</span><span id="line-634"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-type">J.object</span></a></span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="hs-string">&quot;message&quot;</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-type">J..=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;success&quot;</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-636"></span><span>        </span><span class="annot"><span class="hs-string">&quot;is_consistent&quot;</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-type">J..=</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621688028348"><span class="hs-identifier hs-type">inconsObjs</span></a></span><span>
</span><span id="line-637"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-638"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;inconsistent_objects&quot;</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-type">J..=</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028348"><span class="hs-identifier hs-type">inconsObjs</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621688028348"><span class="hs-identifier hs-type">inconsObjs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-639"></span><span>
</span><span id="line-640"></span><span id="local-6989586621688026948"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runDumpInternalState"><span class="hs-identifier hs-type">runDumpInternalState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026948"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CacheRM"><span class="hs-identifier hs-type">CacheRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026948"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-642"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#DumpInternalState"><span class="hs-identifier hs-type">DumpInternalState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-643"></span><span>  </span><span class="annot"><a href="#local-6989586621688026948"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-644"></span><span id="runDumpInternalState"><span class="annot"><span class="annottext">runDumpInternalState :: forall (m :: * -&gt; *).
(QErrM m, CacheRM m) =&gt;
DumpInternalState -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runDumpInternalState"><span class="hs-identifier hs-var hs-var">runDumpInternalState</span></a></span></span><span> </span><span class="annot"><span class="annottext">DumpInternalState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-645"></span><span>  </span><span class="annot"><span class="annottext">SchemaCache -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; EncJSON) -&gt; m SchemaCache -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m SchemaCache
forall (m :: * -&gt; *). CacheRM m =&gt; m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-var">askSchemaCache</span></a></span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span id="local-6989586621688026951"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runGetInconsistentMetadata"><span class="hs-identifier hs-type">runGetInconsistentMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-648"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#CacheRM"><span class="hs-identifier hs-type">CacheRM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-649"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#GetInconsistentMetadata"><span class="hs-identifier hs-type">GetInconsistentMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>  </span><span class="annot"><a href="#local-6989586621688026951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-651"></span><span id="runGetInconsistentMetadata"><span class="annot"><span class="annottext">runGetInconsistentMetadata :: forall (m :: * -&gt; *).
(QErrM m, CacheRM m) =&gt;
GetInconsistentMetadata -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runGetInconsistentMetadata"><span class="hs-identifier hs-var hs-var">runGetInconsistentMetadata</span></a></span></span><span> </span><span class="annot"><span class="annottext">GetInconsistentMetadata
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-652"></span><span>  </span><span id="local-6989586621688028372"><span class="annot"><a href="#local-6989586621688028372"><span class="hs-identifier hs-var">inconsObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">(SchemaCache -&gt; [InconsistentMetadata])
-&gt; m SchemaCache -&gt; m [InconsistentMetadata]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m SchemaCache
forall (m :: * -&gt; *). CacheRM m =&gt; m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-var">askSchemaCache</span></a></span><span>
</span><span id="line-653"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-type">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#formatInconsistentObjs"><span class="hs-identifier hs-type">formatInconsistentObjs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028372"><span class="hs-identifier hs-type">inconsObjs</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#formatInconsistentObjs"><span class="hs-identifier hs-type">formatInconsistentObjs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#InconsistentMetadata"><span class="hs-identifier hs-type">InconsistentMetadata</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Warnings.html#MetadataWarnings"><span class="hs-identifier hs-type">MetadataWarnings</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span>
</span><span id="line-656"></span><span id="formatInconsistentObjs"><span class="annot"><span class="annottext">formatInconsistentObjs :: [InconsistentMetadata] -&gt; MetadataWarnings -&gt; Value
</span><a href="Hasura.RQL.DDL.Metadata.html#formatInconsistentObjs"><span class="hs-identifier hs-var hs-var">formatInconsistentObjs</span></a></span></span><span> </span><span id="local-6989586621688028373"><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621688028373"><span class="hs-identifier hs-var">inconsObjs</span></a></span></span><span> </span><span id="local-6989586621688028374"><span class="annot"><span class="annottext">MetadataWarnings
</span><a href="#local-6989586621688028374"><span class="hs-identifier hs-var">metadataWarnings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-657"></span><span>  </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">J.object</span></a></span><span>
</span><span id="line-658"></span><span>    </span><span class="annot"><span class="annottext">([Pair] -&gt; Value) -&gt; [Pair] -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;is_consistent&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Bool -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621688028373"><span class="hs-identifier hs-var">inconsObjs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-659"></span><span>        </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;inconsistent_objects&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [InconsistentMetadata] -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621688028373"><span class="hs-identifier hs-var">inconsObjs</span></a></span><span>
</span><span id="line-660"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><span class="annottext">[Pair] -&gt; [Pair] -&gt; [Pair]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;warnings&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; MetadataWarnings -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">MetadataWarnings
</span><a href="#local-6989586621688028374"><span class="hs-identifier hs-var">metadataWarnings</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MetadataWarnings -&gt; Bool
forall a. Seq a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">MetadataWarnings
</span><a href="#local-6989586621688028374"><span class="hs-identifier hs-var">metadataWarnings</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span id="local-6989586621688026955"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runDropInconsistentMetadata"><span class="hs-identifier hs-type">runDropInconsistentMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026955"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026955"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026955"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-665"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#DropInconsistentMetadata"><span class="hs-identifier hs-type">DropInconsistentMetadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-666"></span><span>  </span><span class="annot"><a href="#local-6989586621688026955"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-667"></span><span id="runDropInconsistentMetadata"><span class="annot"><span class="annottext">runDropInconsistentMetadata :: forall (m :: * -&gt; *).
(QErrM m, CacheRWM m, MetadataM m) =&gt;
DropInconsistentMetadata -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runDropInconsistentMetadata"><span class="hs-identifier hs-var hs-var">runDropInconsistentMetadata</span></a></span></span><span> </span><span class="annot"><span class="annottext">DropInconsistentMetadata
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>  </span><span id="local-6989586621688028413"><span class="annot"><a href="#local-6989586621688028413"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m SchemaCache
forall (m :: * -&gt; *). CacheRM m =&gt; m SchemaCache
</span><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-var">askSchemaCache</span></a></span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028414"><span class="annot"><a href="#local-6989586621688028414"><span class="hs-identifier hs-var hs-var">inconsSchObjs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MetadataObjId] -&gt; [MetadataObjId]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">L.nub</span></span><span> </span><span class="annot"><span class="annottext">([MetadataObjId] -&gt; [MetadataObjId])
-&gt; ([InconsistentMetadata] -&gt; [MetadataObjId])
-&gt; [InconsistentMetadata]
-&gt; [MetadataObjId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InconsistentMetadata -&gt; [MetadataObjId])
-&gt; [InconsistentMetadata] -&gt; [MetadataObjId]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="annot"><span class="annottext">InconsistentMetadata -&gt; [MetadataObjId]
</span><a href="Hasura.RQL.Types.Metadata.Object.html#imObjectIds"><span class="hs-identifier hs-var">imObjectIds</span></a></span><span> </span><span class="annot"><span class="annottext">([InconsistentMetadata] -&gt; [MetadataObjId])
-&gt; [InconsistentMetadata] -&gt; [MetadataObjId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SchemaCache -&gt; [InconsistentMetadata]
</span><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="annottext">SchemaCache
</span><a href="#local-6989586621688028413"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-670"></span><span>  </span><span class="hs-comment">-- Note: when building the schema cache, we try to put dependents after their dependencies in the</span><span>
</span><span id="line-671"></span><span>  </span><span class="hs-comment">-- list of inconsistent objects, so reverse the list to start with dependents first. This is not</span><span>
</span><span id="line-672"></span><span>  </span><span class="hs-comment">-- perfect &#8212; a completely accurate solution would require performing a topological sort &#8212; but it</span><span>
</span><span id="line-673"></span><span>  </span><span class="hs-comment">-- seems to work well enough for now.</span><span>
</span><span id="line-674"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688028418"><span class="annot"><a href="#local-6989586621688028418"><span class="hs-glyph hs-var hs-var">..</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">execWriterT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">tell</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#purgeMetadataObj"><span class="hs-identifier hs-type">purgeMetadataObj</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">reverse</span></span><span> </span><span class="annot"><a href="#local-6989586621688028414"><span class="hs-identifier hs-type">inconsSchObjs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>  </span><span id="local-6989586621688028424"><span class="annot"><a href="#local-6989586621688028424"><span class="hs-identifier hs-var">metadata</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#getMetadata"><span class="hs-identifier hs-type">getMetadata</span></a></span><span>
</span><span id="line-676"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#putMetadata"><span class="hs-identifier hs-type">putMetadata</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621688028418"><span class="hs-identifier hs-type">runMetadataModifier</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028424"><span class="hs-identifier hs-type">metadata</span></a></span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCache"><span class="hs-identifier hs-type">buildSchemaCache</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">mempty</span></span><span>
</span><span id="line-678"></span><span>  </span><span class="hs-comment">-- after building the schema cache, we need to check the inconsistent metadata, if any</span><span>
</span><span id="line-679"></span><span>  </span><span class="hs-comment">-- are only those which are not droppable</span><span>
</span><span id="line-680"></span><span>  </span><span id="local-6989586621688028426"><span class="annot"><a href="#local-6989586621688028426"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#scInconsistentObjs"><span class="hs-identifier hs-var">scInconsistentObjs</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;$&gt;</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.html#askSchemaCache"><span class="hs-identifier hs-type">askSchemaCache</span></a></span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028427"><span class="annot"><a href="#local-6989586621688028427"><span class="hs-identifier hs-var hs-var">droppableInconsistentObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InconsistentMetadata -&gt; Bool)
-&gt; [InconsistentMetadata] -&gt; [InconsistentMetadata]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="annot"><span class="annottext">InconsistentMetadata -&gt; Bool
</span><a href="Hasura.RQL.Types.Metadata.Object.html#droppableInconsistentMetadata"><span class="hs-identifier hs-var">droppableInconsistentMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">[InconsistentMetadata]
</span><a href="#local-6989586621688028426"><span class="hs-identifier hs-var">newInconsistentObjects</span></a></span><span>
</span><span id="line-682"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">null</span></span><span> </span><span class="annot"><a href="#local-6989586621688028427"><span class="hs-identifier hs-type">droppableInconsistentObjects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>    </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">throwError</span></span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-type">err400</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#Unexpected"><span class="hs-identifier hs-type">Unexpected</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;cannot continue due to new inconsistent metadata&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#qeInternal"><span class="hs-identifier hs-var">qeInternal</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#ExtraInternal"><span class="hs-identifier hs-type">ExtraInternal</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-type">J.toJSON</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028426"><span class="hs-identifier hs-type">newInconsistentObjects</span></a></span><span>
</span><span id="line-686"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-687"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">return</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#successMsg"><span class="hs-identifier hs-type">successMsg</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#purgeMetadataObj"><span class="hs-identifier hs-type">purgeMetadataObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MetadataObjId"><span class="hs-identifier hs-type">MetadataObjId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span>
</span><span id="line-690"></span><span id="purgeMetadataObj"><span class="annot"><span class="annottext">purgeMetadataObj :: MetadataObjId -&gt; MetadataModifier
</span><a href="Hasura.RQL.DDL.Metadata.html#purgeMetadataObj"><span class="hs-identifier hs-var hs-var">purgeMetadataObj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOSource"><span class="hs-identifier hs-type">MOSource</span></a></span><span> </span><span id="local-6989586621688028433"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028433"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Sources -&gt; Identity Sources) -&gt; Metadata -&gt; Identity Metadata
Lens' Metadata Sources
</span><a href="Hasura.RQL.Types.Metadata.html#metaSources"><span class="hs-identifier hs-var">metaSources</span></a></span><span> </span><span class="annot"><span class="annottext">((Sources -&gt; Identity Sources) -&gt; Metadata -&gt; Identity Metadata)
-&gt; (Sources -&gt; Sources) -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; Sources -&gt; Sources
forall k v.
(Eq k, Hashable k) =&gt;
k -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#delete"><span class="hs-identifier hs-var">InsOrdHashMap.delete</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028433"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOSourceObjId"><span class="hs-identifier hs-type">MOSourceObjId</span></a></span><span> </span><span id="local-6989586621688028435"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028435"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621688028436"><span class="annot"><span class="annottext">AnyBackend SourceMetadataObjId
</span><a href="#local-6989586621688028436"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (c :: BackendType -&gt; Constraint) (i :: BackendType -&gt; *) r.
AllBackendsSatisfy c =&gt;
AnyBackend i -&gt; (forall (b :: BackendType). c b =&gt; i b -&gt; r) -&gt; r
</span><a href="Hasura.SQL.AnyBackend.html#dispatchAnyBackend"><span class="hs-identifier hs-var">AB.dispatchAnyBackend</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">AnyBackend SourceMetadataObjId
</span><a href="#local-6989586621688028436"><span class="hs-identifier hs-var">exists</span></a></span><span> </span><span class="annot"><span class="annottext">((forall (b :: BackendType).
  BackendMetadata b =&gt;
  SourceMetadataObjId b -&gt; MetadataModifier)
 -&gt; MetadataModifier)
-&gt; (forall (b :: BackendType).
    BackendMetadata b =&gt;
    SourceMetadataObjId b -&gt; MetadataModifier)
-&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SourceName -&gt; SourceMetadataObjId b -&gt; MetadataModifier
forall (b :: BackendType).
BackendMetadata b =&gt;
SourceName -&gt; SourceMetadataObjId b -&gt; MetadataModifier
</span><a href="#local-6989586621688028439"><span class="hs-identifier hs-var">handleSourceObj</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028435"><span class="hs-identifier hs-var">source</span></a></span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MORemoteSchema"><span class="hs-identifier hs-type">MORemoteSchema</span></a></span><span> </span><span id="local-6989586621688028441"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028441"><span class="hs-identifier hs-var">rsn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#dropRemoteSchemaInMetadata"><span class="hs-identifier hs-var">dropRemoteSchemaInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028441"><span class="hs-identifier hs-var">rsn</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MORemoteSchemaPermissions"><span class="hs-identifier hs-type">MORemoteSchemaPermissions</span></a></span><span> </span><span id="local-6989586621688028444"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028444"><span class="hs-identifier hs-var">rsName</span></a></span></span><span> </span><span id="local-6989586621688028445"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028445"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; RoleName -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#dropRemoteSchemaPermissionInMetadata"><span class="hs-identifier hs-var">dropRemoteSchemaPermissionInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028444"><span class="hs-identifier hs-var">rsName</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028445"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-695"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MORemoteSchemaRemoteRelationship"><span class="hs-identifier hs-type">MORemoteSchemaRemoteRelationship</span></a></span><span> </span><span id="local-6989586621688028448"><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028448"><span class="hs-identifier hs-var">rsName</span></a></span></span><span> </span><span id="local-6989586621688028449"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621688028449"><span class="hs-identifier hs-var">typeName</span></a></span></span><span> </span><span id="local-6989586621688028450"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028450"><span class="hs-identifier hs-var">relName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><span class="annottext">RemoteSchemaName -&gt; Name -&gt; RelName -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#dropRemoteSchemaRemoteRelationshipInMetadata"><span class="hs-identifier hs-var">dropRemoteSchemaRemoteRelationshipInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteSchemaName
</span><a href="#local-6989586621688028448"><span class="hs-identifier hs-var">rsName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621688028449"><span class="hs-identifier hs-var">typeName</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028450"><span class="hs-identifier hs-var">relName</span></a></span><span>
</span><span id="line-697"></span><span>  </span><span class="annot"><span class="annottext">MetadataObjId
</span><a href="Hasura.RQL.Types.Metadata.Object.html#MOCustomTypes"><span class="hs-identifier hs-var">MOCustomTypes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MetadataModifier
</span><a href="Hasura.RQL.DDL.CustomTypes.html#clearCustomTypesInMetadata"><span class="hs-identifier hs-var">clearCustomTypesInMetadata</span></a></span><span>
</span><span id="line-698"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOAction"><span class="hs-identifier hs-type">MOAction</span></a></span><span> </span><span id="local-6989586621688028455"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621688028455"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActionName -&gt; MetadataModifier
</span><a href="Hasura.RQL.DDL.Action.html#dropActionInMetadata"><span class="hs-identifier hs-var">dropActionInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621688028455"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-comment">-- Nothing</span><span>
</span><span id="line-699"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOActionPermission"><span class="hs-identifier hs-type">MOActionPermission</span></a></span><span> </span><span id="local-6989586621688028458"><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621688028458"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621688028459"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028459"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActionName -&gt; RoleName -&gt; MetadataModifier
</span><a href="Hasura.RQL.DDL.Action.html#dropActionPermissionInMetadata"><span class="hs-identifier hs-var">dropActionPermissionInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">ActionName
</span><a href="#local-6989586621688028458"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028459"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-700"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOCronTrigger"><span class="hs-identifier hs-type">MOCronTrigger</span></a></span><span> </span><span id="local-6989586621688028462"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028462"><span class="hs-identifier hs-var">ctName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; MetadataModifier
</span><a href="Hasura.RQL.DDL.ScheduledTrigger.html#dropCronTriggerInMetadata"><span class="hs-identifier hs-var">dropCronTriggerInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028462"><span class="hs-identifier hs-var">ctName</span></a></span><span>
</span><span id="line-701"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOEndpoint"><span class="hs-identifier hs-type">MOEndpoint</span></a></span><span> </span><span id="local-6989586621688028465"><span class="annot"><span class="annottext">EndpointName
</span><a href="#local-6989586621688028465"><span class="hs-identifier hs-var">epName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EndpointName -&gt; MetadataModifier
</span><a href="Hasura.RQL.DDL.Endpoint.html#dropEndpointInMetadata"><span class="hs-identifier hs-var">dropEndpointInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointName
</span><a href="#local-6989586621688028465"><span class="hs-identifier hs-var">epName</span></a></span><span>
</span><span id="line-702"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOInheritedRole"><span class="hs-identifier hs-type">MOInheritedRole</span></a></span><span> </span><span id="local-6989586621688028468"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028468"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; MetadataModifier
</span><a href="Hasura.RQL.DDL.InheritedRoles.html#dropInheritedRoleInMetadata"><span class="hs-identifier hs-var">dropInheritedRoleInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028468"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-703"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOQueryCollectionsQuery"><span class="hs-identifier hs-type">MOQueryCollectionsQuery</span></a></span><span> </span><span id="local-6989586621688028471"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621688028471"><span class="hs-identifier hs-var">cName</span></a></span></span><span> </span><span id="local-6989586621688028472"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621688028472"><span class="hs-identifier hs-var">lq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CollectionName -&gt; ListedQuery -&gt; MetadataModifier
</span><a href="#local-6989586621688028473"><span class="hs-identifier hs-var">dropListedQueryFromQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621688028471"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621688028472"><span class="hs-identifier hs-var">lq</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MODataConnectorAgent"><span class="hs-identifier hs-type">MODataConnectorAgent</span></a></span><span> </span><span id="local-6989586621688028475"><span class="annot"><span class="annottext">DataConnectorName
</span><a href="#local-6989586621688028475"><span class="hs-identifier hs-var">agentName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-705"></span><span>    </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span>
</span><span id="line-706"></span><span>      </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(BackendMap BackendConfigWrapper
 -&gt; Identity (BackendMap BackendConfigWrapper))
-&gt; Metadata -&gt; Identity Metadata
Lens' Metadata (BackendMap BackendConfigWrapper)
</span><a href="Hasura.RQL.Types.Metadata.html#metaBackendConfigs"><span class="hs-identifier hs-var">metaBackendConfigs</span></a></span><span>
</span><span id="line-707"></span><span>      </span><span class="annot"><span class="annottext">((BackendMap BackendConfigWrapper
  -&gt; Identity (BackendMap BackendConfigWrapper))
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; (BackendMap BackendConfigWrapper
    -&gt; BackendMap BackendConfigWrapper)
-&gt; Metadata
-&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType) (i :: BackendType -&gt; *).
(HasTag b, Monoid (i b)) =&gt;
(i b -&gt; i b) -&gt; BackendMap i -&gt; BackendMap i
</span><a href="Hasura.SQL.BackendMap.html#modify"><span class="hs-identifier hs-var">BackendMap.modify</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#DataConnector"><span class="hs-identifier hs-type">DataConnector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map DataConnectorName DataConnectorOptions
-&gt; BackendConfigWrapper 'DataConnector
BackendConfig 'DataConnector -&gt; BackendConfigWrapper 'DataConnector
forall (b :: BackendType).
BackendConfig b -&gt; BackendConfigWrapper b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#BackendConfigWrapper"><span class="hs-identifier hs-var">BackendConfigWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">(Map DataConnectorName DataConnectorOptions
 -&gt; BackendConfigWrapper 'DataConnector)
-&gt; (BackendConfigWrapper 'DataConnector
    -&gt; Map DataConnectorName DataConnectorOptions)
-&gt; BackendConfigWrapper 'DataConnector
-&gt; BackendConfigWrapper 'DataConnector
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">DataConnectorName
-&gt; Map DataConnectorName DataConnectorOptions
-&gt; Map DataConnectorName DataConnectorOptions
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">DataConnectorName
</span><a href="#local-6989586621688028475"><span class="hs-identifier hs-var">agentName</span></a></span><span> </span><span class="annot"><span class="annottext">(Map DataConnectorName DataConnectorOptions
 -&gt; Map DataConnectorName DataConnectorOptions)
-&gt; (BackendConfigWrapper 'DataConnector
    -&gt; Map DataConnectorName DataConnectorOptions)
-&gt; BackendConfigWrapper 'DataConnector
-&gt; Map DataConnectorName DataConnectorOptions
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BackendConfigWrapper 'DataConnector
-&gt; Map DataConnectorName DataConnectorOptions
BackendConfigWrapper 'DataConnector -&gt; BackendConfig 'DataConnector
forall (b :: BackendType).
BackendConfigWrapper b -&gt; BackendConfig b
</span><a href="Hasura.RQL.Types.Metadata.Common.html#unBackendConfigWrapper"><span class="hs-identifier hs-var">unBackendConfigWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MOOpenTelemetry"><span class="hs-identifier hs-type">MOOpenTelemetry</span></a></span><span> </span><span id="local-6989586621688028481"><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="#local-6989586621688028481"><span class="hs-identifier hs-var">subobject</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-709"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="#local-6989586621688028481"><span class="hs-identifier hs-var">subobject</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-710"></span><span>      </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelSubobjectAll"><span class="hs-identifier hs-var">OtelSubobjectAll</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-711"></span><span>        </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
-&gt; Metadata -&gt; Identity Metadata
Lens' Metadata OpenTelemetryConfig
</span><a href="Hasura.RQL.Types.Metadata.html#metaOpenTelemetryConfig"><span class="hs-identifier hs-var">metaOpenTelemetryConfig</span></a></span><span> </span><span class="annot"><span class="annottext">((OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; OpenTelemetryConfig -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">OpenTelemetryConfig
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#emptyOpenTelemetryConfig"><span class="hs-identifier hs-var">emptyOpenTelemetryConfig</span></a></span><span>
</span><span id="line-712"></span><span>      </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelSubobjectExporterOtlp"><span class="hs-identifier hs-var">OtelSubobjectExporterOtlp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-713"></span><span>        </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
-&gt; Metadata -&gt; Identity Metadata
Lens' Metadata OpenTelemetryConfig
</span><a href="Hasura.RQL.Types.Metadata.html#metaOpenTelemetryConfig"><span class="hs-identifier hs-var">metaOpenTelemetryConfig</span></a></span><span> </span><span class="annot"><span class="annottext">((OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; ((OtelExporterConfig -&gt; Identity OtelExporterConfig)
    -&gt; OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
-&gt; (OtelExporterConfig -&gt; Identity OtelExporterConfig)
-&gt; Metadata
-&gt; Identity Metadata
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OtelExporterConfig -&gt; Identity OtelExporterConfig)
-&gt; OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig
Lens' OpenTelemetryConfig OtelExporterConfig
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#ocExporterOtlp"><span class="hs-identifier hs-var">ocExporterOtlp</span></a></span><span> </span><span class="annot"><span class="annottext">((OtelExporterConfig -&gt; Identity OtelExporterConfig)
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; OtelExporterConfig -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">OtelExporterConfig
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#defaultOtelExporterConfig"><span class="hs-identifier hs-var">defaultOtelExporterConfig</span></a></span><span>
</span><span id="line-714"></span><span>      </span><span class="annot"><span class="annottext">OpenTelemetryConfigSubobject
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#OtelSubobjectBatchSpanProcessor"><span class="hs-identifier hs-var">OtelSubobjectBatchSpanProcessor</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-715"></span><span>        </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
-&gt; Metadata -&gt; Identity Metadata
Lens' Metadata OpenTelemetryConfig
</span><a href="Hasura.RQL.Types.Metadata.html#metaOpenTelemetryConfig"><span class="hs-identifier hs-var">metaOpenTelemetryConfig</span></a></span><span> </span><span class="annot"><span class="annottext">((OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; ((OtelBatchSpanProcessorConfig
     -&gt; Identity OtelBatchSpanProcessorConfig)
    -&gt; OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig)
-&gt; (OtelBatchSpanProcessorConfig
    -&gt; Identity OtelBatchSpanProcessorConfig)
-&gt; Metadata
-&gt; Identity Metadata
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(OtelBatchSpanProcessorConfig
 -&gt; Identity OtelBatchSpanProcessorConfig)
-&gt; OpenTelemetryConfig -&gt; Identity OpenTelemetryConfig
Lens' OpenTelemetryConfig OtelBatchSpanProcessorConfig
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#ocBatchSpanProcessor"><span class="hs-identifier hs-var">ocBatchSpanProcessor</span></a></span><span> </span><span class="annot"><span class="annottext">((OtelBatchSpanProcessorConfig
  -&gt; Identity OtelBatchSpanProcessorConfig)
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; OtelBatchSpanProcessorConfig -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">OtelBatchSpanProcessorConfig
</span><a href="Hasura.RQL.Types.OpenTelemetry.html#defaultOtelBatchSpanProcessorConfig"><span class="hs-identifier hs-var">defaultOtelBatchSpanProcessorConfig</span></a></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="#local-6989586621688028439"><span class="hs-identifier hs-type">handleSourceObj</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621688026977"><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Backend.html#BackendMetadata"><span class="hs-identifier hs-type">BackendMetadata</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#SourceName"><span class="hs-identifier hs-type">SourceName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SourceMetadataObjId"><span class="hs-identifier hs-type">SourceMetadataObjId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621688028439"><span class="annot"><span class="annottext">handleSourceObj :: forall (b :: BackendType).
BackendMetadata b =&gt;
SourceName -&gt; SourceMetadataObjId b -&gt; MetadataModifier
</span><a href="#local-6989586621688028439"><span class="hs-identifier hs-var hs-var">handleSourceObj</span></a></span></span><span> </span><span id="local-6989586621688028506"><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-719"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOTable"><span class="hs-identifier hs-type">SMOTable</span></a></span><span> </span><span id="local-6989586621688028508"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028508"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#dropTableInMetadata"><span class="hs-identifier hs-var">dropTableInMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028508"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-720"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOFunction"><span class="hs-identifier hs-type">SMOFunction</span></a></span><span> </span><span id="local-6989586621688028511"><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621688028511"><span class="hs-identifier hs-var">qf</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; FunctionName b -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#dropFunctionInMetadata"><span class="hs-identifier hs-var">dropFunctionInMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621688028511"><span class="hs-identifier hs-var">qf</span></a></span><span>
</span><span id="line-721"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOFunctionPermission"><span class="hs-identifier hs-type">SMOFunctionPermission</span></a></span><span> </span><span id="local-6989586621688028514"><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621688028514"><span class="hs-identifier hs-var">qf</span></a></span></span><span> </span><span id="local-6989586621688028515"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028515"><span class="hs-identifier hs-var">rn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendMetadata b =&gt;
SourceName -&gt; FunctionName b -&gt; RoleName -&gt; MetadataModifier
</span><a href="Hasura.Function.API.html#dropFunctionPermissionInMetadata"><span class="hs-identifier hs-var">dropFunctionPermissionInMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621688028514"><span class="hs-identifier hs-var">qf</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028515"><span class="hs-identifier hs-var">rn</span></a></span><span>
</span><span id="line-722"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMONativeQuery"><span class="hs-identifier hs-type">SMONativeQuery</span></a></span><span> </span><span id="local-6989586621688028518"><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621688028518"><span class="hs-identifier hs-var">nq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendMetadata b =&gt;
SourceName -&gt; NativeQueryName -&gt; MetadataModifier
</span><a href="Hasura.NativeQuery.API.html#dropNativeQueryInMetadata"><span class="hs-identifier hs-var">dropNativeQueryInMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621688028518"><span class="hs-identifier hs-var">nq</span></a></span><span>
</span><span id="line-723"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMONativeQueryObj"><span class="hs-identifier hs-type">SMONativeQueryObj</span></a></span><span> </span><span id="local-6989586621688028521"><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621688028521"><span class="hs-identifier hs-var">nativeQueryName</span></a></span></span><span> </span><span id="local-6989586621688028522"><span class="annot"><span class="annottext">NativeQueryMetadataObjId
</span><a href="#local-6989586621688028522"><span class="hs-identifier hs-var">nativeQueryMetadataObjId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-724"></span><span>        </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span>
</span><span id="line-725"></span><span>          </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SourceName
-&gt; NativeQueryName -&gt; ASetter' Metadata (NativeQueryMetadata b)
</span><a href="Hasura.RQL.Types.Metadata.html#nativeQueryMetadataSetter"><span class="hs-identifier hs-var">nativeQueryMetadataSetter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621688028521"><span class="hs-identifier hs-var">nativeQueryName</span></a></span><span>
</span><span id="line-726"></span><span>          </span><span class="annot"><span class="annottext">ASetter' Metadata (NativeQueryMetadata b)
-&gt; (NativeQueryMetadata b -&gt; NativeQueryMetadata b)
-&gt; Metadata
-&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NativeQueryMetadataObjId
</span><a href="#local-6989586621688028522"><span class="hs-identifier hs-var">nativeQueryMetadataObjId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-727"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#NQMORel"><span class="hs-identifier hs-type">NQMORel</span></a></span><span> </span><span id="local-6989586621688028525"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028525"><span class="hs-identifier hs-var">rn</span></a></span></span><span> </span><span class="annot"><span class="annottext">RelType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; NativeQueryMetadata b -&gt; NativeQueryMetadata b
forall (b :: BackendType).
RelName -&gt; NativeQueryMetadata b -&gt; NativeQueryMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropNativeQueryRelationshipInMetadata"><span class="hs-identifier hs-var">dropNativeQueryRelationshipInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028525"><span class="hs-identifier hs-var">rn</span></a></span><span>
</span><span id="line-728"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOStoredProcedure"><span class="hs-identifier hs-type">SMOStoredProcedure</span></a></span><span> </span><span id="local-6989586621688028528"><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621688028528"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendMetadata b =&gt;
SourceName -&gt; FunctionName b -&gt; MetadataModifier
</span><a href="Hasura.StoredProcedure.API.html#dropStoredProcedureInMetadata"><span class="hs-identifier hs-var">dropStoredProcedureInMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">FunctionName b
</span><a href="#local-6989586621688028528"><span class="hs-identifier hs-var">sp</span></a></span><span>
</span><span id="line-729"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOLogicalModel"><span class="hs-identifier hs-type">SMOLogicalModel</span></a></span><span> </span><span id="local-6989586621688028530"><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621688028530"><span class="hs-identifier hs-var">lm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
BackendMetadata b =&gt;
SourceName -&gt; LogicalModelName -&gt; MetadataModifier
</span><a href="Hasura.LogicalModel.API.html#dropLogicalModelInMetadata"><span class="hs-identifier hs-var">dropLogicalModelInMetadata</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621688028530"><span class="hs-identifier hs-var">lm</span></a></span><span>
</span><span id="line-730"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOLogicalModelObj"><span class="hs-identifier hs-type">SMOLogicalModelObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LMLLogicalModel"><span class="hs-identifier hs-type">LMLLogicalModel</span></a></span><span> </span><span id="local-6989586621688028534"><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621688028534"><span class="hs-identifier hs-var">logicalModelName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621688028535"><span class="annot"><span class="annottext">LogicalModelMetadataObjId
</span><a href="#local-6989586621688028535"><span class="hs-identifier hs-var">logicalModelMetadataObjId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-731"></span><span>        </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span>
</span><span id="line-732"></span><span>          </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SourceName
-&gt; LogicalModelName -&gt; ASetter' Metadata (LogicalModelMetadata b)
</span><a href="Hasura.RQL.Types.Metadata.html#logicalModelMetadataSetter"><span class="hs-identifier hs-var">logicalModelMetadataSetter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><a href="#local-6989586621688028534"><span class="hs-identifier hs-var">logicalModelName</span></a></span><span>
</span><span id="line-733"></span><span>          </span><span class="annot"><span class="annottext">ASetter' Metadata (LogicalModelMetadata b)
-&gt; (LogicalModelMetadata b -&gt; LogicalModelMetadata b)
-&gt; Metadata
-&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadataObjId
</span><a href="#local-6989586621688028535"><span class="hs-identifier hs-var">logicalModelMetadataObjId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-734"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#LMMOPerm"><span class="hs-identifier hs-type">LMMOPerm</span></a></span><span> </span><span id="local-6989586621688028538"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028538"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span id="local-6989586621688028539"><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621688028539"><span class="hs-identifier hs-var">permType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-735"></span><span>              </span><span class="annot"><span class="annottext">RoleName
-&gt; PermType -&gt; LogicalModelMetadata b -&gt; LogicalModelMetadata b
forall (b :: BackendType).
RoleName
-&gt; PermType -&gt; LogicalModelMetadata b -&gt; LogicalModelMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropLogicalModelPermissionInMetadata"><span class="hs-identifier hs-var">dropLogicalModelPermissionInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028538"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621688028539"><span class="hs-identifier hs-var">permType</span></a></span><span>
</span><span id="line-736"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#LMMOReferencedLogicalModel"><span class="hs-identifier hs-type">LMMOReferencedLogicalModel</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadata b -&gt; LogicalModelMetadata b
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-737"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOLogicalModelObj"><span class="hs-identifier hs-type">SMOLogicalModelObj</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.LogicalModel.Types.html#LMLNativeQuery"><span class="hs-identifier hs-type">LMLNativeQuery</span></a></span><span> </span><span id="local-6989586621688028544"><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621688028544"><span class="hs-identifier hs-var">nativeQueryName</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621688028545"><span class="annot"><span class="annottext">LogicalModelMetadataObjId
</span><a href="#local-6989586621688028545"><span class="hs-identifier hs-var">logicalModelMetadataObjId</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-738"></span><span>        </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span>
</span><span id="line-739"></span><span>          </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SourceName
-&gt; NativeQueryName -&gt; ASetter' Metadata (NativeQueryMetadata b)
</span><a href="Hasura.RQL.Types.Metadata.html#nativeQueryMetadataSetter"><span class="hs-identifier hs-var">nativeQueryMetadataSetter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">NativeQueryName
</span><a href="#local-6989586621688028544"><span class="hs-identifier hs-var">nativeQueryName</span></a></span><span>
</span><span id="line-740"></span><span>          </span><span class="annot"><span class="annottext">ASetter' Metadata (NativeQueryMetadata b)
-&gt; ((InlineLogicalModelMetadata b
     -&gt; Identity (InlineLogicalModelMetadata b))
    -&gt; NativeQueryMetadata b -&gt; Identity (NativeQueryMetadata b))
-&gt; (InlineLogicalModelMetadata b
    -&gt; Identity (InlineLogicalModelMetadata b))
-&gt; Metadata
-&gt; Identity Metadata
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LogicalModelIdentifier b -&gt; Identity (LogicalModelIdentifier b))
-&gt; NativeQueryMetadata b -&gt; Identity (NativeQueryMetadata b)
forall (b :: BackendType) (f :: * -&gt; *).
Functor f =&gt;
(LogicalModelIdentifier b -&gt; f (LogicalModelIdentifier b))
-&gt; NativeQueryMetadata b -&gt; f (NativeQueryMetadata b)
</span><a href="Hasura.NativeQuery.Lenses.html#nqmReturns"><span class="hs-identifier hs-var">nqmReturns</span></a></span><span>
</span><span id="line-741"></span><span>          </span><span class="annot"><span class="annottext">((LogicalModelIdentifier b -&gt; Identity (LogicalModelIdentifier b))
 -&gt; NativeQueryMetadata b -&gt; Identity (NativeQueryMetadata b))
-&gt; ((InlineLogicalModelMetadata b
     -&gt; Identity (InlineLogicalModelMetadata b))
    -&gt; LogicalModelIdentifier b -&gt; Identity (LogicalModelIdentifier b))
-&gt; (InlineLogicalModelMetadata b
    -&gt; Identity (InlineLogicalModelMetadata b))
-&gt; NativeQueryMetadata b
-&gt; Identity (NativeQueryMetadata b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(InlineLogicalModelMetadata b
 -&gt; Identity (InlineLogicalModelMetadata b))
-&gt; LogicalModelIdentifier b -&gt; Identity (LogicalModelIdentifier b)
forall (b1 :: BackendType) (b2 :: BackendType) (p :: * -&gt; * -&gt; *)
       (f :: * -&gt; *).
(Choice p, Applicative f) =&gt;
p (InlineLogicalModelMetadata b1)
  (f (InlineLogicalModelMetadata b2))
-&gt; p (LogicalModelIdentifier b1) (f (LogicalModelIdentifier b2))
</span><a href="Hasura.LogicalModelResolver.Lenses.html#_LMIInlineLogicalModel"><span class="hs-identifier hs-var">_LMIInlineLogicalModel</span></a></span><span>
</span><span id="line-742"></span><span>          </span><span class="annot"><span class="annottext">((InlineLogicalModelMetadata b
  -&gt; Identity (InlineLogicalModelMetadata b))
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; (InlineLogicalModelMetadata b -&gt; InlineLogicalModelMetadata b)
-&gt; Metadata
-&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LogicalModelMetadataObjId
</span><a href="#local-6989586621688028545"><span class="hs-identifier hs-var">logicalModelMetadataObjId</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-743"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#LMMOPerm"><span class="hs-identifier hs-type">LMMOPerm</span></a></span><span> </span><span id="local-6989586621688028546"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028546"><span class="hs-identifier hs-var">roleName</span></a></span></span><span> </span><span id="local-6989586621688028547"><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621688028547"><span class="hs-identifier hs-var">permType</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-744"></span><span>              </span><span class="annot"><span class="annottext">RoleName
-&gt; PermType
-&gt; InlineLogicalModelMetadata b
-&gt; InlineLogicalModelMetadata b
forall (b :: BackendType).
RoleName
-&gt; PermType
-&gt; InlineLogicalModelMetadata b
-&gt; InlineLogicalModelMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropInlineLogicalModelPermissionInMetadata"><span class="hs-identifier hs-var">dropInlineLogicalModelPermissionInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028546"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621688028547"><span class="hs-identifier hs-var">permType</span></a></span><span>
</span><span id="line-745"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#LMMOReferencedLogicalModel"><span class="hs-identifier hs-type">LMMOReferencedLogicalModel</span></a></span><span> </span><span class="annot"><span class="annottext">LogicalModelName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">InlineLogicalModelMetadata b -&gt; InlineLogicalModelMetadata b
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-746"></span><span>      </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#SMOTableObj"><span class="hs-identifier hs-type">SMOTableObj</span></a></span><span> </span><span id="local-6989586621688028549"><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028549"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span id="local-6989586621688028550"><span class="annot"><span class="annottext">TableMetadataObjId
</span><a href="#local-6989586621688028550"><span class="hs-identifier hs-var">tableObj</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-747"></span><span>        </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span>
</span><span id="line-748"></span><span>          </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall (b :: BackendType).
Backend b =&gt;
SourceName -&gt; TableName b -&gt; ASetter' Metadata (TableMetadata b)
</span><a href="Hasura.RQL.Types.Metadata.html#tableMetadataSetter"><span class="hs-identifier hs-var">tableMetadataSetter</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621688026977"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><span class="annottext">SourceName
</span><a href="#local-6989586621688028506"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">TableName b
</span><a href="#local-6989586621688028549"><span class="hs-identifier hs-var">qt</span></a></span><span>
</span><span id="line-749"></span><span>          </span><span class="annot"><span class="annottext">ASetter' Metadata (TableMetadata b)
-&gt; (TableMetadata b -&gt; TableMetadata b) -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TableMetadataObjId
</span><a href="#local-6989586621688028550"><span class="hs-identifier hs-var">tableObj</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-750"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MTORel"><span class="hs-identifier hs-type">MTORel</span></a></span><span> </span><span id="local-6989586621688028553"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028553"><span class="hs-identifier hs-var">rn</span></a></span></span><span> </span><span class="annot"><span class="annottext">RelType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; TableMetadata b -&gt; TableMetadata b
forall (b :: BackendType).
RelName -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropRelationshipInMetadata"><span class="hs-identifier hs-var">dropRelationshipInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028553"><span class="hs-identifier hs-var">rn</span></a></span><span>
</span><span id="line-751"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MTOPerm"><span class="hs-identifier hs-type">MTOPerm</span></a></span><span> </span><span id="local-6989586621688028556"><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028556"><span class="hs-identifier hs-var">rn</span></a></span></span><span> </span><span id="local-6989586621688028557"><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621688028557"><span class="hs-identifier hs-var">pt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RoleName -&gt; PermType -&gt; TableMetadata b -&gt; TableMetadata b
forall (b :: BackendType).
RoleName -&gt; PermType -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropPermissionInMetadata"><span class="hs-identifier hs-var">dropPermissionInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RoleName
</span><a href="#local-6989586621688028556"><span class="hs-identifier hs-var">rn</span></a></span><span> </span><span class="annot"><span class="annottext">PermType
</span><a href="#local-6989586621688028557"><span class="hs-identifier hs-var">pt</span></a></span><span>
</span><span id="line-752"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MTOTrigger"><span class="hs-identifier hs-type">MTOTrigger</span></a></span><span> </span><span id="local-6989586621688028559"><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028559"><span class="hs-identifier hs-var">trn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TriggerName -&gt; TableMetadata b -&gt; TableMetadata b
forall (b :: BackendType).
TriggerName -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropEventTriggerInMetadata"><span class="hs-identifier hs-var">dropEventTriggerInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">TriggerName
</span><a href="#local-6989586621688028559"><span class="hs-identifier hs-var">trn</span></a></span><span>
</span><span id="line-753"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MTOComputedField"><span class="hs-identifier hs-type">MTOComputedField</span></a></span><span> </span><span id="local-6989586621688028562"><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621688028562"><span class="hs-identifier hs-var">ccn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ComputedFieldName -&gt; TableMetadata b -&gt; TableMetadata b
forall (b :: BackendType).
ComputedFieldName -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropComputedFieldInMetadata"><span class="hs-identifier hs-var">dropComputedFieldInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">ComputedFieldName
</span><a href="#local-6989586621688028562"><span class="hs-identifier hs-var">ccn</span></a></span><span>
</span><span id="line-754"></span><span>            </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Object.html#MTORemoteRelationship"><span class="hs-identifier hs-type">MTORemoteRelationship</span></a></span><span> </span><span id="local-6989586621688028565"><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028565"><span class="hs-identifier hs-var">rn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RelName -&gt; TableMetadata b -&gt; TableMetadata b
forall (b :: BackendType).
RelName -&gt; TableMetadata b -&gt; TableMetadata b
</span><a href="Hasura.RQL.Types.Metadata.html#dropRemoteRelationshipInMetadata"><span class="hs-identifier hs-var">dropRemoteRelationshipInMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">RelName
</span><a href="#local-6989586621688028565"><span class="hs-identifier hs-var">rn</span></a></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span>    </span><span class="annot"><a href="#local-6989586621688028473"><span class="hs-identifier hs-type">dropListedQueryFromQueryCollections</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CollectionName"><span class="hs-identifier hs-type">CollectionName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#ListedQuery"><span class="hs-identifier hs-type">ListedQuery</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-type">MetadataModifier</span></a></span><span>
</span><span id="line-757"></span><span>    </span><span id="local-6989586621688028473"><span class="annot"><span class="annottext">dropListedQueryFromQueryCollections :: CollectionName -&gt; ListedQuery -&gt; MetadataModifier
</span><a href="#local-6989586621688028473"><span class="hs-identifier hs-var hs-var">dropListedQueryFromQueryCollections</span></a></span></span><span> </span><span id="local-6989586621688028567"><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621688028567"><span class="hs-identifier hs-var">cName</span></a></span></span><span> </span><span id="local-6989586621688028568"><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621688028568"><span class="hs-identifier hs-var">lq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span> </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; Metadata
</span><a href="#local-6989586621688028569"><span class="hs-identifier hs-var">removeAndCleanupMetadata</span></a></span><span>
</span><span id="line-758"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-759"></span><span>        </span><span id="local-6989586621688028569"><span class="annot"><span class="annottext">removeAndCleanupMetadata :: Metadata -&gt; Metadata
</span><a href="#local-6989586621688028569"><span class="hs-identifier hs-var hs-var">removeAndCleanupMetadata</span></a></span></span><span> </span><span id="local-6989586621688028570"><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028570"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-760"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028571"><span class="annot"><span class="annottext">newQueryCollection :: QueryCollections
</span><a href="#local-6989586621688028571"><span class="hs-identifier hs-var hs-var">newQueryCollection</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QueryCollections -&gt; QueryCollections
</span><a href="#local-6989586621688028572"><span class="hs-identifier hs-var">filteredCollection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Metadata -&gt; QueryCollections
</span><a href="Hasura.RQL.Types.Metadata.html#_metaQueryCollections"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028570"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>              </span><span class="hs-comment">-- QueryCollections = InsOrdHashMap CollectionName CreateCollection</span><span>
</span><span id="line-762"></span><span>              </span><span class="annot"><a href="#local-6989586621688028572"><span class="hs-identifier hs-type">filteredCollection</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#QueryCollections"><span class="hs-identifier hs-type">QueryCollections</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#QueryCollections"><span class="hs-identifier hs-type">QueryCollections</span></a></span><span>
</span><span id="line-763"></span><span>              </span><span id="local-6989586621688028572"><span class="annot"><span class="annottext">filteredCollection :: QueryCollections -&gt; QueryCollections
</span><a href="#local-6989586621688028572"><span class="hs-identifier hs-var hs-var">filteredCollection</span></a></span></span><span> </span><span id="local-6989586621688028574"><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621688028574"><span class="hs-identifier hs-var">qc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CreateCollection -&gt; Bool) -&gt; QueryCollections -&gt; QueryCollections
forall v k. (v -&gt; Bool) -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#filter"><span class="hs-identifier hs-var">InsOrdHashMap.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CreateCollection -&gt; Bool
</span><a href="#local-6989586621688028575"><span class="hs-identifier hs-var">isNonEmptyCC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(QueryCollections -&gt; QueryCollections)
-&gt; QueryCollections -&gt; QueryCollections
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(CreateCollection -&gt; CreateCollection)
-&gt; CollectionName -&gt; QueryCollections -&gt; QueryCollections
forall k v.
(Eq k, Hashable k) =&gt;
(v -&gt; v) -&gt; k -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#adjust"><span class="hs-identifier hs-var">InsOrdHashMap.adjust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CreateCollection -&gt; CreateCollection
</span><a href="#local-6989586621688028577"><span class="hs-identifier hs-var">collectionModifier</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621688028567"><span class="hs-identifier hs-var">cName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621688028574"><span class="hs-identifier hs-var">qc</span></a></span><span>
</span><span id="line-764"></span><span>
</span><span id="line-765"></span><span>              </span><span class="annot"><a href="#local-6989586621688028577"><span class="hs-identifier hs-type">collectionModifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CreateCollection"><span class="hs-identifier hs-type">CreateCollection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CreateCollection"><span class="hs-identifier hs-type">CreateCollection</span></a></span><span>
</span><span id="line-766"></span><span>              </span><span id="local-6989586621688028577"><span class="annot"><span class="annottext">collectionModifier :: CreateCollection -&gt; CreateCollection
</span><a href="#local-6989586621688028577"><span class="hs-identifier hs-var hs-var">collectionModifier</span></a></span></span><span> </span><span id="local-6989586621688028578"><span class="annot"><span class="annottext">cc :: CreateCollection
</span><a href="#local-6989586621688028578"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CreateCollection"><span class="hs-identifier hs-type">CreateCollection</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688028580"><span id="local-6989586621688028581"><span id="local-6989586621688028582"><span class="annot"><span class="annottext">Maybe Text
CollectionDef
CollectionName
_ccName :: CollectionName
_ccDefinition :: CollectionDef
_ccComment :: Maybe Text
_ccComment :: CreateCollection -&gt; Maybe Text
_ccDefinition :: CreateCollection -&gt; CollectionDef
_ccName :: CreateCollection -&gt; CollectionName
</span><a href="#local-6989586621688028580"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-767"></span><span>                </span><span class="annot"><span class="annottext">CreateCollection
</span><a href="#local-6989586621688028578"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-768"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#_ccDefinition"><span class="hs-identifier hs-var">_ccDefinition</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-769"></span><span>                      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028586"><span class="annot"><a href="#local-6989586621688028586"><span class="hs-identifier hs-var hs-var">oldQueries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectionDef -&gt; [ListedQuery]
</span><a href="Hasura.RQL.Types.QueryCollection.html#_cdQueries"><span class="hs-identifier hs-var">_cdQueries</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionDef
</span><a href="#local-6989586621688028581"><span class="hs-identifier hs-var">_ccDefinition</span></a></span><span>
</span><span id="line-770"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="#local-6989586621688028581"><span class="hs-identifier hs-type">_ccDefinition</span></a></span><span>
</span><span id="line-771"></span><span>                            </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#_cdQueries"><span class="hs-identifier hs-var">_cdQueries</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">/=</span></span><span> </span><span class="annot"><span class="hs-identifier">lq</span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688028586"><span class="hs-identifier hs-type">oldQueries</span></a></span><span>
</span><span id="line-772"></span><span>                            </span><span class="hs-special">}</span><span>
</span><span id="line-773"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>              </span><span class="annot"><a href="#local-6989586621688028575"><span class="hs-identifier hs-type">isNonEmptyCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.QueryCollection.html#CreateCollection"><span class="hs-identifier hs-type">CreateCollection</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-776"></span><span>              </span><span id="local-6989586621688028575"><span class="annot"><span class="annottext">isNonEmptyCC :: CreateCollection -&gt; Bool
</span><a href="#local-6989586621688028575"><span class="hs-identifier hs-var hs-var">isNonEmptyCC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (CreateCollection -&gt; Bool) -&gt; CreateCollection -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[ListedQuery] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">([ListedQuery] -&gt; Bool)
-&gt; (CreateCollection -&gt; [ListedQuery]) -&gt; CreateCollection -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CollectionDef -&gt; [ListedQuery]
</span><a href="Hasura.RQL.Types.QueryCollection.html#_cdQueries"><span class="hs-identifier hs-var">_cdQueries</span></a></span><span> </span><span class="annot"><span class="annottext">(CollectionDef -&gt; [ListedQuery])
-&gt; (CreateCollection -&gt; CollectionDef)
-&gt; CreateCollection
-&gt; [ListedQuery]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CreateCollection -&gt; CollectionDef
</span><a href="Hasura.RQL.Types.QueryCollection.html#_ccDefinition"><span class="hs-identifier hs-var">_ccDefinition</span></a></span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>              </span><span class="annot"><a href="#local-6989586621688028589"><span class="hs-identifier hs-type">cleanupAllowList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html#MetadataAllowlist"><span class="hs-identifier hs-type">MetadataAllowlist</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Allowlist.html#MetadataAllowlist"><span class="hs-identifier hs-type">MetadataAllowlist</span></a></span><span>
</span><span id="line-779"></span><span>              </span><span id="local-6989586621688028589"><span class="annot"><span class="annottext">cleanupAllowList :: MetadataAllowlist -&gt; MetadataAllowlist
</span><a href="#local-6989586621688028589"><span class="hs-identifier hs-var hs-var">cleanupAllowList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CollectionName -&gt; AllowlistEntry -&gt; Bool)
-&gt; MetadataAllowlist -&gt; MetadataAllowlist
forall k v.
(k -&gt; v -&gt; Bool) -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#filterWithKey"><span class="hs-identifier hs-var">InsOrdHashMap.filterWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">CollectionName
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AllowlistEntry
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CollectionName -&gt; QueryCollections -&gt; Bool
forall k a. (Eq k, Hashable k) =&gt; k -&gt; InsOrdHashMap k a -&gt; Bool
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#member"><span class="hs-identifier hs-var">InsOrdHashMap.member</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621688028567"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">QueryCollections
</span><a href="#local-6989586621688028571"><span class="hs-identifier hs-var">newQueryCollection</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>
</span><span id="line-781"></span><span>              </span><span class="annot"><a href="#local-6989586621688028591"><span class="hs-identifier hs-type">cleanupRESTEndpoints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Endpoints"><span class="hs-identifier hs-type">Endpoints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#Endpoints"><span class="hs-identifier hs-type">Endpoints</span></a></span><span>
</span><span id="line-782"></span><span>              </span><span id="local-6989586621688028591"><span class="annot"><span class="annottext">cleanupRESTEndpoints :: Endpoints -&gt; Endpoints
</span><a href="#local-6989586621688028591"><span class="hs-identifier hs-var hs-var">cleanupRESTEndpoints</span></a></span></span><span> </span><span id="local-6989586621688028592"><span class="annot"><span class="annottext">Endpoints
</span><a href="#local-6989586621688028592"><span class="hs-identifier hs-var">endpoints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CreateEndpoint -&gt; Bool) -&gt; Endpoints -&gt; Endpoints
forall v k. (v -&gt; Bool) -&gt; InsOrdHashMap k v -&gt; InsOrdHashMap k v
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/insert-ordered-containers-0.2.5.3-dcb71999c8104475fd299533bb40a6c15ee8a9411f3a03b68aa99a14a4143c19/share/doc/html/src/Data.HashMap.Strict.InsOrd.html/Data.HashMap.Strict.InsOrd.html#filter"><span class="hs-identifier hs-var">InsOrdHashMap.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (CreateEndpoint -&gt; Bool) -&gt; CreateEndpoint -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">QueryReference -&gt; Bool
</span><a href="#local-6989586621688028593"><span class="hs-identifier hs-var">isFaultyQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(QueryReference -&gt; Bool)
-&gt; (CreateEndpoint -&gt; QueryReference) -&gt; CreateEndpoint -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EndpointDef QueryReference -&gt; QueryReference
forall query. EndpointDef query -&gt; query
</span><a href="Hasura.RQL.Types.Endpoint.html#_edQuery"><span class="hs-identifier hs-var">_edQuery</span></a></span><span> </span><span class="annot"><span class="annottext">(EndpointDef QueryReference -&gt; QueryReference)
-&gt; (CreateEndpoint -&gt; EndpointDef QueryReference)
-&gt; CreateEndpoint
-&gt; QueryReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CreateEndpoint -&gt; EndpointDef QueryReference
forall query. EndpointMetadata query -&gt; EndpointDef query
</span><a href="Hasura.RQL.Types.Endpoint.html#_ceDefinition"><span class="hs-identifier hs-var">_ceDefinition</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Endpoints
</span><a href="#local-6989586621688028592"><span class="hs-identifier hs-var">endpoints</span></a></span><span>
</span><span id="line-783"></span><span>
</span><span id="line-784"></span><span>              </span><span class="annot"><a href="#local-6989586621688028593"><span class="hs-identifier hs-type">isFaultyQuery</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#QueryReference"><span class="hs-identifier hs-type">QueryReference</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-785"></span><span>              </span><span id="local-6989586621688028593"><span class="annot"><span class="annottext">isFaultyQuery :: QueryReference -&gt; Bool
</span><a href="#local-6989586621688028593"><span class="hs-identifier hs-var hs-var">isFaultyQuery</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Endpoint.html#QueryReference"><span class="hs-identifier hs-type">QueryReference</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688028597"><span id="local-6989586621688028598"><span class="annot"><span class="annottext">QueryName
CollectionName
_qrCollectionName :: CollectionName
_qrQueryName :: QueryName
_qrQueryName :: QueryReference -&gt; QueryName
_qrCollectionName :: QueryReference -&gt; CollectionName
</span><a href="#local-6989586621688028597"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621688028597"><span class="hs-identifier hs-var">_qrCollectionName</span></a></span><span> </span><span class="annot"><span class="annottext">CollectionName -&gt; CollectionName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CollectionName
</span><a href="#local-6989586621688028567"><span class="hs-identifier hs-var">cName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">QueryName
</span><a href="#local-6989586621688028598"><span class="hs-identifier hs-var">_qrQueryName</span></a></span><span> </span><span class="annot"><span class="annottext">QueryName -&gt; QueryName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ListedQuery -&gt; QueryName
</span><a href="Hasura.RQL.Types.QueryCollection.html#_lqName"><span class="hs-identifier hs-var">_lqName</span></a></span><span> </span><span class="annot"><span class="annottext">ListedQuery
</span><a href="#local-6989586621688028568"><span class="hs-identifier hs-var">lq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Metadata
</span><a href="#local-6989586621688028570"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-787"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaQueryCollections"><span class="hs-identifier hs-var">_metaQueryCollections</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621688028571"><span class="hs-identifier hs-type">newQueryCollection</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-788"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaAllowlist"><span class="hs-identifier hs-var">_metaAllowlist</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621688028589"><span class="hs-identifier hs-type">cleanupAllowList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaAllowlist"><span class="hs-identifier hs-var">_metaAllowlist</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028570"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-789"></span><span>                  </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaRestEndpoints"><span class="hs-identifier hs-var">_metaRestEndpoints</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621688028591"><span class="hs-identifier hs-type">cleanupRESTEndpoints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#_metaRestEndpoints"><span class="hs-identifier hs-var">_metaRestEndpoints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028570"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span id="local-6989586621688027042"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runGetCatalogState"><span class="hs-identifier hs-type">runGetCatalogState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-793"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027042"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027042"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#GetCatalogState"><span class="hs-identifier hs-type">GetCatalogState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688027042"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-794"></span><span id="runGetCatalogState"><span class="annot"><span class="annottext">runGetCatalogState :: forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadError QErr m) =&gt;
GetCatalogState -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runGetCatalogState"><span class="hs-identifier hs-var hs-var">runGetCatalogState</span></a></span></span><span> </span><span class="annot"><span class="annottext">GetCatalogState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-795"></span><span>  </span><span class="annot"><span class="annottext">CatalogState -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span> </span><span class="annot"><span class="annottext">(CatalogState -&gt; EncJSON) -&gt; m CatalogState -&gt; m EncJSON
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (Either QErr CatalogState) -&gt; m CatalogState
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">m (Either QErr CatalogState)
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
m (Either QErr CatalogState)
</span><a href="Hasura.Metadata.Class.html#fetchCatalogState"><span class="hs-identifier hs-var">fetchCatalogState</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span id="local-6989586621688027048"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runSetCatalogState"><span class="hs-identifier hs-type">runSetCatalogState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Metadata.Class.html#MonadMetadataStorage"><span class="hs-identifier hs-type">MonadMetadataStorage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027048"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027048"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SetCatalogState"><span class="hs-identifier hs-type">SetCatalogState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688027048"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-799"></span><span id="runSetCatalogState"><span class="annot"><span class="annottext">runSetCatalogState :: forall (m :: * -&gt; *).
(MonadMetadataStorage m, MonadError QErr m) =&gt;
SetCatalogState -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runSetCatalogState"><span class="hs-identifier hs-var hs-var">runSetCatalogState</span></a></span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.Common.html#SetCatalogState"><span class="hs-identifier hs-type">SetCatalogState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621688028624"><span id="local-6989586621688028625"><span class="annot"><span class="annottext">Value
CatalogStateType
_scsType :: CatalogStateType
_scsState :: Value
_scsState :: SetCatalogState -&gt; Value
_scsType :: SetCatalogState -&gt; CatalogStateType
</span><a href="#local-6989586621688028624"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>  </span><span class="annot"><span class="annottext">m (Either QErr ()) -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; m (Either e a) -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#liftEitherM"><span class="hs-identifier hs-var">liftEitherM</span></a></span><span> </span><span class="annot"><span class="annottext">(m (Either QErr ()) -&gt; m ()) -&gt; m (Either QErr ()) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CatalogStateType -&gt; Value -&gt; m (Either QErr ())
forall (m :: * -&gt; *).
MonadMetadataStorage m =&gt;
CatalogStateType -&gt; Value -&gt; m (Either QErr ())
</span><a href="Hasura.Metadata.Class.html#updateCatalogState"><span class="hs-identifier hs-var">updateCatalogState</span></a></span><span> </span><span class="annot"><span class="annottext">CatalogStateType
</span><a href="#local-6989586621688028624"><span class="hs-identifier hs-var">_scsType</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688028625"><span class="hs-identifier hs-var">_scsState</span></a></span><span>
</span><span id="line-801"></span><span>  </span><span class="annot"><span class="annottext">EncJSON -&gt; m EncJSON
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="Hasura.RQL.Types.Common.html#successMsg"><span class="hs-identifier hs-var">successMsg</span></a></span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span id="local-6989586621688027053"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runSetMetricsConfig"><span class="hs-identifier hs-type">runSetMetricsConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-804"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688027053"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027053"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027053"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027053"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-805"></span><span>  </span><span class="annot"><a href="Hasura.RQL.Types.Common.html#MetricsConfig"><span class="hs-identifier hs-type">MetricsConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-806"></span><span>  </span><span class="annot"><a href="#local-6989586621688027053"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-807"></span><span id="runSetMetricsConfig"><span class="annot"><span class="annottext">runSetMetricsConfig :: forall (m :: * -&gt; *).
(MonadIO m, CacheRWM m, MetadataM m, MonadError QErr m) =&gt;
MetricsConfig -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runSetMetricsConfig"><span class="hs-identifier hs-var hs-var">runSetMetricsConfig</span></a></span></span><span> </span><span id="local-6989586621688028643"><span class="annot"><span class="annottext">MetricsConfig
</span><a href="#local-6989586621688028643"><span class="hs-identifier hs-var">mc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (m :: * -&gt; *) a. (QErrM m, CacheRM m) =&gt; m a -&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withNewInconsistentObjsCheck"><span class="hs-identifier hs-var">withNewInconsistentObjsCheck</span></a></span><span>
</span><span id="line-809"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetadataModifier -&gt; m ()
forall (m :: * -&gt; *).
(MetadataM m, CacheRWM m) =&gt;
MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCache"><span class="hs-identifier hs-var">buildSchemaCache</span></a></span><span>
</span><span id="line-810"></span><span>    </span><span class="annot"><span class="annottext">(MetadataModifier -&gt; m ()) -&gt; MetadataModifier -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span>
</span><span id="line-811"></span><span>    </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MetricsConfig -&gt; Identity MetricsConfig)
-&gt; Metadata -&gt; Identity Metadata
Lens' Metadata MetricsConfig
</span><a href="Hasura.RQL.Types.Metadata.html#metaMetricsConfig"><span class="hs-identifier hs-var">metaMetricsConfig</span></a></span><span>
</span><span id="line-812"></span><span>    </span><span class="annot"><span class="annottext">((MetricsConfig -&gt; Identity MetricsConfig)
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; MetricsConfig -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">MetricsConfig
</span><a href="#local-6989586621688028643"><span class="hs-identifier hs-var">mc</span></a></span><span>
</span><span id="line-813"></span><span>  </span><span class="annot"><span class="annottext">EncJSON -&gt; m EncJSON
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="Hasura.RQL.Types.Common.html#successMsg"><span class="hs-identifier hs-var">successMsg</span></a></span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span id="local-6989586621688027057"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runRemoveMetricsConfig"><span class="hs-identifier hs-type">runRemoveMetricsConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-816"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621688027057"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.SchemaCache.Build.html#CacheRWM"><span class="hs-identifier hs-type">CacheRWM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027057"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Metadata.html#MetadataM"><span class="hs-identifier hs-type">MetadataM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027057"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027057"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-817"></span><span>  </span><span class="annot"><a href="#local-6989586621688027057"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-818"></span><span id="runRemoveMetricsConfig"><span class="annot"><span class="annottext">runRemoveMetricsConfig :: forall (m :: * -&gt; *).
(MonadIO m, CacheRWM m, MetadataM m, MonadError QErr m) =&gt;
m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runRemoveMetricsConfig"><span class="hs-identifier hs-var hs-var">runRemoveMetricsConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-819"></span><span>  </span><span class="annot"><span class="annottext">m () -&gt; m ()
forall (m :: * -&gt; *) a. (QErrM m, CacheRM m) =&gt; m a -&gt; m a
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#withNewInconsistentObjsCheck"><span class="hs-identifier hs-var">withNewInconsistentObjsCheck</span></a></span><span>
</span><span id="line-820"></span><span>    </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MetadataModifier -&gt; m ()
forall (m :: * -&gt; *).
(MetadataM m, CacheRWM m) =&gt;
MetadataModifier -&gt; m ()
</span><a href="Hasura.RQL.Types.SchemaCache.Build.html#buildSchemaCache"><span class="hs-identifier hs-var">buildSchemaCache</span></a></span><span>
</span><span id="line-821"></span><span>    </span><span class="annot"><span class="annottext">(MetadataModifier -&gt; m ()) -&gt; MetadataModifier -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Metadata -&gt; Metadata) -&gt; MetadataModifier
</span><a href="Hasura.RQL.Types.Metadata.html#MetadataModifier"><span class="hs-identifier hs-var">MetadataModifier</span></a></span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><span class="annottext">((Metadata -&gt; Metadata) -&gt; MetadataModifier)
-&gt; (Metadata -&gt; Metadata) -&gt; MetadataModifier
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(MetricsConfig -&gt; Identity MetricsConfig)
-&gt; Metadata -&gt; Identity Metadata
Lens' Metadata MetricsConfig
</span><a href="Hasura.RQL.Types.Metadata.html#metaMetricsConfig"><span class="hs-identifier hs-var">metaMetricsConfig</span></a></span><span>
</span><span id="line-823"></span><span>    </span><span class="annot"><span class="annottext">((MetricsConfig -&gt; Identity MetricsConfig)
 -&gt; Metadata -&gt; Identity Metadata)
-&gt; MetricsConfig -&gt; Metadata -&gt; Metadata
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">MetricsConfig
</span><a href="Hasura.RQL.Types.Common.html#emptyMetricsConfig"><span class="hs-identifier hs-var">emptyMetricsConfig</span></a></span><span>
</span><span id="line-824"></span><span>  </span><span class="annot"><span class="annottext">EncJSON -&gt; m EncJSON
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">EncJSON
</span><a href="Hasura.RQL.Types.Common.html#successMsg"><span class="hs-identifier hs-var">successMsg</span></a></span><span>
</span><span id="line-825"></span><span>
</span><span id="line-826"></span><span class="hs-keyword">data</span><span> </span><span id="TestTransformError"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#TestTransformError"><span class="hs-identifier hs-var">TestTransformError</span></a></span></span><span>
</span><span id="line-827"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RequestInitializationError"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#RequestInitializationError"><span class="hs-identifier hs-var">RequestInitializationError</span></a></span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/http-client-0.7.17-1b2133de2c2ce095aea721bc3d56fba68148ba6d3c4af69a01586f3a88b4e771/share/doc/html/src/Network.HTTP.Client.Types.html/Network.HTTP.Client.Types.html#HttpException"><span class="hs-identifier hs-type">HTTP.HttpException</span></a></span><span>
</span><span id="line-828"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="RequestTransformationError"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#RequestTransformationError"><span class="hs-identifier hs-var">RequestTransformationError</span></a></span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/http-client-0.7.17-1b2133de2c2ce095aea721bc3d56fba68148ba6d3c4af69a01586f3a88b4e771/share/doc/html/src/Network.HTTP.Client.Types.html/Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">HTTP.Request</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Webhook.Transform.Class.html#TransformErrorBundle"><span class="hs-identifier hs-type">TransformErrorBundle</span></a></span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span id="local-6989586621688027059"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#runTestWebhookTransform"><span class="hs-identifier hs-type">runTestWebhookTransform</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErrM"><span class="hs-identifier hs-type">QErrM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027059"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-832"></span><span>  </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#TestWebhookTransform"><span class="hs-identifier hs-type">TestWebhookTransform</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><a href="#local-6989586621688027059"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-834"></span><span id="runTestWebhookTransform"><span class="annot"><span class="annottext">runTestWebhookTransform :: forall (m :: * -&gt; *). QErrM m =&gt; TestWebhookTransform -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#runTestWebhookTransform"><span class="hs-identifier hs-var hs-var">runTestWebhookTransform</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#TestWebhookTransform"><span class="hs-identifier hs-type">TestWebhookTransform</span></a></span><span> </span><span id="local-6989586621688028711"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621688028711"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621688028712"><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688028712"><span class="hs-identifier hs-var">headers</span></a></span></span><span> </span><span id="local-6989586621688028713"><span class="annot"><span class="annottext">WebHookUrl
</span><a href="#local-6989586621688028713"><span class="hs-identifier hs-var">urlE</span></a></span></span><span> </span><span id="local-6989586621688028714"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688028714"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span id="local-6989586621688028715"><span class="annot"><span class="annottext">RequestTransform
</span><a href="#local-6989586621688028715"><span class="hs-identifier hs-var">rt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe MetadataResponseTransform
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688028716"><span class="annot"><span class="annottext">Maybe SessionVariables
</span><a href="#local-6989586621688028716"><span class="hs-identifier hs-var">sv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-835"></span><span>  </span><span id="local-6989586621688028717"><span class="annot"><a href="#local-6989586621688028717"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WebHookUrl
</span><a href="#local-6989586621688028713"><span class="hs-identifier hs-var">urlE</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-836"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#URL"><span class="hs-identifier hs-type">URL</span></a></span><span> </span><span id="local-6989586621688028719"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028719"><span class="hs-identifier hs-var">url'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Environment -&gt; Text -&gt; m Text
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Environment -&gt; Text -&gt; m Text
</span><a href="Hasura.RQL.DDL.Metadata.html#interpolateFromEnv"><span class="hs-identifier hs-var">interpolateFromEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621688028711"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028719"><span class="hs-identifier hs-var">url'</span></a></span><span>
</span><span id="line-837"></span><span>    </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.Types.html#EnvVar"><span class="hs-identifier hs-type">EnvVar</span></a></span><span> </span><span id="local-6989586621688028722"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688028722"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-838"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028728"><span class="annot"><span class="annottext">err :: m a
</span><a href="#local-6989586621688028728"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m a
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; m a) -&gt; QErr -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Missing Env Var&quot;</span></span><span>
</span><span id="line-839"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">m Text -&gt; (String -&gt; m Text) -&gt; Maybe String -&gt; m Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">m Text
forall {a}. m a
</span><a href="#local-6989586621688028728"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; m Text
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Text) -&gt; (String -&gt; Text) -&gt; String -&gt; m Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; m Text) -&gt; Maybe String -&gt; m Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Environment -&gt; String -&gt; Maybe String
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html/Data.Environment.html#lookupEnv"><span class="hs-identifier hs-var">Env.lookupEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621688028711"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621688028722"><span class="hs-identifier hs-var">var</span></a></span><span>
</span><span id="line-840"></span><span>
</span><span id="line-841"></span><span>  </span><span id="local-6989586621688028732"><span class="annot"><a href="#local-6989586621688028732"><span class="hs-identifier hs-var">headers'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">fmap</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TE.encodeUtf8</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#interpolateFromEnv"><span class="hs-identifier hs-type">interpolateFromEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028711"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TE.decodeUtf8</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621688028712"><span class="hs-identifier hs-type">headers</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>  </span><span id="local-6989586621688028736"><span class="annot"><a href="#local-6989586621688028736"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">runExceptT</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-844"></span><span>    </span><span id="local-6989586621688028738"><span class="annot"><a href="#local-6989586621688028738"><span class="hs-identifier hs-var">initReq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#hoistEither"><span class="hs-identifier hs-type">hoistEither</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">first</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#RequestInitializationError"><span class="hs-identifier hs-type">RequestInitializationError</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#mkRequestEither"><span class="hs-identifier hs-type">HTTP.mkRequestEither</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028717"><span class="hs-identifier hs-type">url</span></a></span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028741"><span class="annot"><a href="#local-6989586621688028741"><span class="hs-identifier hs-var hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028738"><span class="hs-identifier hs-var">initReq</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; (Request -&gt; Request) -&gt; Request
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(RequestBody -&gt; Identity RequestBody)
-&gt; Request -&gt; Identity Request
Lens' Request RequestBody
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#body"><span class="hs-identifier hs-var">HTTP.body</span></a></span><span> </span><span class="annot"><span class="annottext">((RequestBody -&gt; Identity RequestBody)
 -&gt; Request -&gt; Identity Request)
-&gt; RequestBody -&gt; Request -&gt; Request
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; RequestBody
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/http-client-0.7.17-1b2133de2c2ce095aea721bc3d56fba68148ba6d3c4af69a01586f3a88b4e771/share/doc/html/src/Network.HTTP.Client.Types.html/Network.HTTP.Client.Types.html#RequestBodyLBS"><span class="hs-identifier hs-var">HTTP.RequestBodyLBS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.html/Data.Aeson.html#encode"><span class="hs-identifier hs-var">J.encode</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621688028714"><span class="hs-identifier hs-var">payload</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Request -&gt; (Request -&gt; Request) -&gt; Request
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">([Header] -&gt; Identity [Header]) -&gt; Request -&gt; Identity Request
Lens' Request [Header]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#headers"><span class="hs-identifier hs-var">HTTP.headers</span></a></span><span> </span><span class="annot"><span class="annottext">(([Header] -&gt; Identity [Header]) -&gt; Request -&gt; Identity Request)
-&gt; [Header] -&gt; Request -&gt; Request
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Setter.html/Control.Lens.Setter.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">[Header]
</span><a href="#local-6989586621688028732"><span class="hs-identifier hs-var">headers'</span></a></span><span>
</span><span id="line-847"></span><span>        </span><span id="local-6989586621688028746"><span class="annot"><a href="#local-6989586621688028746"><span class="hs-identifier hs-var hs-var">reqTransform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RequestTransform -&gt; RequestFields (WithOptional TransformFn)
</span><a href="Hasura.RQL.Types.Webhook.Transform.html#requestFields"><span class="hs-identifier hs-var">requestFields</span></a></span><span> </span><span class="annot"><span class="annottext">RequestTransform
</span><a href="#local-6989586621688028715"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-848"></span><span>        </span><span id="local-6989586621688028748"><span class="annot"><a href="#local-6989586621688028748"><span class="hs-identifier hs-var hs-var">engine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RequestTransform -&gt; TemplatingEngine
</span><a href="Hasura.RQL.Types.Webhook.Transform.html#templateEngine"><span class="hs-identifier hs-var">templateEngine</span></a></span><span> </span><span class="annot"><span class="annottext">RequestTransform
</span><a href="#local-6989586621688028715"><span class="hs-identifier hs-var">rt</span></a></span><span>
</span><span id="line-849"></span><span>        </span><span id="local-6989586621688028750"><span class="annot"><a href="#local-6989586621688028750"><span class="hs-identifier hs-var hs-var">reqTransformCtx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RequestTransformCtx -&gt; RequestContext)
-&gt; (Request -&gt; RequestTransformCtx) -&gt; Request -&gt; RequestContext
forall a b. (a -&gt; b) -&gt; (Request -&gt; a) -&gt; Request -&gt; b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">RequestTransformCtx -&gt; RequestContext
</span><a href="Hasura.RQL.DDL.Webhook.Transform.html#mkRequestContext"><span class="hs-identifier hs-var">mkRequestContext</span></a></span><span> </span><span class="annot"><span class="annottext">((Request -&gt; RequestTransformCtx) -&gt; Request -&gt; RequestContext)
-&gt; (Request -&gt; RequestTransformCtx) -&gt; Request -&gt; RequestContext
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
-&gt; Maybe SessionVariables
-&gt; TemplatingEngine
-&gt; Request
-&gt; RequestTransformCtx
</span><a href="Hasura.RQL.DDL.Webhook.Transform.Request.html#mkReqTransformCtx"><span class="hs-identifier hs-var">mkReqTransformCtx</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028717"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SessionVariables
</span><a href="#local-6989586621688028716"><span class="hs-identifier hs-var">sv</span></a></span><span> </span><span class="annot"><span class="annottext">TemplatingEngine
</span><a href="#local-6989586621688028748"><span class="hs-identifier hs-var">engine</span></a></span><span>
</span><span id="line-850"></span><span>    </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#hoistEither"><span class="hs-identifier hs-type">hoistEither</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#RequestTransformationError"><span class="hs-identifier hs-type">RequestTransformationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028741"><span class="hs-identifier hs-type">req</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.RQL.DDL.Webhook.Transform.html#applyRequestTransform"><span class="hs-identifier hs-type">applyRequestTransform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028750"><span class="hs-identifier hs-type">reqTransformCtx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028746"><span class="hs-identifier hs-type">reqTransform</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688028741"><span class="hs-identifier hs-type">req</span></a></span><span>
</span><span id="line-851"></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><a href="#local-6989586621688028736"><span class="hs-identifier hs-type">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-853"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621688028754"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028754"><span class="hs-identifier hs-var">transformed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><span class="annottext">Either TransformErrorBundle Request -&gt; m EncJSON
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Either TransformErrorBundle Request -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#packTransformResult"><span class="hs-identifier hs-var">packTransformResult</span></a></span><span> </span><span class="annot"><span class="annottext">(Either TransformErrorBundle Request -&gt; m EncJSON)
-&gt; Either TransformErrorBundle Request -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Either TransformErrorBundle Request
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028754"><span class="hs-identifier hs-var">transformed</span></a></span><span>
</span><span id="line-855"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#RequestTransformationError"><span class="hs-identifier hs-type">RequestTransformationError</span></a></span><span> </span><span class="annot"><span class="annottext">Request
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621688028756"><span class="annot"><span class="annottext">TransformErrorBundle
</span><a href="#local-6989586621688028756"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either TransformErrorBundle Request -&gt; m EncJSON
forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Either TransformErrorBundle Request -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#packTransformResult"><span class="hs-identifier hs-var">packTransformResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransformErrorBundle -&gt; Either TransformErrorBundle Request
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">TransformErrorBundle
</span><a href="#local-6989586621688028756"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-856"></span><span>    </span><span class="hs-comment">-- NOTE: In the following case we have failed before producing a valid request.</span><span>
</span><span id="line-857"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#RequestInitializationError"><span class="hs-identifier hs-type">RequestInitializationError</span></a></span><span> </span><span id="local-6989586621688028757"><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621688028757"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-858"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028758"><span class="annot"><span class="annottext">errorBundle :: TransformErrorBundle
</span><a href="#local-6989586621688028758"><span class="hs-identifier hs-var hs-var">errorBundle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-859"></span><span>            </span><span class="annot"><span class="annottext">[Value] -&gt; TransformErrorBundle
</span><a href="Hasura.RQL.Types.Webhook.Transform.Class.html#TransformErrorBundle"><span class="hs-identifier hs-var">TransformErrorBundle</span></a></span><span>
</span><span id="line-860"></span><span>              </span><span class="annot"><span class="annottext">([Value] -&gt; TransformErrorBundle)
-&gt; [Value] -&gt; TransformErrorBundle
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; [Value]
forall a. a -&gt; [a]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-861"></span><span>              </span><span class="annot"><span class="annottext">(Value -&gt; [Value]) -&gt; Value -&gt; [Value]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">J.object</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;error_code&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-var">J.String</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Request Initialization Error&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;message&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-var">J.String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HttpException -&gt; Text
forall a. Show a =&gt; a -&gt; Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html#tshow"><span class="hs-identifier hs-var">tshow</span></a></span><span> </span><span class="annot"><span class="annottext">HttpException
</span><a href="#local-6989586621688028757"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-862"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; Value -&gt; m EncJSON
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; Value -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400WithDetail"><span class="hs-identifier hs-var">throw400WithDetail</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#ValidationFailed"><span class="hs-identifier hs-var">ValidationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request transform validation failed&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; m EncJSON) -&gt; Value -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransformErrorBundle -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">TransformErrorBundle
</span><a href="#local-6989586621688028758"><span class="hs-identifier hs-var">errorBundle</span></a></span><span>
</span><span id="line-863"></span><span>
</span><span id="line-864"></span><span id="local-6989586621688027078"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#interpolateFromEnv"><span class="hs-identifier hs-type">interpolateFromEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027078"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html/Data.Environment.html#Environment"><span class="hs-identifier hs-type">Env.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688027078"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span></span><span>
</span><span id="line-865"></span><span id="interpolateFromEnv"><span class="annot"><span class="annottext">interpolateFromEnv :: forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Environment -&gt; Text -&gt; m Text
</span><a href="Hasura.RQL.DDL.Metadata.html#interpolateFromEnv"><span class="hs-identifier hs-var hs-var">interpolateFromEnv</span></a></span></span><span> </span><span id="local-6989586621688028782"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621688028782"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621688028783"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028783"><span class="hs-identifier hs-var">url</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-866"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Parser [Either Text Text]
-&gt; Text -&gt; Either String [Either Text Text]
forall a. Parser a -&gt; Text -&gt; Either String a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/attoparsec-0.14.4-721a423332575cfaea849bb008ae3e4fa4a9b17020621984e1f9839d812448cb/share/doc/html/src/Data.Attoparsec.Text.Internal.html/Data.Attoparsec.Text.Internal.html#parseOnly"><span class="hs-identifier hs-var">AT.parseOnly</span></a></span><span> </span><span class="annot"><span class="annottext">Parser [Either Text Text]
</span><a href="Hasura.RQL.DDL.Metadata.html#parseEnvTemplate"><span class="hs-identifier hs-var">parseEnvTemplate</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028783"><span class="hs-identifier hs-var">url</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-867"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">QErr -&gt; m Text
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(QErr -&gt; m Text) -&gt; QErr -&gt; m Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#ParseFailed"><span class="hs-identifier hs-var">ParseFailed</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Invalid Url Template&quot;</span></span><span>
</span><span id="line-868"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621688028787"><span class="annot"><span class="annottext">[Either Text Text]
</span><a href="#local-6989586621688028787"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-869"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621688028788"><span class="annot"><span class="annottext">lookup' :: Text -&gt; Either Text Text
</span><a href="#local-6989586621688028788"><span class="hs-identifier hs-var hs-var">lookup'</span></a></span></span><span> </span><span id="local-6989586621688028789"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028789"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either Text Text
-&gt; (String -&gt; Either Text Text) -&gt; Maybe String -&gt; Either Text Text
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either Text Text
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028789"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either Text Text
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either Text Text)
-&gt; (String -&gt; Text) -&gt; String -&gt; Either Text Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; Either Text Text)
-&gt; Maybe String -&gt; Either Text Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Environment -&gt; String -&gt; Maybe String
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Data.Environment.html/Data.Environment.html#lookupEnv"><span class="hs-identifier hs-var">Env.lookupEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621688028782"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028789"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>          </span><span id="local-6989586621688028791"><span class="annot"><span class="annottext">result :: Either Text [Text]
</span><a href="#local-6989586621688028791"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either Text Text -&gt; Either Text Text)
-&gt; [Either Text Text] -&gt; Either Text [Text]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either Text Text -&gt; Text)
-&gt; Either Text (Either Text Text) -&gt; Either Text Text
forall a b. (a -&gt; b) -&gt; Either Text a -&gt; Either Text b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Either Text Text -&gt; Text
forall a. Either a a -&gt; a
</span><a href="Hasura.RQL.DDL.Metadata.html#indistinct"><span class="hs-identifier hs-var">indistinct</span></a></span><span> </span><span class="annot"><span class="annottext">(Either Text (Either Text Text) -&gt; Either Text Text)
-&gt; (Either Text Text -&gt; Either Text (Either Text Text))
-&gt; Either Text Text
-&gt; Either Text Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either Text Text)
-&gt; (Text -&gt; Either Text Text)
-&gt; Either Text Text
-&gt; Either Text (Either Text Text)
forall (f :: * -&gt; *) a c b d.
Applicative f =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; Either a b -&gt; f (Either c d)
forall (t :: * -&gt; * -&gt; *) (f :: * -&gt; *) a c b d.
(Bitraversable t, Applicative f) =&gt;
(a -&gt; f c) -&gt; (b -&gt; f d) -&gt; t a b -&gt; f (t c d)
</span><span class="hs-identifier hs-var">bitraverse</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Text
</span><a href="#local-6989586621688028788"><span class="hs-identifier hs-var">lookup'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Text
forall a. a -&gt; Either Text a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Either Text Text]
</span><a href="#local-6989586621688028787"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-871"></span><span>          </span><span id="local-6989586621688028809"><span class="annot"><span class="annottext">err :: Text -&gt; m a
</span><a href="#local-6989586621688028809"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span id="local-6989586621688028810"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028810"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-872"></span><span>            </span><span class="annot"><span class="annottext">QErr -&gt; m a
forall a. QErr -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-873"></span><span>              </span><span class="annot"><span class="annottext">(QErr -&gt; m a) -&gt; QErr -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; QErr
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#err400"><span class="hs-identifier hs-var">err400</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#NotFound"><span class="hs-identifier hs-var">NotFound</span></a></span><span>
</span><span id="line-874"></span><span>              </span><span class="annot"><span class="annottext">(Text -&gt; QErr) -&gt; Text -&gt; QErr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Missing Env Var: &quot;</span></span><span>
</span><span id="line-875"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028810"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-876"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;. For security reasons when testing request options real environment variable values are not available. Please enter a mock value for &quot;</span></span><span>
</span><span id="line-877"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621688028810"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-878"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; in the Sample Env Variables list. See https://hasura.io/docs/latest/graphql/core/actions/rest-connectors/#action-transforms-sample-context&quot;</span></span><span>
</span><span id="line-879"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Text)
-&gt; ([Text] -&gt; m Text) -&gt; Either Text [Text] -&gt; m Text
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; m Text
forall {m :: * -&gt; *} {a}. MonadError QErr m =&gt; Text -&gt; m a
</span><a href="#local-6989586621688028809"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; m Text
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m Text) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; m Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall m. Monoid m =&gt; [m] -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Either Text [Text]
</span><a href="#local-6989586621688028791"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="hs-comment">-- | Deserialize a JSON or X-WWW-URL-FORMENCODED body from an</span><span>
</span><span id="line-882"></span><span class="hs-comment">-- 'HTTP.Request' as 'J.Value'.</span><span>
</span><span id="line-883"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#decodeBody"><span class="hs-identifier hs-type">decodeBody</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span>
</span><span id="line-884"></span><span id="decodeBody"><span class="annot"><span class="annottext">decodeBody :: Maybe ByteString -&gt; Value
</span><a href="Hasura.RQL.DDL.Metadata.html#decodeBody"><span class="hs-identifier hs-var hs-var">decodeBody</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span>
</span><span id="line-885"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#decodeBody"><span class="hs-identifier hs-var">decodeBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621688028814"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688028814"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value -&gt; Value
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Null"><span class="hs-identifier hs-var">J.Null</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Value -&gt; Value) -&gt; Maybe Value -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
</span><a href="Hasura.RQL.DDL.Metadata.html#jsonToValue"><span class="hs-identifier hs-var">jsonToValue</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688028814"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Value -&gt; Maybe Value -&gt; Maybe Value
forall a. Maybe a -&gt; Maybe a -&gt; Maybe a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
</span><a href="Hasura.RQL.DDL.Metadata.html#formUrlEncodedToValue"><span class="hs-identifier hs-var">formUrlEncodedToValue</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688028814"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span class="annot"><span class="hs-comment">-- | Attempt to encode a 'ByteString' as an Aeson 'Value'</span></span><span>
</span><span id="line-888"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#jsonToValue"><span class="hs-identifier hs-type">jsonToValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span>
</span><span id="line-889"></span><span id="jsonToValue"><span class="annot"><span class="annottext">jsonToValue :: ByteString -&gt; Maybe Value
</span><a href="Hasura.RQL.DDL.Metadata.html#jsonToValue"><span class="hs-identifier hs-var hs-var">jsonToValue</span></a></span></span><span> </span><span id="local-6989586621688028819"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688028819"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Decoding.html/Data.Aeson.Decoding.html#decode"><span class="hs-identifier hs-var">J.decode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688028819"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span class="hs-comment">-- | Quote a 'ByteString' then attempt to encode it as a JSON</span><span>
</span><span id="line-892"></span><span class="hs-comment">-- String. This is necessary for 'x-www-url-formencoded' bodies. They</span><span>
</span><span id="line-893"></span><span class="hs-comment">-- are a list of key/value pairs encoded as a raw 'ByteString' with no</span><span>
</span><span id="line-894"></span><span class="hs-comment">-- quoting whereas JSON Strings must be quoted.</span><span>
</span><span id="line-895"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#formUrlEncodedToValue"><span class="hs-identifier hs-type">formUrlEncodedToValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BL.ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#Value"><span class="hs-identifier hs-type">J.Value</span></a></span><span>
</span><span id="line-896"></span><span id="formUrlEncodedToValue"><span class="annot"><span class="annottext">formUrlEncodedToValue :: ByteString -&gt; Maybe Value
</span><a href="Hasura.RQL.DDL.Metadata.html#formUrlEncodedToValue"><span class="hs-identifier hs-var hs-var">formUrlEncodedToValue</span></a></span></span><span> </span><span id="local-6989586621688028821"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688028821"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Value
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Decoding.html/Data.Aeson.Decoding.html#decode"><span class="hs-identifier hs-var">J.decode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621688028821"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; ByteString
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#parseEnvTemplate"><span class="hs-identifier hs-type">parseEnvTemplate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/attoparsec-0.14.4-721a423332575cfaea849bb008ae3e4fa4a9b17020621984e1f9839d812448cb/share/doc/html/src/Data.Attoparsec.Text.Internal.html/Data.Attoparsec.Text.Internal.html#Parser"><span class="hs-identifier hs-type">AT.Parser</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">]</span><span>
</span><span id="line-899"></span><span id="parseEnvTemplate"><span class="annot"><span class="annottext">parseEnvTemplate :: Parser [Either Text Text]
</span><a href="Hasura.RQL.DDL.Metadata.html#parseEnvTemplate"><span class="hs-identifier hs-var hs-var">parseEnvTemplate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Parser Text (Either Text Text) -&gt; Parser [Either Text Text]
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f [a]
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/attoparsec-0.14.4-721a423332575cfaea849bb008ae3e4fa4a9b17020621984e1f9839d812448cb/share/doc/html/src/Data.Attoparsec.Combinator.html/Data.Attoparsec.Combinator.html#many1"><span class="hs-identifier hs-var">AT.many1</span></a></span><span> </span><span class="annot"><span class="annottext">(Parser Text (Either Text Text) -&gt; Parser [Either Text Text])
-&gt; Parser Text (Either Text Text) -&gt; Parser [Either Text Text]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser Text (Either Text Text)
forall {b}. Parser Text (Either Text b)
</span><a href="#local-6989586621688028823"><span class="hs-identifier hs-var">pEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Text (Either Text Text)
-&gt; Parser Text (Either Text Text) -&gt; Parser Text (Either Text Text)
forall a. Parser Text a -&gt; Parser Text a -&gt; Parser Text a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">Parser Text (Either Text Text)
forall {a}. Parser Text (Either a Text)
</span><a href="#local-6989586621688028824"><span class="hs-identifier hs-var">pLit</span></a></span><span> </span><span class="annot"><span class="annottext">Parser Text (Either Text Text)
-&gt; Parser Text (Either Text Text) -&gt; Parser Text (Either Text Text)
forall a. Parser Text a -&gt; Parser Text a -&gt; Parser Text a
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><span class="hs-operator hs-var">&lt;|&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either Text Text)
-&gt; Parser Text Text -&gt; Parser Text (Either Text Text)
forall a b. (a -&gt; b) -&gt; Parser Text a -&gt; Parser Text b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either Text Text
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Parser Text Text
</span><span class="hs-string">&quot;{&quot;</span></span><span>
</span><span id="line-900"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-901"></span><span>    </span><span id="local-6989586621688028823"><span class="annot"><span class="annottext">pEnv :: Parser Text (Either Text b)
</span><a href="#local-6989586621688028823"><span class="hs-identifier hs-var hs-var">pEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either Text b)
-&gt; Parser Text Text -&gt; Parser Text (Either Text b)
forall a b. (a -&gt; b) -&gt; Parser Text a -&gt; Parser Text b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Either Text b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Parser Text Text -&gt; Parser Text (Either Text b))
-&gt; Parser Text Text -&gt; Parser Text (Either Text b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Parser Text Text
</span><span class="hs-string">&quot;{{&quot;</span></span><span> </span><span class="annot"><span class="annottext">Parser Text Text -&gt; Parser Text Text -&gt; Parser Text Text
forall a b. Parser Text a -&gt; Parser Text b -&gt; Parser Text b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Text Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/attoparsec-0.14.4-721a423332575cfaea849bb008ae3e4fa4a9b17020621984e1f9839d812448cb/share/doc/html/src/Data.Attoparsec.Text.Internal.html/Data.Attoparsec.Text.Internal.html#takeWhile1"><span class="hs-identifier hs-var">AT.takeWhile1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'}'</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Parser Text Text -&gt; Parser Text Text -&gt; Parser Text Text
forall a b. Parser Text a -&gt; Parser Text b -&gt; Parser Text a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;*</span></span><span> </span><span class="annot"><span class="annottext">Parser Text Text
</span><span class="hs-string">&quot;}}&quot;</span></span><span>
</span><span id="line-902"></span><span>    </span><span id="local-6989586621688028824"><span class="annot"><span class="annottext">pLit :: Parser Text (Either a Text)
</span><a href="#local-6989586621688028824"><span class="hs-identifier hs-var hs-var">pLit</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either a Text)
-&gt; Parser Text Text -&gt; Parser Text (Either a Text)
forall a b. (a -&gt; b) -&gt; Parser Text a -&gt; Parser Text b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either a Text
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Parser Text Text -&gt; Parser Text (Either a Text))
-&gt; Parser Text Text -&gt; Parser Text (Either a Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; Parser Text Text
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/attoparsec-0.14.4-721a423332575cfaea849bb008ae3e4fa4a9b17020621984e1f9839d812448cb/share/doc/html/src/Data.Attoparsec.Text.Internal.html/Data.Attoparsec.Text.Internal.html#takeWhile1"><span class="hs-identifier hs-var">AT.takeWhile1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; Char -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'{'</span></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span id="local-6989586621688027116"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#indistinct"><span class="hs-identifier hs-type">indistinct</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621688027116"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027116"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688027116"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-905"></span><span id="indistinct"><span class="annot"><span class="annottext">indistinct :: forall a. Either a a -&gt; a
</span><a href="Hasura.RQL.DDL.Metadata.html#indistinct"><span class="hs-identifier hs-var hs-var">indistinct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; (a -&gt; a) -&gt; Either a a -&gt; a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span id="local-6989586621688027107"><span class="annot"><a href="Hasura.RQL.DDL.Metadata.html#packTransformResult"><span class="hs-identifier hs-type">packTransformResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621688027107"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Webhook.Transform.Class.html#TransformErrorBundle"><span class="hs-identifier hs-type">TransformErrorBundle</span></a></span><span> </span><span class="annot"><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/http-client-0.7.17-1b2133de2c2ce095aea721bc3d56fba68148ba6d3c4af69a01586f3a88b4e771/share/doc/html/src/Network.HTTP.Client.Types.html/Network.HTTP.Client.Types.html#Request"><span class="hs-identifier hs-type">HTTP.Request</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621688027107"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#EncJSON"><span class="hs-identifier hs-type">EncJSON</span></a></span></span><span>
</span><span id="line-908"></span><span id="packTransformResult"><span class="annot"><span class="annottext">packTransformResult :: forall (m :: * -&gt; *).
MonadError QErr m =&gt;
Either TransformErrorBundle Request -&gt; m EncJSON
</span><a href="Hasura.RQL.DDL.Metadata.html#packTransformResult"><span class="hs-identifier hs-var hs-var">packTransformResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-909"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621688028873"><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028873"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-910"></span><span>    </span><span class="annot"><span class="annottext">EncJSON -&gt; m EncJSON
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-911"></span><span>      </span><span class="annot"><span class="annottext">(EncJSON -&gt; m EncJSON) -&gt; (Value -&gt; EncJSON) -&gt; Value -&gt; m EncJSON
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; EncJSON
forall a. ToJSON a =&gt; a -&gt; EncJSON
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-json-encoding-1.0.0/opt/doc/html/hasura-json-encoding/src/Hasura.EncJSON.html/Hasura.EncJSON.html#encJFromJValue"><span class="hs-identifier hs-var">encJFromJValue</span></a></span><span>
</span><span id="line-912"></span><span>      </span><span class="annot"><span class="annottext">(Value -&gt; m EncJSON) -&gt; Value -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.Internal.html/Data.Aeson.Types.Internal.html#object"><span class="hs-identifier hs-var">J.object</span></a></span><span>
</span><span id="line-913"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;webhook_url&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Text -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028873"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Getting Text Request Text -&gt; Text
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Text Request Text
Lens' Request Text
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#url"><span class="hs-identifier hs-var">HTTP.url</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-914"></span><span>          </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;method&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; ByteString -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028873"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Getting ByteString Request ByteString -&gt; ByteString
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ByteString Request ByteString
Lens' Request ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#method"><span class="hs-identifier hs-var">HTTP.method</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-915"></span><span>          </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;headers&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; [(ByteString, ByteString)] -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HeaderName -&gt; ByteString) -&gt; Header -&gt; (ByteString, ByteString)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">HeaderName -&gt; ByteString
forall s. CI s -&gt; s
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/case-insensitive-1.2.1.0-65ff744e416d3483f48f17f0840924ef454e127ea866e868409ab395a75d4bb7/share/doc/html/src/Data.CaseInsensitive.Internal.html/Data.CaseInsensitive.Internal.html#foldedCase"><span class="hs-identifier hs-var">CI.foldedCase</span></a></span><span> </span><span class="annot"><span class="annottext">(Header -&gt; (ByteString, ByteString))
-&gt; [Header] -&gt; [(ByteString, ByteString)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028873"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Request -&gt; Getting [Header] Request [Header] -&gt; [Header]
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Getter.html/Control.Lens.Getter.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting [Header] Request [Header]
Lens' Request [Header]
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#headers"><span class="hs-identifier hs-var">HTTP.headers</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-916"></span><span>          </span><span class="hs-comment">-- NOTE: We cannot decode IO based body types.</span><span>
</span><span id="line-917"></span><span>          </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; Pair
forall v. ToJSON v =&gt; Key -&gt; v -&gt; Pair
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">J..=</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ByteString -&gt; Value
</span><a href="Hasura.RQL.DDL.Metadata.html#decodeBody"><span class="hs-identifier hs-var">decodeBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Request
</span><a href="#local-6989586621688028873"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Request
-&gt; Getting (First ByteString) Request ByteString
-&gt; Maybe ByteString
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/lens-5.3.2-7ec14d641784087c1f1350eada3cde7884c62d1ab2707daec993ceeca3096d32/share/doc/html/src/Control.Lens.Fold.html/Control.Lens.Fold.html#%5E%3F"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">(RequestBody -&gt; Const (First ByteString) RequestBody)
-&gt; Request -&gt; Const (First ByteString) Request
Lens' Request RequestBody
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#body"><span class="hs-identifier hs-var">HTTP.body</span></a></span><span> </span><span class="annot"><span class="annottext">((RequestBody -&gt; Const (First ByteString) RequestBody)
 -&gt; Request -&gt; Const (First ByteString) Request)
-&gt; ((ByteString -&gt; Const (First ByteString) ByteString)
    -&gt; RequestBody -&gt; Const (First ByteString) RequestBody)
-&gt; Getting (First ByteString) Request ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Const (First ByteString) ByteString)
-&gt; RequestBody -&gt; Const (First ByteString) RequestBody
Prism' RequestBody ByteString
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-extras-1.0.0/opt/doc/html/hasura-extras/src/Network.HTTP.Client.Transformable.html/Network.HTTP.Client.Transformable.html#_RequestBodyLBS"><span class="hs-identifier hs-var">HTTP._RequestBodyLBS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-918"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-919"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621688028878"><span class="annot"><span class="annottext">TransformErrorBundle
</span><a href="#local-6989586621688028878"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Code -&gt; Text -&gt; Value -&gt; m EncJSON
forall (m :: * -&gt; *) a. QErrM m =&gt; Code -&gt; Text -&gt; Value -&gt; m a
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#throw400WithDetail"><span class="hs-identifier hs-var">throw400WithDetail</span></a></span><span> </span><span class="annot"><span class="annottext">Code
</span><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#ValidationFailed"><span class="hs-identifier hs-var">ValidationFailed</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;request transform validation failed&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; m EncJSON) -&gt; Value -&gt; m EncJSON
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TransformErrorBundle -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///root/.local/state/cabal/store/ghc-9.10.1-inplace/aeson-2.2.3.0-5d7ee246cfa338f30d154e06f34dc50b9af0797ae9abbdeb4efa1326ac8786e5/share/doc/html/src/Data.Aeson.Types.ToJSON.html/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">J.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">TransformErrorBundle
</span><a href="#local-6989586621688028878"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-920"></span></pre></body></html>