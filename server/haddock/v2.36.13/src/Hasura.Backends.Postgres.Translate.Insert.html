<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | Postgres Translate Insert</span><span>
</span><span id="line-2"></span><span class="hs-comment">--</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- Translates IR inserts to Postgres-specific SQL INSERT statements.</span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Insert</span></a></span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#mkInsertCTE"><span class="hs-identifier">mkInsertCTE</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#toSQLConflict"><span class="hs-identifier">toSQLConflict</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertCheckConstraint"><span class="hs-identifier">insertCheckConstraint</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertOrUpdateCheckExpr"><span class="hs-identifier">insertOrUpdateCheckExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Authentication.User.html"><span class="hs-identifier">Hasura.Authentication.User</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Authentication.User.html#UserInfo"><span class="hs-identifier">UserInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.DML</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html"><span class="hs-identifier">Hasura.Backends.Postgres.SQL.Types</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.BoolExp.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.BoolExp</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Returning.html"><span class="hs-identifier">Hasura.Backends.Postgres.Translate.Returning</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html"><span class="hs-identifier">Hasura.Base.Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier">QErr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-prelude-0.1.0.0/opt/doc/html/hasura-prelude/src/Hasura.Prelude.html/Hasura.Prelude.html"><span class="hs-identifier">Hasura.Prelude</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Insert.html"><span class="hs-identifier">Hasura.RQL.IR.Insert</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.Backend.html"><span class="hs-identifier">Hasura.RQL.Types.Backend</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html"><span class="hs-identifier">Hasura.RQL.Types.BackendType</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span id="local-6989586621687929982"><span id="local-6989586621687929985"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#mkInsertCTE"><span class="hs-identifier hs-type">mkInsertCTE</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687929982"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687929985"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687929985"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Hasura.Authentication.User.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Insert.html#InsertQueryP1"><span class="hs-identifier hs-type">InsertQueryP1</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687929982"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="#local-6989586621687929985"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#TopLevelCTE"><span class="hs-identifier hs-type">S.TopLevelCTE</span></a></span></span></span><span>
</span><span id="line-28"></span><span id="mkInsertCTE"><span class="annot"><span class="annottext">mkInsertCTE :: forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(Backend ('Postgres pgKind), MonadIO m, MonadError QErr m) =&gt;
UserInfo -&gt; InsertQueryP1 ('Postgres pgKind) -&gt; m TopLevelCTE
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#mkInsertCTE"><span class="hs-identifier hs-var hs-var">mkInsertCTE</span></a></span></span><span> </span><span id="local-6989586621687930095"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687930095"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Insert.html#InsertQueryP1"><span class="hs-identifier hs-type">InsertQueryP1</span></a></span><span> </span><span id="local-6989586621687930097"><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
</span><a href="#local-6989586621687930097"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621687930098"><span class="annot"><span class="annottext">[Column ('Postgres pgKind)]
</span><a href="#local-6989586621687930098"><span class="hs-identifier hs-var">cols</span></a></span></span><span> </span><span id="local-6989586621687930099"><span class="annot"><span class="annottext">[[SQLExpression ('Postgres pgKind)]]
</span><a href="#local-6989586621687930099"><span class="hs-identifier hs-var">vals</span></a></span></span><span> </span><span id="local-6989586621687930100"><span class="annot"><span class="annottext">Maybe
  (OnConflictClause
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)))
</span><a href="#local-6989586621687930100"><span class="hs-identifier hs-var">conflict</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621687930101"><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
</span><a href="#local-6989586621687930101"><span class="hs-identifier hs-var">insCheck</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687930102"><span class="annot"><span class="annottext">Maybe (AnnBoolExpSQL ('Postgres pgKind))
</span><a href="#local-6989586621687930102"><span class="hs-identifier hs-var">updCheck</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MutationOutput ('Postgres pgKind)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[ColumnInfo ('Postgres pgKind)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-29"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687930103"><span class="annot"><span class="annottext">toSQLBool :: AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp
</span><a href="#local-6989586621687930103"><span class="hs-identifier hs-var hs-var hs-var">toSQLBool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(Backend ('Postgres pgKind), MonadIO m, MonadError QErr m) =&gt;
UserInfo -&gt; Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687930095"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="annot"><span class="annottext">(Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp)
-&gt; Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621687930097"><span class="hs-identifier hs-var">tn</span></a></span><span>
</span><span id="line-30"></span><span>  </span><span id="local-6989586621687930106"><span class="annot"><a href="#local-6989586621687930106"><span class="hs-identifier hs-var">insCheckBoolExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp
</span><a href="#local-6989586621687930103"><span class="hs-identifier hs-var">toSQLBool</span></a></span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
</span><a href="#local-6989586621687930101"><span class="hs-identifier hs-var">insCheck</span></a></span><span>
</span><span id="line-31"></span><span>  </span><span id="local-6989586621687930107"><span class="annot"><a href="#local-6989586621687930107"><span class="hs-identifier hs-var">updateCheckBoolExps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="annot"><a href="#local-6989586621687930103"><span class="hs-identifier hs-type">toSQLBool</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930102"><span class="hs-identifier hs-type">updCheck</span></a></span><span>
</span><span id="line-32"></span><span>  </span><span id="local-6989586621687930109"><span class="annot"><a href="#local-6989586621687930109"><span class="hs-identifier hs-var">sqlConflictExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="hs-identifier hs-type">traverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#toSQLConflict"><span class="hs-identifier hs-type">toSQLConflict</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930095"><span class="hs-identifier hs-type">userInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930097"><span class="hs-identifier hs-type">tn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621687930100"><span class="hs-identifier hs-type">conflict</span></a></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687930110"><span class="annot"><a href="#local-6989586621687930110"><span class="hs-identifier hs-var hs-var">tupVals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TupleExp] -&gt; ValuesExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#ValuesExp"><span class="hs-identifier hs-var">S.ValuesExp</span></a></span><span> </span><span class="annot"><span class="annottext">([TupleExp] -&gt; ValuesExp) -&gt; [TupleExp] -&gt; ValuesExp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([SQLExp] -&gt; TupleExp) -&gt; [[SQLExp]] -&gt; [TupleExp]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">[SQLExp] -&gt; TupleExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#TupleExp"><span class="hs-identifier hs-var">S.TupleExp</span></a></span><span> </span><span class="annot"><span class="annottext">[[SQLExpression ('Postgres pgKind)]]
[[SQLExp]]
</span><a href="#local-6989586621687930099"><span class="hs-identifier hs-var">vals</span></a></span><span>
</span><span id="line-34"></span><span>      </span><span id="local-6989586621687930113"><span class="annot"><a href="#local-6989586621687930113"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-35"></span><span>        </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; [PGCol]
-&gt; ValuesExp
-&gt; Maybe SQLConflict
-&gt; Maybe RetExp
-&gt; SQLInsert
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLInsert"><span class="hs-identifier hs-var">S.SQLInsert</span></a></span><span> </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621687930097"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">[Column ('Postgres pgKind)]
[PGCol]
</span><a href="#local-6989586621687930098"><span class="hs-identifier hs-var">cols</span></a></span><span> </span><span class="annot"><span class="annottext">ValuesExp
</span><a href="#local-6989586621687930110"><span class="hs-identifier hs-var">tupVals</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SQLConflict
</span><a href="#local-6989586621687930109"><span class="hs-identifier hs-var">sqlConflictExp</span></a></span><span>
</span><span id="line-36"></span><span>          </span><span class="annot"><span class="annottext">(Maybe RetExp -&gt; SQLInsert)
-&gt; ([Extractor] -&gt; Maybe RetExp) -&gt; [Extractor] -&gt; SQLInsert
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RetExp -&gt; Maybe RetExp
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span>
</span><span id="line-37"></span><span>          </span><span class="annot"><span class="annottext">(RetExp -&gt; Maybe RetExp)
-&gt; ([Extractor] -&gt; RetExp) -&gt; [Extractor] -&gt; Maybe RetExp
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Extractor] -&gt; RetExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#RetExp"><span class="hs-identifier hs-var">S.RetExp</span></a></span><span>
</span><span id="line-38"></span><span>          </span><span class="annot"><span class="annottext">([Extractor] -&gt; SQLInsert) -&gt; [Extractor] -&gt; SQLInsert
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Extractor
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#selectStar"><span class="hs-identifier hs-var">S.selectStar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>              </span><span class="annot"><span class="annottext">QualifiedTable
-&gt; Maybe (OnConflictClause ('Postgres pgKind) SQLExp)
-&gt; BoolExp
-&gt; Maybe BoolExp
-&gt; Extractor
forall (pgKind :: PostgresKind).
QualifiedTable
-&gt; Maybe (OnConflictClause ('Postgres pgKind) SQLExp)
-&gt; BoolExp
-&gt; Maybe BoolExp
-&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertOrUpdateCheckExpr"><span class="hs-identifier hs-var">insertOrUpdateCheckExpr</span></a></span><span>
</span><span id="line-40"></span><span>                </span><span class="annot"><span class="annottext">TableName ('Postgres pgKind)
QualifiedTable
</span><a href="#local-6989586621687930097"><span class="hs-identifier hs-var">tn</span></a></span><span>
</span><span id="line-41"></span><span>                </span><span class="annot"><span class="annottext">Maybe
  (OnConflictClause
     ('Postgres pgKind) (SQLExpression ('Postgres pgKind)))
Maybe (OnConflictClause ('Postgres pgKind) SQLExp)
</span><a href="#local-6989586621687930100"><span class="hs-identifier hs-var">conflict</span></a></span><span>
</span><span id="line-42"></span><span>                </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930106"><span class="hs-identifier hs-var">insCheckBoolExp</span></a></span><span>
</span><span id="line-43"></span><span>                </span><span class="annot"><span class="annottext">Maybe BoolExp
</span><a href="#local-6989586621687930107"><span class="hs-identifier hs-var">updateCheckBoolExps</span></a></span><span>
</span><span id="line-44"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#CTEInsert"><span class="hs-identifier hs-type">S.CTEInsert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930113"><span class="hs-identifier hs-type">insert</span></a></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span id="local-6989586621687930019"><span id="local-6989586621687930020"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#toSQLConflict"><span class="hs-identifier hs-type">toSQLConflict</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.Types.Backend.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930019"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadIO</span></span><span> </span><span class="annot"><a href="#local-6989586621687930020"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="file:///workdir/dist-newstyle/build/x86_64-linux/ghc-9.10.1/hasura-base-1.0.0/opt/doc/html/hasura-base/src/Hasura.Base.Error.html/Hasura.Base.Error.html#QErr"><span class="hs-identifier hs-type">QErr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930020"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Hasura.Authentication.User.html#UserInfo"><span class="hs-identifier hs-type">UserInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Conflict.html#OnConflictClause"><span class="hs-identifier hs-type">OnConflictClause</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930019"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="#local-6989586621687930020"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLConflict"><span class="hs-identifier hs-type">S.SQLConflict</span></a></span></span></span><span>
</span><span id="line-54"></span><span id="toSQLConflict"><span class="annot"><span class="annottext">toSQLConflict :: forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(Backend ('Postgres pgKind), MonadIO m, MonadError QErr m) =&gt;
UserInfo
-&gt; QualifiedTable
-&gt; OnConflictClause ('Postgres pgKind) SQLExp
-&gt; m SQLConflict
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#toSQLConflict"><span class="hs-identifier hs-var hs-var">toSQLConflict</span></a></span></span><span> </span><span id="local-6989586621687930140"><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687930140"><span class="hs-identifier hs-var">userInfo</span></a></span></span><span> </span><span id="local-6989586621687930141"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687930141"><span class="hs-identifier hs-var">tableName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Conflict.html#OCCDoNothing"><span class="hs-identifier hs-type">OCCDoNothing</span></a></span><span> </span><span id="local-6989586621687930143"><span class="annot"><span class="annottext">Maybe (ConflictTarget ('Postgres pgKind))
</span><a href="#local-6989586621687930143"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SQLConflict -&gt; m SQLConflict
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(SQLConflict -&gt; m SQLConflict) -&gt; SQLConflict -&gt; m SQLConflict
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe SQLConflictTarget -&gt; SQLConflict
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#DoNothing"><span class="hs-identifier hs-var">S.DoNothing</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe SQLConflictTarget -&gt; SQLConflict)
-&gt; Maybe SQLConflictTarget -&gt; SQLConflict
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConflictTarget ('Postgres pgKind) -&gt; SQLConflictTarget
forall {b :: BackendType}.
(Column b ~ PGCol, ConstraintName b ~ ConstraintName) =&gt;
ConflictTarget b -&gt; SQLConflictTarget
</span><a href="#local-6989586621687930145"><span class="hs-identifier hs-var">toSQLCT</span></a></span><span> </span><span class="annot"><span class="annottext">(ConflictTarget ('Postgres pgKind) -&gt; SQLConflictTarget)
-&gt; Maybe (ConflictTarget ('Postgres pgKind))
-&gt; Maybe SQLConflictTarget
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ConflictTarget ('Postgres pgKind))
</span><a href="#local-6989586621687930143"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Hasura.RQL.IR.Conflict.html#OCCUpdate"><span class="hs-identifier hs-type">OCCUpdate</span></a></span><span> </span><span class="annot"><a href="Hasura.RQL.IR.Conflict.html#OnConflictClauseData"><span class="hs-identifier hs-type">OnConflictClauseData</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621687930149"><span id="local-6989586621687930150"><span id="local-6989586621687930151"><span id="local-6989586621687930152"><span class="annot"><span class="annottext">[Column ('Postgres pgKind)]
PreSetColsG ('Postgres pgKind) SQLExp
AnnBoolExp ('Postgres pgKind) SQLExp
ConflictTarget ('Postgres pgKind)
cp1udConflictTarget :: ConflictTarget ('Postgres pgKind)
cp1udAffectedColumns :: [Column ('Postgres pgKind)]
cp1udValues :: PreSetColsG ('Postgres pgKind) SQLExp
cp1udFilter :: AnnBoolExp ('Postgres pgKind) SQLExp
cp1udFilter :: forall (b :: BackendType) v.
OnConflictClauseData b v -&gt; AnnBoolExp b v
cp1udValues :: forall (b :: BackendType) v.
OnConflictClauseData b v -&gt; PreSetColsG b v
cp1udAffectedColumns :: forall (b :: BackendType) v. OnConflictClauseData b v -&gt; [Column b]
cp1udConflictTarget :: forall (b :: BackendType) v.
OnConflictClauseData b v -&gt; ConflictTarget b
</span><a href="#local-6989586621687930149"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-57"></span><span>    </span><span id="local-6989586621687930157"><span class="annot"><a href="#local-6989586621687930157"><span class="hs-identifier hs-var">boolExp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserInfo -&gt; Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp
forall (pgKind :: PostgresKind) (m :: * -&gt; *).
(Backend ('Postgres pgKind), MonadIO m, MonadError QErr m) =&gt;
UserInfo -&gt; Qual -&gt; AnnBoolExpSQL ('Postgres pgKind) -&gt; m BoolExp
</span><a href="Hasura.Backends.Postgres.Translate.BoolExp.html#toSQLBoolExp"><span class="hs-identifier hs-var">toSQLBoolExp</span></a></span><span> </span><span class="annot"><span class="annottext">UserInfo
</span><a href="#local-6989586621687930140"><span class="hs-identifier hs-var">userInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QualTable"><span class="hs-identifier hs-var">S.QualTable</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687930141"><span class="hs-identifier hs-var">tableName</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AnnBoolExpSQL ('Postgres pgKind)
AnnBoolExp ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621687930152"><span class="hs-identifier hs-var">cp1udFilter</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">pure</span></span><span>
</span><span id="line-59"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Update"><span class="hs-identifier hs-type">S.Update</span></a></span><span>
</span><span id="line-60"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621687930145"><span class="hs-identifier hs-type">toSQLCT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930149"><span class="hs-identifier hs-type">cp1udConflictTarget</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#buildUpsertSetExp"><span class="hs-identifier hs-type">S.buildUpsertSetExp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930150"><span class="hs-identifier hs-type">cp1udAffectedColumns</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930151"><span class="hs-identifier hs-type">cp1udValues</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span>
</span><span id="line-63"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#WhereFrag"><span class="hs-identifier hs-type">S.WhereFrag</span></a></span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><span class="hs-operator hs-type">$</span></span><span> </span><span class="annot"><a href="#local-6989586621687930157"><span class="hs-identifier hs-type">boolExp</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-66"></span><span>    </span><span id="local-6989586621687930145"><span class="annot"><span class="annottext">toSQLCT :: ConflictTarget b -&gt; SQLConflictTarget
</span><a href="#local-6989586621687930145"><span class="hs-identifier hs-var hs-var">toSQLCT</span></a></span></span><span> </span><span id="local-6989586621687930165"><span class="annot"><span class="annottext">ConflictTarget b
</span><a href="#local-6989586621687930165"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConflictTarget b
</span><a href="#local-6989586621687930165"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Conflict.html#CTColumn"><span class="hs-identifier hs-type">CTColumn</span></a></span><span> </span><span id="local-6989586621687930167"><span class="annot"><span class="annottext">[Column b]
</span><a href="#local-6989586621687930167"><span class="hs-identifier hs-var">pgCols</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PGCol] -&gt; SQLConflictTarget
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLColumn"><span class="hs-identifier hs-var">S.SQLColumn</span></a></span><span> </span><span class="annot"><span class="annottext">[Column b]
[PGCol]
</span><a href="#local-6989586621687930167"><span class="hs-identifier hs-var">pgCols</span></a></span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><a href="Hasura.RQL.IR.Conflict.html#CTConstraint"><span class="hs-identifier hs-type">CTConstraint</span></a></span><span> </span><span id="local-6989586621687930170"><span class="annot"><span class="annottext">ConstraintName b
</span><a href="#local-6989586621687930170"><span class="hs-identifier hs-var">cn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConstraintName -&gt; SQLConflictTarget
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLConstraint"><span class="hs-identifier hs-var">S.SQLConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintName b
ConstraintName
</span><a href="#local-6989586621687930170"><span class="hs-identifier hs-var">cn</span></a></span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Annotates the check constraint expression with @boolean@</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- (&lt;check-condition&gt;)::boolean</span><span>
</span><span id="line-72"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertCheckConstraint"><span class="hs-identifier hs-type">insertCheckConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span>
</span><span id="line-73"></span><span id="insertCheckConstraint"><span class="annot"><span class="annottext">insertCheckConstraint :: BoolExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertCheckConstraint"><span class="hs-identifier hs-var hs-var">insertCheckConstraint</span></a></span></span><span> </span><span id="local-6989586621687930172"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930172"><span class="hs-identifier hs-var">boolExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><span class="annottext">SQLExp -&gt; TypeAnn -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SETyAnn"><span class="hs-identifier hs-var">S.SETyAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEBool"><span class="hs-identifier hs-var">S.SEBool</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930172"><span class="hs-identifier hs-var">boolExp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeAnn
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#boolTypeAnn"><span class="hs-identifier hs-var">S.boolTypeAnn</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-comment">-- | When inserting data, we might need to also enforce the update</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- check condition, because we might fall back to an update via an</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- @ON CONFLICT@ clause.</span><span>
</span><span id="line-79"></span><span class="hs-comment">--</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- We generate something which looks like</span><span>
</span><span id="line-81"></span><span class="hs-comment">--</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- &gt; INSERT INTO</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- &gt;   ...</span><span>
</span><span id="line-84"></span><span class="hs-comment">-- &gt; ON CONFLICT DO UPDATE SET</span><span>
</span><span id="line-85"></span><span class="hs-comment">-- &gt;   ...</span><span>
</span><span id="line-86"></span><span class="hs-comment">-- &gt; RETURNING</span><span>
</span><span id="line-87"></span><span class="hs-comment">-- &gt;   *,</span><span>
</span><span id="line-88"></span><span class="hs-comment">-- &gt;   CASE WHEN xmax = 0</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- &gt;     THEN {insert_cond}</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- &gt;     ELSE {update_cond}</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- &gt;   END</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- &gt;     AS &quot;check__constraint&quot;</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- See @https://stackoverflow.com/q/34762732@ for more information on the use of</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- the @xmax@ system column.</span><span>
</span><span id="line-96"></span><span id="local-6989586621687930033"><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertOrUpdateCheckExpr"><span class="hs-identifier hs-type">insertOrUpdateCheckExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.Types.html#QualifiedTable"><span class="hs-identifier hs-type">QualifiedTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Hasura.RQL.IR.Conflict.html#OnConflictClause"><span class="hs-identifier hs-type">OnConflictClause</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="annot"><a href="Hasura.RQL.Types.BackendType.html#Postgres"><span class="hs-identifier hs-type">Postgres</span></a></span><span> </span><span class="annot"><a href="#local-6989586621687930033"><span class="hs-identifier hs-type">pgKind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#SQLExp"><span class="hs-identifier hs-type">S.SQLExp</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#BoolExp"><span class="hs-identifier hs-type">S.BoolExp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="Hasura.Backends.Postgres.SQL.DML.html#Extractor"><span class="hs-identifier hs-type">S.Extractor</span></a></span></span><span>
</span><span id="line-102"></span><span id="insertOrUpdateCheckExpr"><span class="annot"><span class="annottext">insertOrUpdateCheckExpr :: forall (pgKind :: PostgresKind).
QualifiedTable
-&gt; Maybe (OnConflictClause ('Postgres pgKind) SQLExp)
-&gt; BoolExp
-&gt; Maybe BoolExp
-&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertOrUpdateCheckExpr"><span class="hs-identifier hs-var hs-var">insertOrUpdateCheckExpr</span></a></span></span><span> </span><span id="local-6989586621687930179"><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687930179"><span class="hs-identifier hs-var">qt</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687930180"><span class="annot"><span class="annottext">OnConflictClause ('Postgres pgKind) SQLExp
</span><a href="#local-6989586621687930180"><span class="hs-identifier hs-var">_conflict</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621687930181"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930181"><span class="hs-identifier hs-var">insCheck</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621687930182"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930182"><span class="hs-identifier hs-var">updCheck</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><span class="annottext">SQLExp -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#asCheckErrorExtractor"><span class="hs-identifier hs-var">asCheckErrorExtractor</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><span class="annottext">(SQLExp -&gt; Extractor) -&gt; SQLExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp -&gt; SQLExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SECond"><span class="hs-identifier hs-var">S.SECond</span></a></span><span>
</span><span id="line-105"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CompareOp -&gt; SQLExp -&gt; SQLExp -&gt; BoolExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#BECompare"><span class="hs-identifier hs-var">S.BECompare</span></a></span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="annottext">CompareOp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQ"><span class="hs-identifier hs-var">S.SEQ</span></a></span><span>
</span><span id="line-107"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QIdentifier -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEQIdentifier"><span class="hs-identifier hs-var">S.SEQIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Qual -&gt; Identifier -&gt; QIdentifier
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#QIdentifier"><span class="hs-identifier hs-var">S.QIdentifier</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QualifiedTable -&gt; Qual
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#mkQual"><span class="hs-identifier hs-var">S.mkQual</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><a href="#local-6989586621687930179"><span class="hs-identifier hs-var">qt</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Identifier
</span><a href="Hasura.Backends.Postgres.SQL.Types.html#Identifier"><span class="hs-identifier hs-var">Identifier</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;xmax&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.SQL.DML.html#SEUnsafe"><span class="hs-identifier hs-var">S.SEUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;0&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertCheckConstraint"><span class="hs-identifier hs-var">insertCheckConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930181"><span class="hs-identifier hs-var">insCheck</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertCheckConstraint"><span class="hs-identifier hs-var">insertCheckConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930182"><span class="hs-identifier hs-var">updCheck</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="annot"><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertOrUpdateCheckExpr"><span class="hs-identifier hs-var">insertOrUpdateCheckExpr</span></a></span><span> </span><span class="annot"><span class="annottext">QualifiedTable
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (OnConflictClause ('Postgres pgKind) SQLExp)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621687930192"><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930192"><span class="hs-identifier hs-var">insCheck</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BoolExp
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-comment">-- If we won't generate an ON CONFLICT clause, there is no point</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-comment">-- in testing xmax. In particular, views don't provide the xmax</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-comment">-- system column, but we don't provide ON CONFLICT for views,</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-comment">-- even if they are auto-updatable, so we can fortunately avoid</span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-comment">-- having to test the non-existent xmax value.</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-comment">-- Alternatively, if there is no update check constraint, we should</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">-- use the insert check constraint, for backwards compatibility.</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">SQLExp -&gt; Extractor
</span><a href="Hasura.Backends.Postgres.Translate.Returning.html#asCheckErrorExtractor"><span class="hs-identifier hs-var">asCheckErrorExtractor</span></a></span><span> </span><span class="annot"><span class="annottext">(SQLExp -&gt; Extractor) -&gt; SQLExp -&gt; Extractor
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BoolExp -&gt; SQLExp
</span><a href="Hasura.Backends.Postgres.Translate.Insert.html#insertCheckConstraint"><span class="hs-identifier hs-var">insertCheckConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">BoolExp
</span><a href="#local-6989586621687930192"><span class="hs-identifier hs-var">insCheck</span></a></span><span>
</span><span id="line-122"></span></pre></body></html>